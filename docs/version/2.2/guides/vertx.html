<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Using Eclipse Vert.x API from a Quarkus Application - 2.2</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/2.2/guides/vertx" />
  <meta property="og:title" content="Using Eclipse Vert.x API from a Quarkus Application - 2.2" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/vertx">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Quarkusとは <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/continuum" class="">リアクティブ</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学ぶ<i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ガイド</a></li>
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">コミュニティ <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="/publications" class="">出版物</a></li>
          <li><a href="/awards" class="">受賞</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >ENGLISH</a></li>
          <li><a href="https://ja.quarkus.io/">JAPANESE</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/version/2.2/guides/"> Back to Guides</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">Select Guide Version</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" >2.9 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" >2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" selected>2.2</option>
        
        
      
        
        
        
        
          
        <option value="1.11" >1.11</option>
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">Using Eclipse Vert.x API from a Quarkus Application </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#アーキテクチャ">アーキテクチャ</a></li>
<li><a href="#ソリューション">ソリューション</a></li>
<li><a href="#アプリケーションの起動">アプリケーションの起動</a></li>
<li><a href="#accessing-the-managed-vert-x-instance">Accessing the managed Vert.x instance</a></li>
<li><a href="#using-vert-x-core-api">Using Vert.x Core API</a></li>
<li><a href="#using-vert-x-stream-capability">Using Vert.x stream capability</a></li>
<li><a href="#イベントバスの使用">イベントバスの使用</a></li>
<li><a href="#using-vert-x-clients">Using Vert.x Clients</a></li>
<li><a href="#さらに詳しく">さらに詳しく</a></li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://vertx.io">Vert.x</a>は、リアクティブなアプリケーションを構築するためのツールキットです。 <a href="quarkus-reactive-architecture.html">Quarkus Reactive Architecture</a>に記載されているように、QuarkusではVert.xを下地に使用しています。</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/guides/images/quarkus-reactive-core.png" alt="Quarkus Reactive Core" width="50%">
</div>
</div>
<div class="paragraph">
<p>QuarkusのアプリケーションはVert.xのAPIにアクセスして使用することができます。</p>
</div>
<div class="paragraph">
<p>このガイドでは、Quarkusのアプリケーションで次を使って構築する方法を紹介します。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Vert.xのマネージドインスタンス</p>
</li>
<li>
<p>Vert.x イベントバス</p>
</li>
<li>
<p>Vert.x Webクライアント</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>これは入門ガイドです。 <a href="vertx-reference.html">Vert.xリファレンスガイド</a>では、バーティクルやネイティブトランスポートなど、より高度な機能について説明しています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="アーキテクチャ"><a class="anchor" href="#アーキテクチャ"></a>アーキテクチャ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ここでは、4つのHTTPエンドポイントを公開するシンプルなアプリケーションを作成します。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>/vertx/lorem</code> returns the content from a small file</p>
</li>
<li>
<p><code>/vertx/book</code> 大きなファイル（本）からコンテンツを返す</p>
</li>
<li>
<p><code>/vertx/hello</code> uses the Vert.x event bus to produce the response</p>
</li>
<li>
<p><code>/vertx/web</code> uses the Vert.x Web Client to retrieve data from Wikipedia</p>
</li>
</ol>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="/guides/images/quarkus-vertx-guide-architecture.png" alt="Architecture of the Vert.x guide" width="50%">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ソリューション"><a class="anchor" href="#ソリューション"></a>ソリューション</h2>
<div class="sectionbody">
<div class="paragraph">
<p>次の章で紹介する手順に沿って、ステップを踏んでアプリを作成することをお勧めします。ただし、完成した例にそのまま進んでも構いません。</p>
</div>
<div class="paragraph">
<p>Gitレポジトリをクローンするか <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code> 、 <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">アーカイブ</a> をダウンロードします。</p>
</div>
<div class="paragraph">
<p>このソリューションは <code>vertx-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/vertx-quickstart">directory</a> にあります。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Mutiny</div>
<div class="paragraph">
<p>このガイドでは、Mutiny APIを使用しています。Mutinyに慣れていない方は、 <a href="mutiny-primer.html">Mutiny - 直感的なリアクティブプログラミングライブラリ</a>をご覧ください。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="アプリケーションの起動"><a class="anchor" href="#アプリケーションの起動"></a>アプリケーションの起動</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://code.quarkus.io/?a=quarkus-getting-started-vertx&amp;nc=true&amp;e=resteasy-reactive-jackson&amp;e=vertx">このリンク</a>をクリックして、アプリケーションを設定してください。いくつかのエクステンションが選択されます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>resteasy-reactive-jackson</code> 。これは <code>resteasy reactive</code> ももたらします。これを使って、HTTPエンドポイントを公開します。</p>
</li>
<li>
<p><code>vertx</code> 、下地となるマネージドVert.xへのアクセスを提供します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>Generate your application</code> ボタンをクリックし、ZIPファイルをダウンロードして解凍します。その後、お好きなIDEでプロジェクトを開いてください。</p>
</div>
<div class="paragraph">
<p>生成された <code>pom.xml</code> ファイルを開くと、選択されたエクステンションが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-resteasy-reactive-jackson&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
  &lt;artifactId&gt;quarkus-vertx&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>pom.xml</code> の中で、以下の依存関係を追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;io.smallrye.reactive&lt;/groupId&gt;
  &lt;artifactId&gt;smallrye-mutiny-vertx-web-client&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>この依存関係は、Vert.x Web クライアントを提供し、 <code>/web</code> エンドポイントの実装に使用されます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="accessing-the-managed-vert-x-instance"><a class="anchor" href="#accessing-the-managed-vert-x-instance"></a>Accessing the managed Vert.x instance</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>src/main/java/org/acme/VertxResource.java</code> ファイルを作成します。このファイルには、HTTPエンドポイントが含まれます。</p>
</div>
<div class="paragraph">
<p>このファイルに、以下のコードをコピーします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme;

import io.vertx.mutiny.core.Vertx;

import javax.inject.Inject;
import javax.ws.rs.Path;

@Path("/vertx")                        <i class="conum" data-value="1"></i><b>(1)</b>
public class VertxResource {

    private final Vertx vertx;

    @Inject                             <i class="conum" data-value="2"></i><b>(2)</b>
    public VertxResource(Vertx vertx) { <i class="conum" data-value="3"></i><b>(3)</b>
        this.vertx = vertx;             <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>ルートHTTPパスを宣言します。</p>
</li>
<li>
<p>コンストラクタ・インジェクションを使用して、マネージドVert.xインスタンスを受け取ります。フィールド・インジェクションも有効です。</p>
</li>
<li>
<p>コンストラクタのパラメータとしてVert.xインスタンスを受け取ります。</p>
</li>
<li>
<p>マネージドVert.xインスタンスをフィールドに格納します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>これで、エンドポイントの実装を始めることができます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-vert-x-core-api"><a class="anchor" href="#using-vert-x-core-api"></a>Using Vert.x Core API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>インジェクションされたVert.xインスタンスは、利用可能なAPIのセットを提供します。このセクションで使用するのはVert.x File Systemです。これは、ファイルにアクセスするためのノンブロッキングAPIを提供します。</p>
</div>
<div class="paragraph">
<p><code>src/main/resource</code> ディレクトリに <code>lorem.txt</code> ファイルを次の内容で作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.</code></pre>
</div>
</div>
<div class="paragraph">
<p>そして、 <code>VertxResource</code> ファイルに以下のメソッドを追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@GET                                                                    <i class="conum" data-value="1"></i><b>(1)</b>
@Path("/lorem")
public Uni&lt;String&gt; readShortFile() {                                    <i class="conum" data-value="2"></i><b>(2)</b>
    return vertx.fileSystem().readFile("lorem.txt")                     <i class="conum" data-value="3"></i><b>(3)</b>
            .onItem().transform(content -&gt; content.toString("UTF-8"));  <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>このエンドポイントは、パス <code>/lorem</code> に対する HTTP <code>GET</code> リクエストを処理します（そのため、フルパスは <code>vertx/lorem</code> となります）。</p>
</li>
<li>
<p>Vert.x APIは非同期なので、このメソッドは <code>Uni</code> を返却します。Uniで表される非同期操作が完了すると、その内容がHTTPレスポンスに書き込まれます。</p>
</li>
<li>
<p>Vert.xのファイルシステムAPIを使用して、作成されたファイルを読み取ります。</p>
</li>
<li>
<p>ファイルが読み込まれると、その内容がメモリ内のバッファに格納されます。このバッファをStringに変換します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ターミナルで、プロジェクトのルートに移動して次を実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; ./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="paragraph">
<p>別の端末で、次を実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; curl http://localhost:8080/vertx/lorem</code></pre>
</div>
</div>
<div class="paragraph">
<p>コンソールにファイルの内容が表示されるはずです。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Quarkusは、静的ファイルを提供する他の方法を提供しています。これはガイドのために作られた例です。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-vert-x-stream-capability"><a class="anchor" href="#using-vert-x-stream-capability"></a>Using Vert.x stream capability</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ファイルを読み込んで内容をメモリに保存する方法は、小さなファイルには有効ですが、大きなファイルには使えません。このセクションでは、Vert.xのストリーミング機能をどのように使用するかを説明します。</p>
</div>
<div class="paragraph">
<p>まず、 <a href="https://www.gutenberg.org/files/2600/2600-0.txt">戦争と平和</a>をダウンロードして、 <code>src/main/resources/book.txt</code> に保存します。これは3.2Mbのファイルで、巨大ではありませんが、ストリームの目的を説明しています。今回は、ファイルの内容をメモリに蓄積して一括して書き込むのではなく、チャンクごとに読み込んで、そのチャンクを1つずつHTTPレスポンスに書き込んでいきます。</p>
</div>
<div class="paragraph">
<p>そこで、プロジェクト内に以下のファイルを用意しておきます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">.
├── mvnw
├── mvnw.cmd
├── pom.xml
├── README.md
├── src
│  └── main
│     ├── docker
│     │  ├── ...
│     ├── java
│     │  └── org
│     │     └── acme
│     │        └── VertxResource.java
│     └── resources
│        ├── application.properties
│        ├── book.txt
│        └── lorem.txt</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>VertxResource</code> クラスに以下のメソッドを追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@GET
@Path("/book")
public Multi&lt;String&gt; readLargeFile() {                              <i class="conum" data-value="1"></i><b>(1)</b>
    return vertx.fileSystem().open("book.txt",                      <i class="conum" data-value="2"></i><b>(2)</b>
                    new OpenOptions().setRead(true)
            )
            .onItem().transformToMulti(file -&gt; file.toMulti())       <i class="conum" data-value="3"></i><b>(3)</b>
            .onItem().transform(content -&gt; content.toString("UTF-8") <i class="conum" data-value="4"></i><b>(4)</b>
                    + "\n------------\n");                           <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>今回は、チャンクをストリーミングしたいので、Multiを返します。</p>
</li>
<li>
<p><code>open</code> メソッドを使ってファイルを開きます。このメソッドは <code>Uni&lt;AsyncFile&gt;</code> を返却します。</p>
</li>
<li>
<p>ファイルが開かれると、チャンクを含む <code>Multi</code> が取得できます。</p>
</li>
<li>
<p>各チャンクは、String を生成します。</p>
</li>
<li>
<p>レスポンス内のチャンクを視覚的に確認するために、セパレーターを追加します。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>そして、ターミナルで、次を実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; curl http://localhost:8080/vertx/book</code></pre>
</div>
</div>
<div class="paragraph">
<p>ブックの内容を取得します。出力には次のようなセパレータが表示されるはずです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">...
The little princess had also left the tea table and followed Hélène.

“Wait a moment, I’ll get my work.... Now then, what
------------
 are you
thinking of?” she went on, turning to Prince Hippolyte. “Fetch me my
workbag.”
...</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="イベントバスの使用"><a class="anchor" href="#イベントバスの使用"></a>イベントバスの使用</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Vert.xのコア機能の1つは、 <a href="https://vertx.io/docs/vertx-core/java/#event_bus">イベントバス</a> です。 これは、アプリケーションにメッセージベースのバックボーンを提供します。 したがって、非同期メッセージパッシングを使用してコンポーネントを相互作用させることができるため、コンポーネントを切り離すことができます。 単一のコンシューマーにメッセージを送信したり、複数のコンシューマーにディスパッチしたり、メッセージ（要求）を送信して応答を期待する要求と応答の対話を実装したりできます。 これは、このセクションで使用するものです。 <code>VertxResource</code> は、名前を含むメッセージを <code>greetings</code> アドレスに送信します。 別のコンポーネントがメッセージを受信し、 "hello$name" 応答を生成します。 <code>VertxResource</code> は応答を受信し、HTTP応答として返します。</p>
</div>
<div class="paragraph">
<p>では、以下の内容で <code>VertxResource</code> クラスを拡張してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
EventBus bus;                                                   <i class="conum" data-value="1"></i><b>(1)</b>

@GET
@Path("/hello")
public Uni&lt;String&gt; hello(@QueryParam("name") String name) {     <i class="conum" data-value="2"></i><b>(2)</b>
    return bus.&lt;String&gt;request("greetings", name)               <i class="conum" data-value="3"></i><b>(3)</b>
            .onItem().transform(response -&gt; response.body());   <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>イベントバスを注入します。 または、 <code>vertx.eventBus()</code> を使用することもできます。</p>
</li>
<li>
<p>クエリパラメータとして <em>name</em> を受け取ります</p>
</li>
<li>
<p><code>request</code> メソッドを使用して、要求と応答の相互作用を開始します。 名前を "greetings" アドレスに送信します。</p>
</li>
<li>
<p>応答を受信すると、本文を抽出してHTTP応答として返します</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>ここで、もう一方の側が必要です。名前を受け取って応答するコンポーネントです。
次の内容で <code>src/main/java/org/acme/GreetingService.java</code> ファイルを作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme;

import io.quarkus.vertx.ConsumeEvent;

import javax.enterprise.context.ApplicationScoped;

@ApplicationScoped                          <i class="conum" data-value="1"></i><b>(1)</b>
public class GreetingService {

    @ConsumeEvent("greetings")              <i class="conum" data-value="2"></i><b>(2)</b>
    public String hello(String name) {      <i class="conum" data-value="3"></i><b>(3)</b>
        return "Hello " + name;             <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>アプリケーションスコープでCDIBeanを宣言します。 Quarkusは、このクラスの単一のインスタンスを作成します。</p>
</li>
<li>
<p><code>@ ConsumeEvent</code> アノテーションを使用して、コンシューマーを宣言します。 Vert.x APIを直接使用することも可能です。 TODO LINK REF</p>
</li>
<li>
<p>メソッドパラメータとしてメッセージペイロードを受信します。 返されるオブジェクトは応答になります。</p>
</li>
<li>
<p>応答を返します。 この応答は `VertxResource`クラスに返送されます</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>これを試してみましょう。
ターミナルで、次の手順を実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; curl "http://localhost:8080/vertx/hello?name=bob"</code></pre>
</div>
</div>
<div class="paragraph">
<p>期待される <code>Hello bob</code> メッセージを返す必要があります。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-vert-x-clients"><a class="anchor" href="#using-vert-x-clients"></a>Using Vert.x Clients</h2>
<div class="sectionbody">
<div class="paragraph">
<p>これまで、Vert.x Core APIを使用してきました。 Vert.xはさらに多くの機能、広大なエコシステムを提供します。 このセクションでは、リアクティブHTTPクライアントであるVert.x Webクライアントの使用方法を説明します。</p>
</div>
<div class="paragraph">
<p>一部のQuarkusエクステンションはVert.xクライアントをラップし、それらを管理していることに注意してください。 これは、リアクティブデータソース、Redis、メールの場合です&#8230;&#8203; Webクライアントの場合はそうではありません。</p>
</div>
<div class="paragraph">
<p>ガイドの冒頭で、 <code>smallrye-mutiny-vertx-web-client</code> 依存関係を <code>pom.xml</code> ファイルに追加したことを思い出して下さい。 それを使用する時が来ました。</p>
</div>
<div class="paragraph">
<p>まず、 <code>WebClient</code> のインスタンスを作成する必要があります。 <code>VertxResource</code> クラスを <code>client</code> フィールドで拡張し、コンストラクターでWebクライアントを作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private final Vertx vertx;
private final WebClient client;            <i class="conum" data-value="1"></i><b>(1)</b>

@Inject
public VertxResource(Vertx vertx) {
    this.vertx = vertx;
    this.client = WebClient.create(vertx); <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>WebClient</code> を保存して、HTTPエンドポイントで使用できるようにします</p>
</li>
<li>
<p><code>WebClient</code> を作成します。 必ず `io.vertx.mutiny.ext.web.client.WebClient`クラスを使用してください</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>次に、Wikipedia APIにクエリを実行してQuarkusに関するページをさまざまな言語で取得する新しいHTTPエンドポイントを実装しましょう。
次のメソッドを `VertxResource`クラスに追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">private static final String URL = "https://en.wikipedia.org/w/api.php?action=parse&amp;page=Quarkus&amp;format=json&amp;prop=langlinks";

@GET
@Path("/web")
public Uni&lt;JsonArray&gt; retrieveDataFromWikipedia() {                     <i class="conum" data-value="1"></i><b>(1)</b>
    return client.getAbs(URL).send()                                    <i class="conum" data-value="2"></i><b>(2)</b>
            .onItem().transform(HttpResponse::bodyAsJsonObject)         <i class="conum" data-value="3"></i><b>(3)</b>
            .onItem().transform(json -&gt; json.getJsonObject("parse")     <i class="conum" data-value="4"></i><b>(4)</b>
                                        .getJsonArray("langlinks"));
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>1.このエンドポイントはJSON配列を返します。 Vert.xは、JSONオブジェクトと配列を操作するための便利な方法を提供します。 これらの詳細については、<a href="vertx-reference#using-vert-x-json">リファレンスガイド</a> をご覧ください。
2. <code>GET</code> リクエストをWikipedia APIに送信します
3. 応答を受信したら、それをJSONオブジェクトとして抽出します
4. 応答から <code>langlinks</code> 配列を抽出します。</p>
</div>
<div class="paragraph">
<p>そして、エンドポイントを呼び出します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">&gt; curl http://localhost:8080/vertx/web
[{"lang":"de", "url", :"https://de.wikipedia.org/wiki/Quarkus", "langname", :"German", "autonym", :"Deutsch", "*", :"Quarkus"}, {"lang":"fr", "url", :"https://fr.wikipedia.org/wiki/Quarkus", "langname", :"French", "autonym", :"français", "*", :"Quarkus"}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>応答は、英語のページに加えて、ウィキペディアにQuarkusに関するドイツ語とフランス語のページがあることを示しています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="さらに詳しく"><a class="anchor" href="#さらに詳しく"></a>さらに詳しく</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このガイドでは、QuarkusアプリケーションからVert.xAPIを使用する方法を紹介しました。 簡単な概要ですので、詳細については、<a href="vertx-reference">QuarkusにおけるVert.xのリファレンスガイド</a>を参照してください。</p>
</div>
<div class="paragraph">
<p>As we have seen, the event bus is the connecting tissue of Vert.x applications. Quarkus integrates it so different beans can interact with asynchronous messages. This part is covered in the <a href="reactive-event-bus">event bus documentation</a>.</p>
</div>
<div class="paragraph">
<p>Learn how to implement highly performant, low-overhead database applications on Quarkus with the <a href="reactive-sql-clients">Reactive SQL Clients</a>.</p>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus はオープンです。このプロジェクトの全ての依存関係は<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>または互換性のあるライセンスの元で利用出来ます。<br /><br />このウェブサイトは <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> で構築されており、<a href='https://pages.github.com/' target='_blank'>Github Pages</a>にホストされており、完全にオープンソースです。改善したい場合、 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>ウェブサイトをフォークし</a>、修正してみせてください。</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
            <li><a href="/">ホーム</a></li>
          
            <li><a href="/about">Quarkusについて</a></li>
          
            <li><a href="/blog">ブログ</a></li>
          
            <li><a href="/insights">ポッドキャスト</a></li>
          
            <li><a href="/events">イベント</a></li>
          
            <li><a href="/newsletter">ニュースレター</a></li>
          
            <li><a href="/publications">出版</a></li>
          
            <li><a href="/awards">受賞</a></li>
          
            <li><a href="/security">セキュリティポリシー</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォロー</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
            <li><a href="/support">サポート</a></li>
          
            <li><a href="/guides">ガイド</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入門</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">ディスカッション</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">開発メーリングリスト</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://ja.quarkus.io/">Japanese</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">等々...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
