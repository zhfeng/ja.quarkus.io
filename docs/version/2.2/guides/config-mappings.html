<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - 設定をオブジェクトにマッピング - 2.2</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/2.2/guides/config-mappings" />
  <meta property="og:title" content="設定をオブジェクトにマッピング - 2.2" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/config-mappings">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Quarkusとは <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/continuum" class="">リアクティブ</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学ぶ<i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ガイド</a></li>
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">コミュニティ <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="/publications" class="">出版物</a></li>
          <li><a href="/awards" class="">受賞</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >ENGLISH</a></li>
          <li><a href="https://ja.quarkus.io/">JAPANESE</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/version/2.2/guides/"> Back to Guides</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">Select Guide Version</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" >2.9 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" >2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" selected>2.2</option>
        
        
      
        
        
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">設定をオブジェクトにマッピング </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#config-mappings">1. <code>@ConfigMapping</code></a>
<ul class="sectlevel2">
<li><a href="#取得">1.1. 取得</a></li>
<li><a href="#ネストされたグループ">1.2. ネストされたグループ</a></li>
<li><a href="#プロパティ名のオーバーライド">1.3. プロパティ名のオーバーライド</a></li>
<li><a href="#変換">1.4. 変換</a></li>
<li><a href="#デフォルト">1.5. デフォルト</a></li>
<li><a href="#バリデーション">1.6. バリデーション</a></li>
<li><a href="#モック">1.7. モック</a></li>
</ul>
</li>
<li><a href="#config-properties">2. <span class="line-through"><code>@ConfigProperties</code></span> (Deprecated)</a>
<ul class="sectlevel2">
<li><a href="#configproperties-に関する追加の注意事項">2.1. @ConfigProperties に関する追加の注意事項</a></li>
<li><a href="#同じ-configproperties-で異なる接頭辞を使用">2.2. 同じ ConfigProperties で異なる接頭辞を使用</a></li>
<li><a href="#combining-configproperties-with-build-time-conditions">2.3. Combining ConfigProperties with build time conditions</a></li>
</ul>
</li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>設定マッピングでは、同じプレフィックスを持つ複数の設定プロパティを1つのインターフェースにまとめることができます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config-mappings"><a class="anchor" href="#config-mappings"></a>1. <code>@ConfigMapping</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>設定マッピングでは、最小メタデータ設定で、 <code>@io.smallrye.config.ConfigMapping</code> のアノテーションが付いたインターフェースが必要です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping(prefix = "server")
interface Server {
    String host();

    int port();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Server</code> インターフェースは、 <code>server.host</code> という名前の設定プロパティを <code>Server.host()</code> メソッドに、 <code>server.port</code> を <code>Server.port()</code> メソッドにマッピングすることができます。検索する設定プロパティ名は、プレフィックスと、 <code>.</code> (ドット)をセパレータとするメソッド名から構築されます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
マッピングが設定プロパティと一致しない場合、マッピングされた要素が <code>Optional</code> でない限り、 <code>NoSuchElementException</code> がスローされます。
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="取得"><a class="anchor" href="#取得"></a>1.1. 取得</h3>
<div class="paragraph">
<p>設定マッピングインタフェースは，任意のCDI対応Beanに注入することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">class BusinessBean {
    @Inject
    Server server;

    public void businessMethod() {
        String host = server.host();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>CDI以外のコンテキストでは、API <code>io.smallrye.config.SmallRyeConfig#getConfigMapping</code> を使用して、設定マッピングインスタンスを取得します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">SmallRyeConfig config = ConfigProvider.getConfig().unwrap(SmallRyeConfig.class);
Server server = config.getConfigMapping(Server.class);</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ネストされたグループ"><a class="anchor" href="#ネストされたグループ"></a>1.2. ネストされたグループ</h3>
<div class="paragraph">
<p>ネストされたマッピングは、他の設定プロパティをサブグループ化する方法を提供します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping(prefix = "server")
public interface Server {
    String host();

    int port();

    Log log();

    interface Log {
        boolean enabled();

        String suffix();

        boolean rotate();
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.host=localhost
server.port=8080
server.log.enabled=true
server.log.suffix=.log
server.log.rotate=false</code></pre>
</div>
</div>
<div class="paragraph">
<p>マッピンググループのメソッド名は、設定プロパティのサブネームスペースとして機能します。</p>
</div>
</div>
<div class="sect2">
<h3 id="プロパティ名のオーバーライド"><a class="anchor" href="#プロパティ名のオーバーライド"></a>1.3. プロパティ名のオーバーライド</h3>
<div class="sect3">
<h4 id="withname"><a class="anchor" href="#withname"></a>1.3.1. <code>@WithName</code></h4>
<div class="paragraph">
<p>メソッド名やプロパティ名が互いに一致しない場合、 <code>@WithName</code> アノテーションはメソッド名のマッピングを上書きし、アノテーションで提供された名前を使用することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping(prefix = "server")
interface Server {
    @WithName("name")
    String host();

    int port();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.name=localhost
server.port=8080</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="withparentname"><a class="anchor" href="#withparentname"></a>1.3.2. <code>@WithParentName</code></h4>
<div class="paragraph">
<p><code>@WithParent</code> アノテーションにより、設定のマッピングがそのコンテナ名を継承するようになり、マッピングに合わせて必要な設定プロパティ名が簡素化されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">interface Server {
    @WithParentName
    ServerHostAndPort hostAndPort();

    @WithParentName
    ServerInfo info();
}

interface ServerHostAndPort {
    String host();

    int port();
}

interface ServerInfo {
    String name();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.host=localhost
server.port=8080
server.name=konoha</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@WithParentName</code> を使用しない場合、メソッド <code>name()</code> は設定プロパティ <code>server.info.name</code> を必要とします。 <code>@WithParentName</code> を使用しているため、 <code>info()</code> のマッピングは <code>Server</code> から親の名前を継承し、 <code>name()</code> は代わりに <code>server.name</code> にマッピングします。</p>
</div>
</div>
<div class="sect3">
<h4 id="ネーミング戦略"><a class="anchor" href="#ネーミング戦略"></a>1.3.3. ネーミング戦略</h4>
<div class="paragraph">
<p>キャメルケースのメソッド名は、ケバブケースのプロパティ名にマッピングされます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping(prefix = "server")
interface Server {
    String theHost();

    int thePort();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.the-host=localhost
server.the-port=8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>マッピング戦略は、 <code>@ConfigMapping</code> のアノテーションで <code>namingStrategy</code> の値を設定することで調整できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping(prefix = "server", namingStrategy = ConfigMapping.NamingStrategy.VERBATIM)
public interface ServerVerbatimNamingStrategy {
    String theHost();

    int thePort();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.theHost=localhost
server.thePort=8080</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@ConfigMapping</code> アノテーションは、以下のネーミング戦略に対応しています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>KEBAB_CASE</code> （デフォルト） - メソッド名は、設定プロパティをマッピングするために、ケースの変更をダッシュに置き換えて導き出されます。</p>
</li>
<li>
<p><code>VERBATIM</code> - メソッド名は、設定プロパティをマッピングするためにそのまま使用されます。</p>
</li>
<li>
<p><code>SNAKE_CASE</code> - メソッド名は、設定プロパティをマッピングするためにケースの変更をアンダースコアで置き換えて導き出されます。</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="変換"><a class="anchor" href="#変換"></a>1.4. 変換</h3>
<div class="paragraph">
<p>設定マッピングクラスは、 <code>Config</code> で変換可能なすべてのタイプの自動変換をサポートしています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping
public interface SomeTypes {
    @WithName("int")
    int intPrimitive();

    @WithName("int")
    Integer intWrapper();

    @WithName("long")
    long longPrimitive();

    @WithName("long")
    Long longWrapper();

    @WithName("float")
    float floatPrimitive();

    @WithName("float")
    Float floatWrapper();

    @WithName("double")
    double doublePrimitive();

    @WithName("double")
    Double doubleWrapper();

    @WithName("char")
    char charPrimitive();

    @WithName("char")
    Character charWrapper();

    @WithName("boolean")
    boolean booleanPrimitive();

    @WithName("boolean")
    Boolean booleanWrapper();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">int=9
long=9999999999
float=99.9
double=99.99
char=c
boolean=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>これは <code>Optional</code> と friends にも有効です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping
public interface Optionals {
    Optional&lt;Server&gt; server();

    Optional&lt;String&gt; optional();

    @WithName("optional.int")
    OptionalInt optionalInt();

    interface Server {
        String host();

        int port();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>この場合、マッピングにマッチする設定プロパティがなければ、マッピングは失敗しません。</p>
</div>
<div class="sect3">
<h4 id="withconverter"><a class="anchor" href="#withconverter"></a>1.4.1. <code>@WithConverter</code></h4>
<div class="paragraph">
<p><code>@WithConverter</code> アノテーションは、特定のマッピングで使用する <code>Converter</code> を設定する方法を提供します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping
public interface Converters {
    @WithConverter(FooBarConverter.class)
    String foo();
}

public static class FooBarConverter implements Converter&lt;String&gt; {
    @Override
    public String convert(final String value) {
        return "bar";
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">foo=foo</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Converters.foo()</code> を呼び出すと、 <code>bar</code> という値が得られます。</p>
</div>
</div>
<div class="sect3">
<h4 id="collections"><a class="anchor" href="#collections"></a>1.4.2. Collections</h4>
<div class="paragraph">
<p>また、設定マッピングは、コレクションタイプ <code>List</code> と <code>Set</code> をマッピングすることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping(prefix = "server")
public interface ServerCollections {
    Set&lt;Environment&gt; environments();

    interface Environment {
        String name();

        List&lt;App&gt; apps();

        interface App {
            String name();

            List&lt;String&gt; services();

            Optional&lt;List&lt;String&gt;&gt; databases();
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.environments[0].name=dev
server.environments[0].apps[0].name=rest
server.environments[0].apps[0].services=bookstore,registration
server.environments[0].apps[0].databases=pg,h2
server.environments[0].apps[1].name=batch
server.environments[0].apps[1].services=stock,warehouse</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>List</code> や <code>Set</code> のマッピングでは、 <a href="config-reference.html#indexed-properties">インデックス付きのプロパティ</a>を使用して、マッピンググループの設定値をマッピングすることができます。 <code>String</code> のような単純な要素タイプを持つコレクションの場合、その設定値はコンマ区切りの文字列です。</p>
</div>
</div>
<div class="sect3">
<h4 id="マップ"><a class="anchor" href="#マップ"></a>1.4.3. マップ</h4>
<div class="paragraph">
<p>また、設定マッピングは、 <code>Map</code> をマッピングすることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping(prefix = "server")
public interface Server {
    String host();

    int port();

    Map&lt;String, String&gt; form();
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">server.host=localhost
server.port=8080
server.form.login-page=login.html
server.form.error-page=error.html
server.form.landing-page=index.html</code></pre>
</div>
</div>
<div class="paragraph">
<p>設定プロパティでは、キーとして機能する追加の名前を指定する必要があります。この場合、 <code>form()</code> <code>Map</code> には、 <code>login-page</code>, <code>error-page</code>, <code>landing-page</code> というキーを持つ3つの要素が含まれます。</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="デフォルト"><a class="anchor" href="#デフォルト"></a>1.5. デフォルト</h3>
<div class="paragraph">
<p><code>@WithDefault</code> アノテーションにより、デフォルトのプロパティをマッピングに設定することができます（また、設定値がどの <code>ConfigSource</code> においても利用できない場合はエラーになりません）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public interface Defaults {
    @WithDefault("foo")
    String foo();

    @WithDefault("bar")
    String bar();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>設定プロパティは必要ありません。 <code>Defaults.foo()</code> は値 <code>foo</code> を、 <code>Defaults.bar()</code> は値 <code>bar</code> を返します。</p>
</div>
</div>
<div class="sect2">
<h3 id="バリデーション"><a class="anchor" href="#バリデーション"></a>1.6. バリデーション</h3>
<div class="paragraph">
<p>設定マッピングは、設定値を検証するために <a href="https://beanvalidation.org">Bean Validation</a>からのアノテーションを組み合わせることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping(prefix = "server")
interface Server {
    @Size(min = 2, max = 20)
    String host();

    @Max(10000)
    int port();
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
検証が機能するためには、 <code>quarkus-hibernate-validator</code> のエクステンションが必要です。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="モック"><a class="anchor" href="#モック"></a>1.7. モック</h3>
<div class="paragraph">
<p>マッピングインターフェースの実装はプロキシではありませんので、他のCDI Beanのように <code>@InjectMock</code> で直接モックすることはできません。一つの方法として、プロデューサ・メソッドでプロキシ可能にすることがあります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ServerMockProducer {
    @Inject
    Config config;

    @Produces
    @ApplicationScoped
    @io.quarkus.test.Mock
    Server server() {
        return config.unwrap(SmallRyeConfig.class).getConfigMapping(Server.class);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Server</code> は、モックとして <code>@InjectMock</code> でQuarkusのテストクラスに注入することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTest
class ServerMockTest {
    @Inject
    Server server;

    @Test
    void localhost() {
        Mockito.when(server.host()).thenReturn("localhost");
        assertEquals("localhost", server.host());
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
モックは、実際の設定値を持たない空のシェルに過ぎません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>特定の設定値のみをモックし、元の設定を保持することが目的の場合、モックインスタンスにはスパイが必要となります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigMapping(prefix = "app")
public interface AppConfig {
    @WithDefault("app")
    String name();

    Info info();

    interface Info {
        @WithDefault("alias")
        String alias();
        @WithDefault("10")
        Integer count();
    }
}

public static class AppConfigProducer {
    @Inject
    Config config;

    @Produces
    @ApplicationScoped
    @io.quarkus.test.Mock
    AppConfig appConfig() {
        AppConfig appConfig = config.unwrap(SmallRyeConfig.class).getConfigMapping(AppConfig.class);
        AppConfig appConfigSpy = Mockito.spy(appConfig);
        AppConfig.Info infoSpy = Mockito.spy(appConfig.info());
        Mockito.when(appConfigSpy.info()).thenReturn(infoSpy);
        return appConfigSpy;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AppConfig</code> は、モックとして <code>@Inject</code> でQuarkusのテストクラスに注入することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@QuarkusTest
class AppConfigTest {
    @Inject
    AppConfig appConfig;

    @Test
    void localhost() {
        Mockito.when(appConfig.name()).thenReturn("mocked-app");
        assertEquals("mocked-app", server.host());

        Mockito.when(appConfig.info().alias()).thenReturn("mocked-alias");
        assertEquals("mocked-alias", server.info().alias());
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ネストされた要素は、Mockitoが個別にスパイする必要があります。
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="config-properties"><a class="anchor" href="#config-properties"></a>2. <span class="line-through"><code>@ConfigProperties</code></span> (Deprecated)</h2>
<div class="sectionbody">
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
この機能はまもなく削除される予定です。コードベースを更新し、代わりに <code>@ConfigMapping</code> を使用してください。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@io.quarkus.arc.config.ConfigProperties</code> アノテーションは、複数の関連する設定値を独自のクラスにまとめることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.config;

import io.quarkus.arc.config.ConfigProperties;
import java.util.Optional;

@ConfigProperties(prefix = "greeting") <i class="conum" data-value="1"></i><b>(1)</b>
public class GreetingConfiguration {

    private String message;
    private String suffix = "!"; <i class="conum" data-value="2"></i><b>(2)</b>
    private Optional&lt;String&gt; name;

    public String getMessage() {
        return message;
    }

    public void setMessage(String message) {
        this.message = message;
    }

    public String getSuffix() {
        return suffix;
    }

    public void setSuffix(String suffix) {
        this.suffix = suffix;
    }

    public Optional&lt;String&gt; getName() {
        return name;
    }

    public void setName(Optional&lt;String&gt; name) {
        this.name = name;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>prefix</code> は任意です。設定していない場合は、使用される接頭辞はクラス名によって決まります。この場合も (<code>Configuration</code> の接尾辞は削除されているため) <code>greeting</code> となります。クラス名が <code>GreetingExtraConfiguration</code> の場合は、デフォルトの接頭辞が <code>greeting-extra</code> となります。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>!</code> は、<code>greeting.suffix</code> が設定されていない場合のデフォルト値になります。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>CDI <code>@Inject</code> で <code>GreetingResource</code> を注入してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Inject
GreetingConfiguration greetingConfiguration;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Quarkusが提供するもう一つの代替スタイルは、インターフェイスとして <code>GreetingConfiguration</code> を作成することです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.config;

import io.quarkus.arc.config.ConfigProperties;
import org.eclipse.microprofile.config.inject.ConfigProperty;
import java.util.Optional;

@ConfigProperties(prefix = "greeting")
public interface GreetingConfiguration {

    @ConfigProperty(name = "message") <i class="conum" data-value="1"></i><b>(1)</b>
    String message();

    @ConfigProperty(defaultValue = "!")
    String getSuffix(); <i class="conum" data-value="2"></i><b>(2)</b>

    Optional&lt;String&gt; getName(); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td><code>@ConfigProperty</code> アノテーションが必要なのは、メソッドが対応する設定プロパティの名前が、ゲッターメソッドの命名規則に従っていないからです。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>この場合、 <code>name</code> が設定されていないので、対応するプロパティは <code>greeting.suffix</code> となります。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>メソッド名はゲッターメソッドの命名規則（ <code>greeting.name</code> が対応するプロパティ）に従っており、デフォルト値は必要ないため、 <code>@ConfigProperty</code> アノテーションを指定する必要はありません。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>クラスやインターフェイスで <code>@ConfigProperties</code> を使用する場合、そのフィールドの 1 つの値が提供されていないと、アプリケーションの起動に失敗し、 <code>javax.enterprise.inject.spi.DeploymentException</code> がスローされます。これは、 <code>Optional</code> フィールドとデフォルト値を持つフィールドには適用されません。</p>
</div>
<div class="sect2">
<h3 id="configproperties-に関する追加の注意事項"><a class="anchor" href="#configproperties-に関する追加の注意事項"></a>2.1. @ConfigProperties に関する追加の注意事項</h3>
<div class="paragraph">
<p><code>@ConfigProperties</code> でアノテーションされた通常のクラスを使用する場合、クラスは必ずしも getter および setter を宣言する必要はありません。単純でパブリックな確定的でないフィールドを持つことも有効です。</p>
</div>
<div class="paragraph">
<p>さらに、設定クラスはネストされたオブジェクト設定をサポートしています。例えば、 <code>content</code> という名前のグリーティングの設定を追加で用意する必要があり、その中にはいくつかのフィールドが含まれているとします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigProperties(prefix = "greeting")
public class GreetingConfiguration {

    public String message;
    public String suffix = "!";
    public Optional&lt;String&gt; name;
    public ContentConfig content; <i class="conum" data-value="1"></i><b>(1)</b>

    public static class ContentConfig {
        public Integer prizeAmount;
        public List&lt;String&gt; recipients;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>フィールドの名前 (クラス名ではありません) は、オブジェクトにバインドされるプロパティーの名前を決定します。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>プロパティの設定は通常の方法で行います。</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">greeting.message = hello
greeting.name = quarkus
greeting.content.prize-amount=10
greeting.content.recipients=Jane,John</code></pre>
</div>
</div>
<div class="paragraph">
<p>さらに、 <code>@ConfigProperties</code> でアノテーションされたクラスには、Bean Validationアノテーションを付けることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigProperties(prefix = "greeting")
public class GreetingConfiguration {

    @Size(min = 20)
    public String message;
    public String suffix = "!";

}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
検証が機能するためには、 <code>quarkus-hibernate-validator</code> のエクステンションが必要です。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="同じ-configproperties-で異なる接頭辞を使用"><a class="anchor" href="#同じ-configproperties-で異なる接頭辞を使用"></a>2.2. 同じ ConfigProperties で異なる接頭辞を使用</h3>
<div class="paragraph">
<p>また、Quarkusでは、 <code>io.quarkus.arc.config.@ConfigPrefix</code> アノテーションを使用して、同じ <code>@ConfigProperties</code> オブジェクトを注入ポイントごとに異なるプレフィックスで使用することもサポートしています。上記の <code>GreetingConfiguration</code> が、 <code>greeting</code> のプレフィックスと <code>other</code> のプレフィックスの両方に使用される必要がある場合は以下のようにします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ConfigProperties(prefix = "greeting")
public class GreetingConfiguration {

    @Size(min = 20)
    public String message;
    public String suffix = "!";

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class SomeBean {

    @Inject <i class="conum" data-value="1"></i><b>(1)</b>
    GreetingConfiguration greetingConfiguration;

    @ConfigPrefix("other") <i class="conum" data-value="2"></i><b>(2)</b>
    GreetingConfiguration otherConfiguration;

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>この注入ポイントでは、<code>greetingConfiguration</code> は <code>@ConfigProperties</code> で定義されている <code>greeting</code> の接頭辞を使用します。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>この注入ポイントでは、<code>otherConfiguration</code> は、<code>greeting</code> の接頭辞の代わりに <code>@ConfigPrefix</code> から <code>other</code> の接頭辞を使用します。この場合、<code>@Inject</code> は必須ではないことに注意してください。</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="combining-configproperties-with-build-time-conditions"><a class="anchor" href="#combining-configproperties-with-build-time-conditions"></a>2.3. Combining ConfigProperties with build time conditions</h3>
<div class="paragraph">
<p>Quarkusでは、ビルド時に評価される条件（ <code>@IfBuildProfile</code> 、 <code>@UnlessBuildProfile</code> 、 <code>@IfBuildProperty</code> 、 <code>@UnlessBuildProperty</code> ）を定義して、アノテーション <code>@ConfigProperties</code> と <code>@ConfigPrefix</code> を有効にしたり、無効にしたりすることができ、構成を非常に柔軟にマッピングすることができます。</p>
</div>
<div class="paragraph">
<p>サービスの設定が <code>@ConfigProperties</code> にマッピングされていて、テストではこの設定部分はモックされるので必要ないとします。その場合は、次の例のようにビルド時の条件を定義します。</p>
</div>
<div class="paragraph">
<p><code>ServiceConfiguration.java</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@UnlessBuildProfile("test") <i class="conum" data-value="1"></i><b>(1)</b>
@ConfigProperties
public class ServiceConfiguration {
    public String user;
    public String password;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>アノテーション <code>@ConfigProperties</code> は、アクティブなプロファイルが <code>test</code> でない場合にのみ考慮されます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>SomeBean.java</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class SomeBean {

    @Inject
    Instance&lt;ServiceConfiguration&gt; serviceConfiguration; <i class="conum" data-value="1"></i><b>(1)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>サービス設定が欠落している可能性があるため、インジェクションポイントで <code>Instance&lt;ServiceConfiguration&gt;</code> を型として使用する必要があります。</td>
</tr>
</table>
</div>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus はオープンです。このプロジェクトの全ての依存関係は<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>または互換性のあるライセンスの元で利用出来ます。<br /><br />このウェブサイトは <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> で構築されており、<a href='https://pages.github.com/' target='_blank'>Github Pages</a>にホストされており、完全にオープンソースです。改善したい場合、 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>ウェブサイトをフォークし</a>、修正してみせてください。</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
            <li><a href="/">ホーム</a></li>
          
            <li><a href="/about">Quarkusについて</a></li>
          
            <li><a href="/blog">ブログ</a></li>
          
            <li><a href="/insights">ポッドキャスト</a></li>
          
            <li><a href="/events">イベント</a></li>
          
            <li><a href="/newsletter">ニュースレター</a></li>
          
            <li><a href="/publications">出版</a></li>
          
            <li><a href="/awards">受賞</a></li>
          
            <li><a href="/security">セキュリティポリシー</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォロー</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
            <li><a href="/support">サポート</a></li>
          
            <li><a href="/guides">ガイド</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入門</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">ディスカッション</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">開発メーリングリスト</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://ja.quarkus.io/">Japanese</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">等々...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
