<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Quarkusでのトランザクションの使用</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/guides/transaction" />
  <meta property="og:title" content="Quarkusでのトランザクションの使用" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/transaction">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Quarkusとは <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/continuum" class="">リアクティブ</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学ぶ<i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ガイド</a></li>
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">コミュニティ <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="/publications" class="">出版物</a></li>
          <li><a href="/awards" class="">受賞</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >ENGLISH</a></li>
          <li><a href="https://ja.quarkus.io/">JAPANESE</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/guides/"> Back to Guides</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">Select Guide Version</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" selected>2.9 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" >2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" >2.2</option>
        
        
      
        
        
        
        
          
        <option value="1.11" >1.11</option>
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">Quarkusでのトランザクションの使用 </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#設定">設定</a></li>
<li><a href="#トランザクションの開始と停止境界線の定義">トランザクションの開始と停止:境界線の定義</a>
<ul class="sectlevel2">
<li><a href="#宣言的アプローチ">宣言的アプローチ</a></li>
<li><a href="#トランザクション設定">トランザクション設定</a></li>
<li><a href="#リアクティブエクステンション">リアクティブエクステンション</a></li>
<li><a href="#programmatic-approach">Programmatic Approach</a></li>
<li><a href="#legacy-api-approach">Legacy API approach</a></li>
</ul>
</li>
<li><a href="#トランザクションタイムアウトの設定">トランザクションタイムアウトの設定</a></li>
<li><a href="#トランザクションノード名識別子の設定">トランザクションノード名識別子の設定</a></li>
<li><a href="#なぜ常にトランザクションマネージャーを持っているのか">なぜ常にトランザクションマネージャーを持っているのか?</a></li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>QuarkusにはTransaction Managerが付属しており、これを使用してトランザクションを調整してアプリケーションに公開します。永続性を扱う各エクステンションは、これと統合されます。そして、CDIを介して明示的にトランザクションと対話することになります。このガイドでは、これらすべてについて説明します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="設定"><a class="anchor" href="#設定"></a>設定</h2>
<div class="sectionbody">
<div class="paragraph">
<p>これを必要とするエクステンションは単に依存関係として追加するだけなので、ほとんどの場合、設定について心配する必要はありません。例えばHibernate ORMはトランザクションマネージャーを含んでおり、適切に設定してくれます。</p>
</div>
<div class="paragraph">
<p>You might need to add it as a dependency explicitly if you are using transactions directly without Hibernate ORM for example. Add the following to your build file:</p>
</div>
<div class="listingblock primary asciidoc-tabs-target-sync-cli asciidoc-tabs-target-sync-maven">
<div class="title">pom.xml</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-narayana-jta&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-target-sync-gradle">
<div class="title">build.gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-gradle hljs" data-lang="gradle">implementation("io.quarkus:quarkus-narayana-jta")</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="トランザクションの開始と停止境界線の定義"><a class="anchor" href="#トランザクションの開始と停止境界線の定義"></a>トランザクションの開始と停止:境界線の定義</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can define your transaction boundaries either declarativly with <code>@Transactional</code> or programmatically with <code>QuarkusTransaction</code>. You can also use the JTA <code>UserTransaction</code> API directly, however this is less user friendly than <code>QuarkusTransaction</code>.</p>
</div>
<div class="sect2">
<h3 id="宣言的アプローチ"><a class="anchor" href="#宣言的アプローチ"></a>宣言的アプローチ</h3>
<div class="paragraph">
<p>トランザクションの境界を定義する最も簡単な方法は、エントリーメソッド ( <code>javax.transaction.Transactional</code> ) で <code>@Transactional</code> アノテーションを使用することです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class SantaClausService {

    @Inject ChildDAO childDAO;
    @Inject SantaClausDAO santaDAO;

    @Transactional <i class="conum" data-value="1"></i><b>(1)</b>
    public void getAGiftFromSanta(Child child, String giftDescription) {
        // some transaction work
        Gift gift = childDAO.addToGiftList(child, giftDescription);
        if (gift == null) {
            throw new OMGGiftNotRecognizedException(); <i class="conum" data-value="2"></i><b>(2)</b>
        }
        else {
            santaDAO.addToSantaTodoList(gift);
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>このアノテーションは、トランザクションの境界を定義し、トランザクション内でこの呼び出しをラップします。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>RuntimeException</code> がトランザクションの境界を越えると、トランザクションがロールバックされます。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>@Transactional</code> は、メソッドレベルまたはクラスレベルで、すべてのメソッドがトランザクションであることを保証するために、任意の CDI Bean のトランザクション境界を制御するために使用することができます。これにはRESTエンドポイントも含まれます。</p>
</div>
<div class="paragraph">
<p><code>@Transactional</code> のパラメーターを使用して、トランザクションを開始するかどうか、どのように開始するかを制御することができます。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>@Transactional(REQUIRED)</code> (デフォルト): 何も開始されていない場合はトランザクションを開始し、そうでない場合は既存のトランザクションを維持します。</p>
</li>
<li>
<p><code>@Transactional(REQUIRES_NEW)</code> : 何も開始されていない場合はトランザクションを開始し、既存のトランザクションが開始されている場合はそれを一時停止し、そのメソッドの境界で新しいトランザクションを開始します。</p>
</li>
<li>
<p><code>@Transactional(MANDATORY)</code> : トランザクションが開始されていない場合は失敗し、そうでない場合は既存のトランザクション内で動作します。</p>
</li>
<li>
<p><code>@Transactional(SUPPORTS)</code> : トランザクションが開始されている場合、それに参加します。開始されていない場合はトランザクションなしで動作します。</p>
</li>
<li>
<p><code>@Transactional(NOT_SUPPORTED)</code> : トランザクションが開始されている場合、それを一時停止し、メソッドの境界ではトランザクションなしで動作します。開始されていない場合は、トランザクションなしで動作します。</p>
</li>
<li>
<p><code>@Transactional(NEVER)</code> : トランザクションが開始されている場合は例外を発生させます。開始されていない場合はトランザクションなしで動作します。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>REQUIRED</code> or <code>NOT_SUPPORTED</code> are probably the most useful ones. This is how you decide whether a method is to be running within or outside a transaction. Make sure to check the JavaDoc for the precise semantic.</p>
</div>
<div class="paragraph">
<p>The transaction context is propagated to all calls nested in the <code>@Transactional</code> method as you would expect (in this example <code>childDAO.addToGiftList()</code> and <code>santaDAO.addToSantaTodoList()</code>). The transaction will commit unless a runtime exception crosses the method boundary. You can override whether an exception forces the rollback or not by using <code>@Transactional(dontRollbackOn=SomeException.class)</code> (or <code>rollbackOn</code>).</p>
</div>
<div class="paragraph">
<p>You can also programmatically ask for a transaction to be marked for rollback. Inject a <code>TransactionManager</code> for this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class SantaClausService {

    @Inject TransactionManager tm; <i class="conum" data-value="1"></i><b>(1)</b>
    @Inject ChildDAO childDAO;
    @Inject SantaClausDAO santaDAO;

    @Transactional
    public void getAGiftFromSanta(Child child, String giftDescription) {
        // some transaction work
        Gift gift = childDAO.addToGiftList(child, giftDescription);
        if (gift == null) {
            tm.setRollbackOnly(); <i class="conum" data-value="2"></i><b>(2)</b>
        }
        else {
            santaDAO.addToSantaTodoList(gift);
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject the <code>TransactionManager</code> to be able to activate <code>setRollbackOnly</code> semantic.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Programmatically decide to set the transaction for rollback.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="トランザクション設定"><a class="anchor" href="#トランザクション設定"></a>トランザクション設定</h3>
<div class="paragraph">
<p>Advanced configuration of the transaction is possible with the use of the <code>@TransactionConfiguration</code> annotation that is set in addition to the standard <code>@Transactional</code> annotation on your entry method or at the class level.</p>
</div>
<div class="paragraph">
<p>The <code>@TransactionConfiguration</code> annotation allows to set a timeout property, in seconds, that applies to transactions created within the annotated method.</p>
</div>
<div class="paragraph">
<p>This annotation may only be placed on the top level method delineating the transaction. Annotated nested methods once a transaction has started will throw an exception.</p>
</div>
<div class="paragraph">
<p>If defined on a class, it is equivalent to defining it on all the methods of the class marked with <code>@Transactional</code>. The configuration defined on a method takes precedence over the configuration defined on a class.</p>
</div>
</div>
<div class="sect2">
<h3 id="リアクティブエクステンション"><a class="anchor" href="#リアクティブエクステンション"></a>リアクティブエクステンション</h3>
<div class="paragraph">
<p>If your <code>@Transactional</code>-annotated method returns a reactive value, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>CompletionStage</code> (from the JDK)</p>
</li>
<li>
<p><code>Publisher</code> (from Reactive-Streams)</p>
</li>
<li>
<p>Any type which can be converted to one of the two previous types using Reactive Type Converters</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>then the behaviour is a bit different, because the transaction will not be terminated until the returned reactive value is terminated. In effect, the returned reactive value will be listened to and if it terminates exceptionally the transaction will be marked for rollback, and will be committed or rolled-back only at termination of the reactive value.</p>
</div>
<div class="paragraph">
<p>This allows your reactive methods to keep on working on the transaction asynchronously until their work is really done, and not just until the reactive method returns.</p>
</div>
<div class="paragraph">
<p>If you need to propagate your transaction context across your reactive pipeline, please see the <a href="context-propagation">Context Propagation guide</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="programmatic-approach"><a class="anchor" href="#programmatic-approach"></a>Programmatic Approach</h3>
<div class="paragraph">
<p>You can use static methods on <code>QuarkusTransaction</code> to define transaction boundaries. This provides two different options, a functional approach that allows you to run a lambda within the scope of a transaction, or by using explicit <code>begin</code>, <code>commit</code> and <code>rollback</code> methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import io.quarkus.narayana.jta.QuarkusTransaction;
import io.quarkus.narayana.jta.RunOptions;

public class TransactionExample {

    public void beginExample() {
        QuarkusTransaction.begin();
        //do work
        QuarkusTransaction.commit();

        QuarkusTransaction.begin(QuarkusTransaction.beginOptions()
                .timeout(10));
        //do work
        QuarkusTransaction.rollback();
    }

    public void lambdaExample() {
        QuarkusTransaction.run(() -&gt; {
            //do work
        });


        int result = QuarkusTransaction.call(QuarkusTransaction.runOptions()
                .timeout(10)
                .exceptionHandler((throwable) -&gt; {
                    if (throwable instanceof SomeException) {
                        return RunOptions.ExceptionResult.COMMIT;
                    }
                    return RunOptions.ExceptionResult.ROLLBACK;
                })
                .semantic(RunOptions.Semantic.SUSPEND_EXISTING), () -&gt; {
            //do work
            return 0;
        });
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above example shows a few different ways the API can be used. The first method simply calls begin, does some work and commits it. This created transaction is tied to the CDI request scope, so if it is still active when the request scope is destroyed then it will be automatically rolled back. This removes the need to explicitly catch exceptions and call <code>rollback</code>, and acts as a safety net against inadvertent transaction leaks, however it does mean that this can only be used when the request scope is active. The second example in the method calls begin with a timeout option, and then rolls back the transaction.</p>
</div>
<div class="paragraph">
<p>The second example shows the use of lambda scoped transactions, the first just runs a <code>Runnable</code> within a transaction, the second, runs <code>Callable</code> with some specific options. In particular the <code>exceptionHandler</code> method can be used to control if the transaction is rolled back or not on exception, and the <code>semantic</code> method controls the behaviour if an existing transaction is already started.</p>
</div>
<div class="paragraph">
<p>The following semantics are supported:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">DISALLOW_EXISTING</dt>
<dd>
<p>If a transaction is already associated with the current thread a <code>QuarkusTransactionException</code> will be thrown, otherwise a new transaction is started, and follows all the normal lifecycle rules.</p>
</dd>
<dt class="hdlist1">JOIN_EXISTING</dt>
<dd>
<p>If no transaction is active then a new transaction will be started, and committed when the method ends. If an exception is thrown the exception handler registered by <code>#exceptionHandler(Function)</code> will be called to decide if the TX should be committed or rolled back. If an existing transaction is active then the method is run in the context of the existing transaction. If an exception is thrown the exception handler will be called, however a result of <code>ExceptionResult#ROLLBACK</code> will result in the TX marked as rollback only, while a result of <code>ExceptionResult#COMMIT</code> will result in no action being taken.</p>
</dd>
<dt class="hdlist1">REQUIRE_NEW</dt>
<dd>
<p>This is the default semantic. If an existing transaction is already associated with the current thread then the transaction is suspended, and resumed once the current transaction is complete. A new transaction is started after the existing transaction is suspended, and follows all the normal lifecycle rules.</p>
</dd>
<dt class="hdlist1">SUSPEND_EXISTING</dt>
<dd>
<p>If no transaction is active then this semantic is basically a no-op. If a transaction is active then it is suspended, and resumed after the task is run. The exception handler will never be consulted when this semantic is in use, specifying both an exception handler and this semantic is considered an error. This semantic allows for code to easily be run outside the scope of a transaction.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="legacy-api-approach"><a class="anchor" href="#legacy-api-approach"></a>Legacy API approach</h3>
<div class="paragraph">
<p>The less easy way is to inject a <code>UserTransaction</code> and use the various transaction demarcation methods.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@ApplicationScoped
public class SantaClausService {

    @Inject ChildDAO childDAO;
    @Inject SantaClausDAO santaDAO;
    @Inject UserTransaction transaction;

    public void getAGiftFromSanta(Child child, String giftDescription) {
        // some transaction work
        try {
            transaction.begin();
            Gift gift = childDAO.addToGiftList(child, giftDescription);
            santaDAO.addToSantaTodoList(gift);
            transaction.commit();
        }
        catch(SomeException e) {
            // do something on Tx failure
            transaction.rollback();
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>You cannot use <code>UserTransaction</code> in a method having a transaction started by a <code>@Transactional</code> call.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="トランザクションタイムアウトの設定"><a class="anchor" href="#トランザクションタイムアウトの設定"></a>トランザクションタイムアウトの設定</h2>
<div class="sectionbody">
<div class="paragraph">
<p>デフォルトのトランザクション・タイムアウト、つまりトランザクション・マネージャーによって管理されるすべてのトランザクションに適用されるタイムアウトを、プロパティー <code>quarkus.transaction-manager.default-transaction-timeout</code> を使用して、期間として指定して構成することができます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>期間のフォーマットは標準の <code>java.time.Duration</code> フォーマットを使用します。詳細は <a href="https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html#parse-java.lang.CharSequence-">Duration#parse() javadoc</a> を参照してください。</p>
</div>
<div class="paragraph">
<p>数値で始まる期間の値を指定することもできます。この場合、値が数値のみで構成されている場合、コンバーターは値を秒として扱います。そうでない場合は、 <code>PT</code> が暗黙的に値の前に付加され、標準の <code>java.time.Duration</code> 形式が得られます。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>デフォルト値は60秒です。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="トランザクションノード名識別子の設定"><a class="anchor" href="#トランザクションノード名識別子の設定"></a>トランザクションノード名識別子の設定</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Narayanaは、基礎となるトランザクションマネージャーであり、一意のノード識別子の概念を持っています。これは、複数のリソースを含む XA トランザクションの使用を検討している場合に重要です。</p>
</div>
<div class="paragraph">
<p>ノード名識別子はトランザクションの識別において重要な役割を果たします。ノード名識別子は、トランザクションが作成されるときに、トランザクションIDの作成に使用されます。ノード名識別子に基づいて、トランザクションマネージャーはデータベースまたはJMSブローカに作成されたXAトランザクションのカウンターパートを認識することができます。この識別子により、トランザクションマネージャーはリカバリ中にトランザクションのカウンターパートをロールバックすることが可能になる。</p>
</div>
<div class="paragraph">
<p>ノード名識別子は、トランザクションマネージャーのデプロイメントごとに一意である必要があります。また、ノード識別子はトランザクションマネージャーの再起動時に変化しない必要があります。</p>
</div>
<div class="paragraph">
<p>ノード名識別子は、プロパティー <code>quarkus.transaction-manager.node-name</code> を通じて設定することができます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="なぜ常にトランザクションマネージャーを持っているのか"><a class="anchor" href="#なぜ常にトランザクションマネージャーを持っているのか"></a>なぜ常にトランザクションマネージャーを持っているのか?</h2>
<div class="sectionbody">
<div class="dlist">
<dl>
<dt class="hdlist1">使いたいところなら、どこでも使えるのでしょうか？</dt>
<dd>
<p>はい、Quarkusアプリケーションでも、IDEでも、テストでも動作します。JTAは一部の人に悪評があります。なぜかはわかりません。これはあなたのおじいちゃんのJTA実装ではないとは言っておきましょう。私たちが持っているものは、完全に埋め込み可能で無駄がありません。</p>
</dd>
<dt class="hdlist1">それは2フェーズコミットを行い、私のアプリの速度を遅くしますか?</dt>
<dd>
<p>いや、これは昔話です。基本的にはフリーで提供され、必要に応じて複数のデータソースを含むより複雑なケースにも対応できると考えてください。</p>
</dd>
<dt class="hdlist1">読み込み専用の操作をするときにはトランザクションはいらないので、その方が早いですね。</dt>
<dd>
<p>誤りです。+ まず第一に、トランザクションの境界を <code>@Transactional(NOT_SUPPORTED)</code> (または <code>NEVER</code> または <code>SUPPORTS</code> ) でマークすることで、トランザクションを無効にしてください。+ 第二に、トランザクションを使用しない方が速いというのは、またしてもおとぎ話です。答えは、それはあなたのDBと、あなたが行っているSQL SELECTの数に依存します。トランザクションを使用しないということは、DBはいずれにしても単一操作のトランザクションコンテキストを持っていることを意味します。+ 第三に、複数のSELECTを実行する場合は、それらを一つのトランザクションにまとめる方が良いでしょう。あなたのDBがあなたの車のダッシュボードを表しているとしましょう、あなたは残りのキロ数と燃料計のレベルを見ることができます。それを1つのトランザクションで読み取ることで、それらは一貫したものになります。一方ともう一方を2つの異なるトランザクションから読み取った場合、それらは一貫性のないものになる可能性があります。例えば、権限やアクセス管理に関連するデータを読むと、より劇的になることもあります。</p>
</dd>
<dt class="hdlist1">Hibernateのトランザクション管理APIではなくJTAを好む理由</dt>
<dd>
<p><code>entityManager.getTransaction().begin()</code> やその類似を経由して手動でトランザクションを管理すると、最終的に人々が間違えるような試行回数の多い醜いコードになってしまいます。トランザクションはまた、JMSと他のデータベースアクセスについてですので、1つのAPIはより多くの理にかなっています。</p>
</dd>
<dt class="hdlist1">私のJPA永続化ユニットが <code>JTA</code> を使っているのか <code>Resource-level</code> トランザクションを使っているのかわからないので、めちゃくちゃです。</dt>
<dd>
<p>Quarkusではごちゃごちゃしていません :)リソースレベルは、管理されていない環境でJPAをサポートするために導入されました。しかし、Quarkusはリーン環境であると同時にマネージド環境でもあるので、常にJTAモードになっていると思っておけば安心です。結局、Java SEモードでHibernate ORM + CDI + トランザクションマネージャーを実行することの難しさはQuarkusで解決されています。</p>
</dd>
</dl>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus はオープンです。このプロジェクトの全ての依存関係は<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>または互換性のあるライセンスの元で利用出来ます。<br /><br />このウェブサイトは <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> で構築されており、<a href='https://pages.github.com/' target='_blank'>Github Pages</a>にホストされており、完全にオープンソースです。改善したい場合、 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>ウェブサイトをフォークし</a>、修正してみせてください。</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
            <li><a href="/">ホーム</a></li>
          
            <li><a href="/about">Quarkusについて</a></li>
          
            <li><a href="/blog">ブログ</a></li>
          
            <li><a href="/insights">ポッドキャスト</a></li>
          
            <li><a href="/events">イベント</a></li>
          
            <li><a href="/newsletter">ニュースレター</a></li>
          
            <li><a href="/publications">出版</a></li>
          
            <li><a href="/awards">受賞</a></li>
          
            <li><a href="/security">セキュリティポリシー</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォロー</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
            <li><a href="/support">サポート</a></li>
          
            <li><a href="/guides">ガイド</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入門</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">ディスカッション</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">開発メーリングリスト</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://ja.quarkus.io/">Japanese</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">等々...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
