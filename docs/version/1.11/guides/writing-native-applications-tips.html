<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Tips for writing native applications - 1.11</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/1.11/guides/writing-native-applications-tips" />
  <meta property="og:title" content="Quarkus - Tips for writing native applications - 1.11" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/writing-native-applications-tips">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Quarkusとは <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/continuum" class="">リアクティブ</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学ぶ<i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ガイド</a></li>
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">コミュニティ <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="/publications" class="">出版物</a></li>
          <li><a href="/awards" class="">受賞</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >ENGLISH</a></li>
          <li><a href="https://ja.quarkus.io/">JAPANESE</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/version/1.11/guides/"> Back to Guides</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">Select Guide Version</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" >2.9 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" >2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" >2.2</option>
        
        
      
        
        
        
        
          
        <option value="1.11" selected>1.11</option>
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">Quarkus - Tips for writing native applications </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#アプリケーションでのネイティブのサポート">アプリケーションでのネイティブのサポート</a>
<ul class="sectlevel2">
<li><a href="#リソースを含む">リソースを含む</a></li>
<li><a href="#リフレクションのための登録">リフレクションのための登録</a></li>
<li><a href="#クラスの初期化を遅らせる">クラスの初期化を遅らせる</a></li>
<li><a href="#プロキシークラスの管理">プロキシークラスの管理</a></li>
</ul>
</li>
<li><a href="#native-in-extension">Supporting native in a Quarkus extension</a>
<ul class="sectlevel2">
<li><a href="#リフレクションの登録">リフレクションの登録</a></li>
<li><a href="#alternative-with-registerforreflection">Alternative with @RegisterForReflection</a></li>
<li><a href="#リソースを含む-2">リソースを含む</a></li>
</ul>
</li>
<li><a href="#クラスの初期化を遅らせる-2">クラスの初期化を遅らせる</a>
<ul class="sectlevel2">
<li><a href="#プロキシークラスの管理-2">プロキシークラスの管理</a></li>
<li><a href="#ネイティブイメージでのロギング">ネイティブイメージでのロギング</a></li>
</ul>
</li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このガイドには、Java アプリケーションをネイティブ実行可能ファイルとして実行しようとしたときに発生する可能性のある問題を回避するためのさまざまなヒントやコツが記載されています。</p>
</div>
<div class="paragraph">
<p>適用されるソリューションが異なる可能性のある 2 つの文脈を区別していることに注意してください。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>アプリケーションのコンテキストでは、<code>pom.xml</code> を変更した <code>native-image</code> 設定に依存することになります。</p>
</li>
<li>
<p>エクステンションのコンテキストでは、Quarkus はこれらすべてを簡素化するための多くのインフラストラクチャーを提供しています。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>コンテキストに応じて適切なセクションを参照してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="アプリケーションでのネイティブのサポート"><a class="anchor" href="#アプリケーションでのネイティブのサポート"></a>アプリケーションでのネイティブのサポート</h2>
<div class="sectionbody">
<div class="paragraph">
<p>GraalVM は多くの制約を課しており、アプリケーションをネイティブ実行可能なものにするには、いくつかの調整が必要になるかもしれません。</p>
</div>
<div class="sect2">
<h3 id="リソースを含む"><a class="anchor" href="#リソースを含む"></a>リソースを含む</h3>
<div class="paragraph">
<p>デフォルトでは、ネイティブ実行可能ファイルをビルドする際に、GraalVM はクラスパス上にあるリソースを、作成するネイティブ実行可能ファイルには含めません。ネイティブ実行可能ファイルの一部となるリソースは、明示的に設定する必要があります。</p>
</div>
<div class="paragraph">
<p>Quarkus では、<code>META-INF/resources</code> (Web リソース) にあるリソースが自動的に含まれていますが、このディレクトリー以外の場所では自己責任でお願いします。</p>
</div>
<div class="paragraph">
<p>To include more resources in the native executable, create a <code>resources-config.json</code> (the most common location is within <code>src/main/resources</code>) JSON file defining which resources should be included:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">{
  "resources": [
    {
      "pattern": ".*\\.xml$"
    },
    {
      "pattern": ".*\\.json$"
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>このパターンは有効な Java 正規表現です。ここでは、すべての XML ファイルと JSONファイル をネイティブ実行可能ファイルに含めています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>このトピックの詳細については、https://github.com/oracle/graal/blob/master/substratevm/Resources.md[GraalVM ドキュメント] を参照してください。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>最後にやるべきことは、<code>application.properties</code> に適切な設定を追加して、設定ファイルを <code>native-image</code> 実行ファイルに知らせることです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.native.additional-build-args =-H:ResourceConfigurationFiles=resources-config.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>前のスニペットでは、<code>src/main/resources</code> に追加されたため、ファイルのパス全体を指定するのではなく、単に <code>resources-config.json</code> を使用することができました。ファイルが別のディレクトリーに追加されていた場合は、適切なファイルパスを手動で指定する必要がありました。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>複数のオプションはカンマで区切ることができます。例えば、次のように使用することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.native.additional-build-args =\
    -H:ResourceConfigurationFiles=resources-config.json,\
    -H:ReflectionConfigurationFiles=reflection-config.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>さまざまなリソースが含まれており、追加のリフレクションが登録されていることを確認するため。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>何らかの理由で <code>application.properties</code> に前述の構成を追加することが望ましくない場合には、ビルドツールで効果的に同様の操作を行うように構成することも可能です。</p>
</div>
<div class="paragraph">
<p>Maven を使用する場合は、以下のような構成にすることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profiles&gt;
    &lt;profile&gt;
        &lt;id&gt;native&lt;/id&gt;
        &lt;properties&gt;
            &lt;quarkus.package.type&gt;native&lt;/quarkus.package.type&gt;
            &lt;quarkus.native.additional-build-args&gt;-H:ResourceConfigurationFiles=resources-config.json&lt;/quarkus.native.additional-build-args&gt;
        &lt;/properties&gt;
    &lt;/profile&gt;
&lt;/profiles&gt;</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="リフレクションのための登録"><a class="anchor" href="#リフレクションのための登録"></a>リフレクションのための登録</h3>
<div class="paragraph">
<p>ネイティブ実行可能ファイルを構築する際、GraalVM はクローズな環境を想定して動作します。これは、コールツリーを解析し、直接使用しないクラス/メソッド/フィールドをすべて削除します。</p>
</div>
<div class="paragraph">
<p>リフレクションで使用される要素はコールツリーの一部ではないので、デッドコードとして排除されます (他のケースでは直接呼び出されない場合)。ネイティブ実行可能ファイルにこれらの要素を含めるには、リフレクションに明示的に登録する必要があります。</p>
</div>
<div class="paragraph">
<p>これは、JSONライブラリがリフレクションを使用してオブジェクトをJSONにシリアライズするのが一般的なので、非常によくあるケースです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    public class Person {
        private String first;
        private String last;

        public String getFirst() {
            return first;
        }

        public void setFirst(String first) {
            this.first = first;
        }

        public String getLast() {
            return last;
        }

        public void setValue(String last) {
            this.last = last;
        }
    }

    @Path("/person")
    @Produces(MediaType.APPLICATION_JSON)
    @Consumes(MediaType.APPLICATION_JSON)
    public class PersonResource {

        private final Jsonb jsonb;

        public PersonResource() {
            jsonb = JsonbBuilder.create(new JsonbConfig());
        }

        @GET
        public Response list() {
            return Response.ok(jsonb.fromJson("{\"first\":  \"foo\", \"last\":  \"bar\"}", Person.class)).build();
        }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記のコードを使用した場合、ネイティブ実行可能ファイルを使用すると以下のような例外が発生します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Exception handling request to /person: org.jboss.resteasy.spi.UnhandledException: javax.json.bind.JsonbException: Can't create instance of a class: class org.acme.jsonb.Person, No default constructor found</code></pre>
</div>
</div>
<div class="paragraph">
<p>または Jackson を使用している場合。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">com.fasterxml.jackson.databind.exc.InvalidDefinitionException: No serializer found for class org.acme.jsonb.Person and no properties discovered to create BeanSerializer (to avoid exception, disable SerializationFeature.FAIL_ON_EMPTY_BEANS)</code></pre>
</div>
</div>
<div class="paragraph">
<p>さらに厄介なのは、例外がスローされずに JSON の結果が完全に空になってしまうことです。</p>
</div>
<div class="paragraph">
<p>このタイプの問題を解決するには、2 つの方法があります。</p>
</div>
<div class="sect3">
<h4 id="registerforreflection-アノテーションの使用"><a class="anchor" href="#registerforreflection-アノテーションの使用"></a>@RegisterForReflection アノテーションの使用</h4>
<div class="paragraph">
<p>リフレクション用のクラスを登録する最も簡単な方法は、<code>@RegisterForReflection</code> アノテーションを使用することです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@RegisterForReflection
public class MyClass {
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="設定ファイルの使用"><a class="anchor" href="#設定ファイルの使用"></a>設定ファイルの使用</h4>
<div class="paragraph">
<p>Obviously, adding <code>@RegisterForReflection</code> is not possible if the class is in a third-party jar.</p>
</div>
<div class="paragraph">
<p>In this case, you can use a configuration file to register classes for reflection.</p>
</div>
<div class="paragraph">
<p>例えば、クラス <code>com.acme.MyClass</code> のすべてのメソッドをリフレクションのために登録するには、<code>reflection-config.json</code> を作成します (最も一般的な場所は <code>src/main/resources</code> の中です)。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-json hljs" data-lang="json">[
  {
    "name" : "com.acme.MyClass",
    "allDeclaredConstructors" : true,
    "allPublicConstructors" : true,
    "allDeclaredMethods" : true,
    "allPublicMethods" : true,
    "allDeclaredFields" : true,
    "allPublicFields" : true
  }
]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>このファイルのフォーマットの詳細については、https://github.com/oracle/graal/blob/master/substratevm/Reflection.md[GraalVMドキュメント] を参照してください。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>最後にやるべきことは、<code>application.properties</code> に適切な設定を追加して、設定ファイルを <code>native-image</code> 実行ファイルに知らせることです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.native.additional-build-args =-H:ReflectionConfigurationFiles=reflection-config.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>前のスニペットでは、<code>src/main/resources</code> に追加されたため、ファイルのパス全体を指定するのではなく、単に <code>reflection-config.json</code> を使用することができました。ファイルが別のディレクトリーに追加されていた場合は、適切なファイルパスを手動で指定する必要がありました。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>複数のオプションはカンマで区切ることができます。例えば、次のように使用することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.native.additional-build-args =\
    -H:ResourceConfigurationFiles=resources-config.json,\
    -H:ReflectionConfigurationFiles=reflection-config.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>さまざまなリソースが含まれており、追加のリフレクションが登録されていることを確認するため。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>何らかの理由で <code>application.properties</code> に前述の構成を追加することが望ましくない場合には、ビルドツールで効果的に同様の操作を行うように構成することも可能です。</p>
</div>
<div class="paragraph">
<p>Maven を使用する場合は、以下のような構成にすることができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;profiles&gt;
    &lt;profile&gt;
        &lt;id&gt;native&lt;/id&gt;
        &lt;properties&gt;
            &lt;quarkus.package.type&gt;native&lt;/quarkus.package.type&gt;
            &lt;quarkus.native.additional-build-args&gt;-H:ReflectionConfigurationFiles=reflection-config.json&lt;/quarkus.native.additional-build-args&gt;
        &lt;/properties&gt;
    &lt;/profile&gt;
&lt;/profiles&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="クラスの初期化を遅らせる"><a class="anchor" href="#クラスの初期化を遅らせる"></a>クラスの初期化を遅らせる</h3>
<div class="paragraph">
<p>デフォルトでは、Quarkus はビルド時にすべてのクラスを初期化します。</p>
</div>
<div class="paragraph">
<p>特定のクラスの初期化が静的ブロックで行われる場合、実行時に延期する必要がある場合があります。通常、このような設定を省略すると、以下のような実行時例外が発生します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">Error: No instances are allowed in the image heap for a class that is initialized or reinitialized at image runtime: sun.security.provider.NativePRNG
Trace: object java.security.SecureRandom
method com.amazonaws.services.s3.model.CryptoConfiguration.&lt;init&gt;(CryptoMode)
Call path from entry point to com.amazonaws.services.s3.model.CryptoConfiguration.&lt;init&gt;(CryptoMode):</code></pre>
</div>
</div>
<div class="paragraph">
<p>クラスの初期化を遅らせる必要がある場合は、<code>--initialize-at-run-time=&lt;package or class&gt;</code> 設定ノブを使用します。</p>
</div>
<div class="paragraph">
<p>上記の例のように、<code>quarkus.native.additional-build-args</code> 設定プロパティーを使用して <code>native-image</code> 設定に追加する必要があります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>これらすべてについての詳細な情報は、https://github.com/oracle/graal/blob/master/substratevm/ClassInitialization.md[GraalVMのドキュメント] を参照してください。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>quarkus.native.additional-build-args</code> 設定プロパティーを介して複数のクラスやパッケージを指定する必要がある場合は、<code>,</code> シンボルをエスケープする必要があります。その例を以下に示します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.native.additional-build-args=--initialize-at-run-time=com.example.SomeClass\\,org.acme.SomeOtherClass</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>application.properties</code> の代わりに Maven 設定を使用する場合。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;quarkus.native.additional-build-args&gt;--initialize-at-run-time=com.example.SomeClass\,org.acme.SomeOtherClass&lt;/quarkus.native.additional-build-args&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="プロキシークラスの管理"><a class="anchor" href="#プロキシークラスの管理"></a>プロキシークラスの管理</h3>
<div class="paragraph">
<p>ネイティブアプリケーションを書く際には、実装するインターフェースのリストを指定して、イメージのビルド時にプロキシークラスを定義する必要があります。</p>
</div>
<div class="paragraph">
<p>このような状況では、以下のようなエラーが発生します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">com.oracle.svm.core.jdk.UnsupportedFeatureError: Proxy class defined by interfaces [interface org.apache.http.conn.HttpClientConnectionManager, interface org.apache.http.pool.ConnPoolControl, interface com.amazonaws.http.conn.Wrapped] not found. Generating proxy classes at runtime is not supported. Proxy classes need to be defined at image build time by specifying the list of interfaces that they implement. To define proxy classes use -H:DynamicProxyConfigurationFiles=&lt;comma-separated-config-files&gt; and -H:DynamicProxyConfigurationResources=&lt;comma-separated-config-resources&gt; options.</code></pre>
</div>
</div>
<div class="paragraph">
<p>この問題を解決するには、<code>-H:DynamicProxyConfigurationResources=&lt;comma-separated-config-resources&gt;</code> オプションを追加し、ダイナミックプロキシー設定ファイルを提供する必要があります。このファイルのフォーマットについては、https://github.com/oracle/graal/blob/master/substratevm/DynamicProxy.md#manual-configuration[GraalVMのドキュメント] を参照してください。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="native-in-extension"><a class="anchor" href="#native-in-extension"></a>Supporting native in a Quarkus extension</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus のエクステンションでのネイティブのサポートは、Quarkus がこれらすべてを単純化するための多くのツールを提供しているため、さらに簡単になりました。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>ここで説明したことはすべて、Quarkus エクステンションのコンテキストでのみ機能し、アプリケーションでは機能しません。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="リフレクションの登録"><a class="anchor" href="#リフレクションの登録"></a>リフレクションの登録</h3>
<div class="paragraph">
<p>Quarkus では、<code>ReflectiveClassBuildItem</code> を使用することで、エクステンションへのリフレクションの登録が簡単になり、JSON 設定ファイルが不要になります。</p>
</div>
<div class="paragraph">
<p>リフレクション用のクラスを登録するには、Quarkus プロセッサークラスを作成し、リフレクションを登録するビルドステップを追加する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class SaxParserProcessor {

    @BuildStep
    ReflectiveClassBuildItem reflection() {
        // since we only need reflection to the constructor of the class, we can specify `false` for both the methods and the fields arguments.
        return new ReflectiveClassBuildItem(false, false, "com.sun.org.apache.xerces.internal.parsers.SAXParser");
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>GraalVM でのリフレクションの詳細は、https://github.com/oracle/graal/blob/master/substratevm/Reflection.md[こちら] をご覧ください。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="alternative-with-registerforreflection"><a class="anchor" href="#alternative-with-registerforreflection"></a>Alternative with @RegisterForReflection</h3>
<div class="paragraph">
<p>As for applications, you can also use the <code>@RegisterForReflection</code> annotation if the class is in your extension and not in a third-party jar.</p>
</div>
</div>
<div class="sect2">
<h3 id="リソースを含む-2"><a class="anchor" href="#リソースを含む-2"></a>リソースを含む</h3>
<div class="paragraph">
<p>エクステンションのコンテキストでは、Quarkus は、エクステンションの作成者が <code>NativeImageResourceBuildItem</code> .NET Frameworkを指定できるようにすることで、JSON 設定ファイルの必要性を排除しています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class ResourcesProcessor {

    @BuildStep
    NativeImageResourceBuildItem nativeImageResourceBuildItem() {
        return new NativeImageResourceBuildItem("META-INF/extra.properties");
    }

}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>ネイティブ実行可能ファイルでのGraalVMリソースの取り扱いについての詳細は、https://github.com/oracle/graal/blob/master/substratevm/Resources.md[GraalVM ドキュメント]を参照してください。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="クラスの初期化を遅らせる-2"><a class="anchor" href="#クラスの初期化を遅らせる-2"></a>クラスの初期化を遅らせる</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus では、エクステンションの作成者が簡単に <code>RuntimeInitializedClassBuildItem</code> を登録できるようにすることで、物事を簡素化しています。簡単な例としては、次のようなものが考えられます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class S3Processor {

    @BuildStep
    RuntimeInitializedClassBuildItem cryptoConfiguration() {
        return new RuntimeInitializedClassBuildItem(CryptoConfiguration.class.getCanonicalName());
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>このような構文を使用すると、 <code>--initialize-at-run-time</code> オプションが自動的に <code>native-image</code> コマンドラインに追加されることを意味します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>--initialize-at-run-time</code> の詳細は、https://github.com/oracle/graal/blob/master/substratevm/ClassInitialization.md[GraalVM のドキュメント] をお読みください。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="プロキシークラスの管理-2"><a class="anchor" href="#プロキシークラスの管理-2"></a>プロキシークラスの管理</h3>
<div class="paragraph">
<p>同様に、Quarkus では、エクステンションの作成者が <code>NativeImageProxyDefinitionBuildItem</code> を登録することができます。その例としては、以下のようなものがあります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">public class S3Processor {

    @BuildStep
    NativeImageProxyDefinitionBuildItem httpProxies() {
        return new NativeImageProxyDefinitionBuildItem("org.apache.http.conn.HttpClientConnectionManager",
                "org.apache.http.pool.ConnPoolControl", "com.amazonaws.http.conn.Wrapped");
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>このような構文を使用すると、<code>-H:DynamicProxyConfigurationResources</code> オプションが自動的に <code>native-image</code> コマンドラインに追加されることを意味します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>プロキシークラスの詳細は、https://github.com/oracle/graal/blob/master/substratevm/DynamicProxy.md[GraalVMのドキュメント] を参照してください。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="ネイティブイメージでのロギング"><a class="anchor" href="#ネイティブイメージでのロギング"></a>ネイティブイメージでのロギング</h3>
<div class="paragraph">
<p>Apache Commons Logging や Log4j などのロギングコンポーネントを必要とする依存関係を使用していて、ネイティブ実行可能ファイルをビルドする際に <code>ClassNotFoundException</code> が発生する場合、ロギングライブラリーを除外し、対応する JBoss Logging アダプターを追加することで解決できます。</p>
</div>
<div class="paragraph">
<p>詳細は、<a href="logging#logging-adapters">ロギングガイド</a> をご覧ください。</p>
</div>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus はオープンです。このプロジェクトの全ての依存関係は<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>または互換性のあるライセンスの元で利用出来ます。<br /><br />このウェブサイトは <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> で構築されており、<a href='https://pages.github.com/' target='_blank'>Github Pages</a>にホストされており、完全にオープンソースです。改善したい場合、 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>ウェブサイトをフォークし</a>、修正してみせてください。</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
            <li><a href="/">ホーム</a></li>
          
            <li><a href="/about">Quarkusについて</a></li>
          
            <li><a href="/blog">ブログ</a></li>
          
            <li><a href="/insights">ポッドキャスト</a></li>
          
            <li><a href="/events">イベント</a></li>
          
            <li><a href="/newsletter">ニュースレター</a></li>
          
            <li><a href="/publications">出版</a></li>
          
            <li><a href="/awards">受賞</a></li>
          
            <li><a href="/security">セキュリティポリシー</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォロー</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
            <li><a href="/support">サポート</a></li>
          
            <li><a href="/guides">ガイド</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入門</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">ディスカッション</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">開発メーリングリスト</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://ja.quarkus.io/">Japanese</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">等々...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
