<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Micrometer Metrics - 1.11</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/1.11/guides/micrometer" />
  <meta property="og:title" content="Quarkus - Micrometer Metrics - 1.11" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/micrometer">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Quarkusとは <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/continuum" class="">リアクティブ</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学ぶ<i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ガイド</a></li>
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">コミュニティ <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="/publications" class="">出版物</a></li>
          <li><a href="/awards" class="">受賞</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >ENGLISH</a></li>
          <li><a href="https://ja.quarkus.io/">JAPANESE</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/version/1.11/guides/"> Back to Guides</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">Select Guide Version</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" >2.9 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" >2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" >2.2</option>
        
        
      
        
        
        
        
          
        <option value="1.11" selected>1.11</option>
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">Quarkus - Micrometer Metrics </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#前提条件">前提条件</a></li>
<li><a href="#アーキテクチャ">アーキテクチャ</a></li>
<li><a href="#ソリューション">ソリューション</a></li>
<li><a href="#creating-the-maven-project">Creating the Maven Project</a></li>
<li><a href="#アプリケーションの記述">アプリケーションの記述</a></li>
<li><a href="#アプリケーションの実行と使用">アプリケーションの実行と使用</a>
<ul class="sectlevel2">
<li><a href="#メトリクスの値を生成する">メトリクスの値を生成する</a></li>
<li><a href="#生成されたメトリクスを確認する">生成されたメトリクスを確認する</a></li>
</ul>
</li>
<li><a href="#using-meterfilter-to-configure-metrics">Using MeterFilter to configure metrics</a></li>
<li><a href="#他のレジストリー実装の使用">他のレジストリー実装の使用</a></li>
<li><a href="#カスタマイズされたmeterregistryの作成">カスタマイズされたMeterRegistryの作成</a></li>
<li><a href="#support-for-the-microprofile-metrics-api">Support for the MicroProfile Metrics API</a></li>
<li><a href="#設定リファレンス">設定リファレンス</a></li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このガイドでは、QuarkusアプリケーションがランタイムメトリクスとアプリケーションメトリクスのためにMicrometerメトリクスライブラリを利用する方法を説明します。</p>
</div>
<div class="paragraph">
<p>このガイドで説明するアプリケーション固有のメトリクスとは別に、Quarkusのさまざまなエクステンションによって公開されているビルトインメトリクスを利用することもできます。これらについては、ビルトインメトリクスをサポートしている各エクステンションのガイドで説明します。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Micrometerは、Quarkusのメトリクスとして推奨されるアプローチです。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="前提条件"><a class="anchor" href="#前提条件"></a>前提条件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このガイドを完成させるには、以下が必要です:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>less than 15 minutes</p>
</li>
<li>
<p>IDE</p>
</li>
<li>
<p>JDK 1.8+ がインストールされ、 <code>JAVA_HOME</code> が適切に設定されていること</p>
</li>
<li>
<p>Apache Maven 3.6.2+</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="アーキテクチャ"><a class="anchor" href="#アーキテクチャ"></a>アーキテクチャ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>この例では、1つのRESTエンドポイントを提供し、数値が素数かどうかを判定する非常にシンプルなマイクロサービスを構築します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ソリューション"><a class="anchor" href="#ソリューション"></a>ソリューション</h2>
<div class="sectionbody">
<div class="paragraph">
<p>次の章で紹介する手順に沿って、ステップを踏んでアプリを作成することをお勧めします。ただし、完成した例にそのまま進んでも構いません。</p>
</div>
<div class="paragraph">
<p>Gitレポジトリをクローンするか <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code> 、 <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">アーカイブ</a> をダウンロードします。</p>
</div>
<div class="paragraph">
<p>ソリューションは <code>micrometer-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/micrometer-quickstart">directory</a> にあります。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="creating-the-maven-project"><a class="anchor" href="#creating-the-maven-project"></a>Creating the Maven Project</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micrometerは、コアライブラリと、さまざまなモニタリングシステムをサポートする追加ライブラリのセットを定義しています。Quarkus Micrometerのエクステンションも同様に構成されています。 <code>quarkus-micrometer</code> は Micrometer コアのサポートとランタイムの統合を提供し、その他のサポートするQuarkusやQuarkiverseのエクステンションは、特定のモニタリングシステムをサポートするための追加の依存関係や要件を提供します。</p>
</div>
<div class="paragraph">
<p>この例では、Prometheus のレジストリーを使用します。</p>
</div>
<div class="paragraph">
<p>まず、新しいプロジェクトが必要です。以下のコマンドで新規プロジェクトを作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn io.quarkus:quarkus-maven-plugin:1.11.7.Final:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=micrometer-quickstart \
    -DclassName="org.acme.micrometer.PrimeNumberResource" \
    -Dpath="/" \
    -Dextensions="resteasy,micrometer-registry-prometheus"
cd micrometer-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>このコマンドは、 <code>micrometer-registry-prometheus</code> エクステンションを依存関係としてインポートする Maven プロジェクトを生成します。このエクステンションは、 <code>micrometer</code> エクステンションだけでなく、 Prometheus をサポートするために必要な追加のライブラリ依存関係もロードします。</p>
</div>
<div class="paragraph">
<p>すでにQuarkusプロジェクトが設定されている場合は、プロジェクトのベースディレクトリーで以下のコマンドを実行することで、プロジェクトに <code>micrometer-registry-prometheus</code> エクステンションを追加することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:add-extension -Dextensions="micrometer-registry-prometheus"</code></pre>
</div>
</div>
<div class="paragraph">
<p>これにより、 <code>pom.xml</code> に以下が追加されます:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-micrometer-registry-prometheus&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="アプリケーションの記述"><a class="anchor" href="#アプリケーションの記述"></a>アプリケーションの記述</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このアプリケーションは、数値が素数であるかどうかをチェックするアルゴリズムを実装した単一のクラスで構成されています。このアルゴリズムは REST インタフェースを介して公開されています。Micrometer エクステンションを有効にすると、すべての http サーバーのリクエストのメトリクスが自動的に収集されます。</p>
</div>
<div class="paragraph">
<p>これらのタイプのメトリクスがどのように機能するかを示すために、他にもいくつかのメトリクスを追加したいと考えています。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>素数が発見されるごとにカウンタがインクリメントされます。</p>
</li>
<li>
<p>ゲージには、発見された最高の素数が保存されます</p>
</li>
<li>
<p>タイマーは、素数が素数であるかどうかのテストに費やした時間を記録します。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.micrometer;

import io.micrometer.core.instrument.MeterRegistry;

import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.PathParam;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;
import java.util.concurrent.atomic.LongAccumulator;
import java.util.function.Supplier;

@Path("/")
public class PrimeNumberResource {

    private final LongAccumulator highestPrime = new LongAccumulator(Long::max, 0);
    private final MeterRegistry registry;

    PrimeNumberResource(MeterRegistry registry) {
        this.registry = registry;

        // Create a gauge that uses the highestPrimeNumberSoFar method
        // to obtain the highest observed prime number
        registry.gauge("prime.number.max", this,
                PrimeNumberResource::highestObservedPrimeNumber);
    }

    @GET
    @Path("/{number}")
    @Produces(MediaType.TEXT_PLAIN)
    public String checkIfPrime(@PathParam("number") long number) {
        if (number &lt; 1) {
            return "Only natural numbers can be prime numbers.";
        }
        if (number == 1) {
            return "1 is not prime.";
        }
        if (number == 2) {
            return "2 is prime.";
        }
        if (number % 2 == 0) {
            return number + " is not prime, it is divisible by 2.";
        }

        Supplier&lt;String&gt; supplier = () -&gt; {
            for (int i = 3; i &lt; Math.floor(Math.sqrt(number)) + 1; i = i + 2) {
                if (number % i == 0) {
                    return number + " is not prime, is divisible by " + i + ".";
                }
            }
            highestPrime.accumulate(number);
            return number + " is prime.";
        };

        return registry.timer("prime.number.test").wrap(supplier).get();
    }

    /**
     * This method is called by the registered {@code highest.prime.number} gauge.
     * @return the highest observed prime value
     */
    long highestObservedPrimeNumber() {
        return highestPrime.get();
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="アプリケーションの実行と使用"><a class="anchor" href="#アプリケーションの実行と使用"></a>アプリケーションの実行と使用</h2>
<div class="sectionbody">
<div class="paragraph">
<p>マイクロサービスをdevモードで実行するには、次のようにします。 <code>./mvnw clean compile quarkus:dev</code></p>
</div>
<div class="sect2">
<h3 id="メトリクスの値を生成する"><a class="anchor" href="#メトリクスの値を生成する"></a>メトリクスの値を生成する</h3>
<div class="paragraph">
<p>まず、ある数が素数であるかどうかをエンドポイントに問います。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl localhost:8080/350</code></pre>
</div>
</div>
<div class="paragraph">
<p>アプリでは、350は2で割れるので素数ではないと回答します。</p>
</div>
<div class="paragraph">
<p>次に、テストにもう少し時間がかかるように、いくらか大きな素数で実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">curl localhost:8080/629521085409773</code></pre>
</div>
</div>
<div class="paragraph">
<p>アプリは629521085409773が素数であることを回答します。お好みで、好きな番号でもう何回か呼び出してみてください。</p>
</div>
</div>
<div class="sect2">
<h3 id="生成されたメトリクスを確認する"><a class="anchor" href="#生成されたメトリクスを確認する"></a>生成されたメトリクスを確認する</h3>
<div class="paragraph">
<p>メトリクスを表示するには、 <code>curl localhost:8080/q/metrics/</code> を実行します。</p>
</div>
<div class="paragraph">
<p>Prometheusフォーマットのメトリクスは、プレーンテキストで順不同に返されます。</p>
</div>
<div class="paragraph">
<p>上のアプリケーションには、ある数字が素数かどうかを判断するのにかかった時間を測定するカスタムゲージが1つだけあります。Micrometerエクステンションでは、システム、JVM、httpのメトリクスを追加することができます。収集されたメトリクスの一部を以下に示します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text"># HELP http_server_requests_seconds
# TYPE http_server_requests_seconds summary
http_server_requests_seconds_count{method="GET",outcome="SUCCESS",status="200",uri="/{number}",} 4.0
http_server_requests_seconds_sum{method="GET",outcome="SUCCESS",status="200",uri="/{number}",} 0.041501773
# HELP http_server_requests_seconds_max
# TYPE http_server_requests_seconds_max gauge
http_server_requests_seconds_max{method="GET",outcome="SUCCESS",status="200",uri="/{number}",} 0.038066359
# HELP jvm_threads_peak_threads The peak live thread count since the Java virtual machine started or peak was reset
# TYPE jvm_threads_peak_threads gauge
jvm_threads_peak_threads 56.0
# HELP http_server_connections_seconds_max
# TYPE http_server_connections_seconds_max gauge
http_server_connections_seconds_max 0.102580737
# HELP http_server_connections_seconds
# TYPE http_server_connections_seconds summary
http_server_connections_seconds_active_count 5.0
http_server_connections_seconds_duration_sum 0.175032815
# HELP system_load_average_1m The sum of the number of runnable entities queued to available processors and the number of runnable entities running on the available processors averaged over a period of time
# TYPE system_load_average_1m gauge
system_load_average_1m 2.4638671875
# HELP http_server_bytes_written_max
# TYPE http_server_bytes_written_max gauge
http_server_bytes_written_max 39.0
# HELP http_server_bytes_written
# TYPE http_server_bytes_written summary
http_server_bytes_written_count 4.0
http_server_bytes_written_sum 99.0
# HELP jvm_classes_loaded_classes The number of classes that are currently loaded in the Java virtual machine
# TYPE jvm_classes_loaded_classes gauge
jvm_classes_loaded_classes 9341.0
# HELP prime_number_max
# TYPE prime_number_max gauge
prime_number_max 887.0
# HELP jvm_info JVM version info
# TYPE jvm_info gauge
jvm_info{runtime="OpenJDK Runtime Environment",vendor="Oracle Corporation",version="13.0.2+8",} 1.0
# HELP jvm_classes_unloaded_classes_total The total number of classes unloaded since the Java virtual machine has started execution
# TYPE jvm_classes_unloaded_classes_total counter
jvm_classes_unloaded_classes_total 28.0
# HELP prime_number_test_seconds
# TYPE prime_number_test_seconds summary
prime_number_test_seconds_count 3.0
prime_number_test_seconds_sum 1.94771E-4
# HELP prime_number_test_seconds_max
# TYPE prime_number_test_seconds_max gauge
prime_number_test_seconds_max 1.76162E-4
# HELP http_server_bytes_read
# TYPE http_server_bytes_read summary
http_server_bytes_read_count 4.0
http_server_bytes_read_sum 0.0
# HELP http_server_bytes_read_max
# TYPE http_server_bytes_read_max gauge
http_server_bytes_read_max 0.0
# HELP jvm_threads_states_threads The current number of threads having NEW state
# TYPE jvm_threads_states_threads gauge
jvm_threads_states_threads{state="runnable",} 37.0
jvm_threads_states_threads{state="blocked",} 0.0
jvm_threads_states_threads{state="waiting",} 15.0
jvm_threads_states_threads{state="timed-waiting",} 4.0
jvm_threads_states_threads{state="new",} 0.0
jvm_threads_states_threads{state="terminated",} 0.0
# HELP jvm_buffer_memory_used_bytes An estimate of the memory that the Java virtual machine is using for this buffer pool
# TYPE jvm_buffer_memory_used_bytes gauge
jvm_buffer_memory_used_bytes{id="mapped",} 0.0
jvm_buffer_memory_used_bytes{id="direct",} 149521.0
# HELP jvm_memory_committed_bytes The amount of memory in bytes that is committed for the Java virtual machine to use
# TYPE jvm_memory_committed_bytes gauge
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'profiled nmethods'",} 1.1403264E7
jvm_memory_committed_bytes{area="heap",id="G1 Survivor Space",} 4194304.0
jvm_memory_committed_bytes{area="heap",id="G1 Old Gen",} 9.2274688E7
jvm_memory_committed_bytes{area="nonheap",id="Metaspace",} 4.9803264E7
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'non-nmethods'",} 2555904.0
jvm_memory_committed_bytes{area="heap",id="G1 Eden Space",} 6.9206016E7
jvm_memory_committed_bytes{area="nonheap",id="Compressed Class Space",} 6815744.0
jvm_memory_committed_bytes{area="nonheap",id="CodeHeap 'non-profiled nmethods'",} 2555904.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>メトリクスは遅延的に表示され、何かがアクセスしようとするまでエンドポイントのデータが表示されないことが多いことに注意してください。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="using-meterfilter-to-configure-metrics"><a class="anchor" href="#using-meterfilter-to-configure-metrics"></a>Using MeterFilter to configure metrics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Micrometerは <code>MeterFilter</code> インスタンスを使って、 <code>MeterRegistry</code> インスタンスが出力するメトリクスをカスタマイズします。 Micrometer エクステンションは、 <code>MeterFilter</code> のCDI Beanを検出して、 <code>MeterRegistry</code> インスタンスを初期化するときにそれを使います。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Singleton
public class CustomConfiguration {

    @ConfigProperty(name = "deployment.env")
    String deploymentEnv;

    /** Define common tags that apply only to a Prometheus Registry */
    @Produces
    @Singleton
    @MeterFilterConstraint(applyTo = PrometheusMeterRegistry.class)
    public MeterFilter configurePrometheusRegistries() {
        return MeterFilter.commonTags(Arrays.asList(
                Tag.of("registry", "prometheus")));
    }

    /** Define common tags that apply globally */
    @Produces
    @Singleton
    public MeterFilter configureAllRegistries() {
        return MeterFilter.commonTags(Arrays.asList(
                Tag.of("env", deploymentEnv)));
    }

    /** Enable histogram buckets for a specific timer */
    @Produces
    @Singleton
    public MeterFilter enableHistogram() {
        return new MeterFilter() {
            @Override
            public DistributionStatisticConfig configure(Meter.Id id, DistributionStatisticConfig config) {
                if(id.getName().startsWith("myservice")) {
                    return DistributionStatisticConfig.builder()
                        .percentiles(0.5, 0.95)     // median and 95th percentile, not aggregable
                        .percentilesHistogram(true) // histogram buckets (e.g. prometheus histogram_quantile)
                        .build()
                        .merge(config);
                }
                return config;
            }
        };
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>この例では、シングルトン CDI Beanは、2 つの異なる <code>MeterFilter</code> Beanを生成します。1 つは Prometheus <code>MeterRegistry</code> インスタンスのみに適用され ( <code>@MeterFilterConstraint</code> qualifier を使用)、もう 1 つはすべての <code>MeterRegistry</code> インスタンスに適用されます。アプリケーション構成プロパティーも注入され、タグ値として使用されます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="他のレジストリー実装の使用"><a class="anchor" href="#他のレジストリー実装の使用"></a>他のレジストリー実装の使用</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Prometheusを使用していない場合は、いくつかの選択肢があります。いくつかのMicrometerのレジストリーの実装は、 <a href="https://github.com/quarkiverse/quarkiverse-micrometer-registry">Quarkiverseのエクステンション</a> でラップされています。たとえば、Micrometer StackDriver MeterRegistryを使用するには、 <code>quarkiverse-micrometer-registry-stackdriver</code> エクステンションを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkiverse&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-micrometer-registry-stackdriver&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用したい Micrometer レジストリに関連する拡張機能がまだない場合は、 <code>quarkus-micrometer</code> エクステンションを使用して、パッケージ化された MeterRegistry の依存関係を直接取り込んでください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-micrometer&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.acme&lt;/groupId&gt;
    &lt;artifactId&gt;custom-micrometer-registry&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>次に、次のセクションで説明するように、MeterRegistry を設定して初期化するために、独自のプロバイダを指定する必要があります。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="カスタマイズされたmeterregistryの作成"><a class="anchor" href="#カスタマイズされたmeterregistryの作成"></a>カスタマイズされたMeterRegistryの作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>必要に応じて、カスタム <code>@Produces</code> メソッドを使用して、カスタマイズされた <code>MeterRegistry</code> を作成して設定します。</p>
</div>
<div class="paragraph">
<p>以下の例では、StatsDで使用される行フォーマットをカスタマイズしています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Produces
@Singleton
public StatsdMeterRegistry createStatsdMeterRegistry(StatsdConfig statsdConfig, Clock clock) {
    // define what to do with lines
    Consumer&lt;String&gt; lineLogger = line -&gt; logger.info(line);

    // inject a configuration object, and then customize the line builder
    return StatsdMeterRegistry.builder(statsdConfig)
          .clock(clock)
          .lineSink(lineLogger)
          .build();
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>この例は、Micrometerのドキュメントにある以下の指示に対応しています: <a href="https://micrometer.io/docs/registry/statsD#_customizing_the_metrics_sink" class="bare">https://micrometer.io/docs/registry/statsD#_customizing_the_metrics_sink</a></p>
</div>
<div class="paragraph">
<p>このメソッドは、 <code>MeterRegistry</code> の特定の型を <code>@Singleton</code> として返すことに注意してください。レジストリーを設定するために必要な設定属性を注入するには、MicroProfile Configを使用します。 <code>quarkiverse-micrometer-registry-statsd</code> のようなほとんどのMicrometerのレジストリーエクステンションでは、Quarkusの設定モデルと統合されたレジストリー固有の設定オブジェクトのプロデューサを定義しています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="support-for-the-microprofile-metrics-api"><a class="anchor" href="#support-for-the-microprofile-metrics-api"></a>Support for the MicroProfile Metrics API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>アプリケーションで MicroProfile Metrics API を使用している場合、Micrometer 拡張機能は、これらのメトリクスを Micrometer レジストリにマッピングするための適応レイヤーを作成します。2 つのシステム間の命名規則は変更されますが、MeterFilters を使用して名前やタグをダッシュボードが必要とするものに再マッピングすることができることに注意してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Produces
@Singleton
public MeterFilter renameApplicationMeters() {
    final String targetMetric = PrimeResource.class.getName() + ".highestPrimeNumberSoFar";

    return MeterFilter() {
        @Override
        public Meter.Id map(Meter.Id id) {
            // rename the specified metric (remove package), and drop the scope tag
            // you could also use this to prepend a scope tag (application, base, vendor, if present) to the metric name
            if (id.getName().equals(targetMetric)) {
                List&lt;Tag&gt; tags = id.getTags().stream().filter(x -&gt; !"scope".equals(x.getKey()))
                        .collect(Collectors.toList());
                return id.withName("highestPrimeNumberSoFar").replaceTags(tags);
            }
            return id;
        }
    };
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
MP Metrics API互換性レイヤは、将来的には別のエクステンションに移される予定です。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="設定リファレンス"><a class="anchor" href="#設定リファレンス"></a>設定リファレンス</h2>
<div class="sectionbody">
<div class="paragraph configuration-legend">
<p><span class="icon"><i class="fa fa-lock" title="ビルド時に固定"></i></span> ビルド時に固定される設定プロパティ - それ以外の設定プロパティは実行時に上書き可能</p>
</div>
<table class="tableblock frame-all grid-all stretch configuration-reference searchable">
<colgroup>
<col style="width: 80%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<tbody>
<tr>
<th class="tableblock halign-left valign-top"><p class="tableblock"><a id="quarkus-micrometer_configuration"></a><a href="#quarkus-micrometer_configuration">Configuration property</a></p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">タイプ</p></th>
<th class="tableblock halign-left valign-middle"><p class="tableblock">デフォルト</p></th>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.enabled"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.enabled">quarkus.micrometer.enabled</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Micrometer metrics support.
 Micrometer metrics support is enabled by default.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.registry-enabled-default"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.registry-enabled-default">quarkus.micrometer.registry-enabled-default</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Micrometer MeterRegistry discovery.
 Micrometer MeterRegistry implementations discovered on the classpath will be enabled automatically by default.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.binder-enabled-default"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder-enabled-default">quarkus.micrometer.binder-enabled-default</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Micrometer MeterBinder discovery.
 Micrometer MeterBinder implementations discovered on the classpath will be enabled automatically by default.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.binder.http-client.enabled"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder.http-client.enabled">quarkus.micrometer.binder.http-client.enabled</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Outbound HTTP request metrics support.
 Support for HTTP client metrics will be enabled if Micrometer support is enabled, the REST client feature is enabled, and either this value is true, or this value is unset and <code>quarkus.micrometer.binder-enabled-default</code> is true.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.binder.http-server.enabled"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder.http-server.enabled">quarkus.micrometer.binder.http-server.enabled</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Inbound HTTP metrics support.
 Support for HTTP server metrics will be enabled if Micrometer support is enabled, an extension serving HTTP traffic is enabled, and either this value is true, or this value is unset and <code>quarkus.micrometer.binder-enabled-default</code> is true.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.binder.jvm"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder.jvm">quarkus.micrometer.binder.jvm</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Micrometer JVM metrics support.
 Micrometer JVM metrics support is enabled by default.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.binder.kafka.enabled"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder.kafka.enabled">quarkus.micrometer.binder.kafka.enabled</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Kafka metrics support.
 Support for Kafka metrics will be enabled if Micrometer support is enabled, the Kafka Consumer or Producer interface is on the classpath and either this value is true, or this value is unset and <code>quarkus.micrometer.binder-enabled-default</code> is true.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.binder.mp-metrics.enabled"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder.mp-metrics.enabled">quarkus.micrometer.binder.mp-metrics.enabled</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Eclipse MicroProfile Metrics support.</p>
</div>
<div class="paragraph">
<p>Support for MicroProfile Metrics will be enabled if Micrometer
support is enabled and the MicroProfile Metrics dependency is present:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.eclipse.microprofile.metrics&lt;/groupId&gt;
  &lt;artifactId&gt;microprofile-metrics-api&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The Micrometer extension currently provides a compatibility layer that supports the MP Metrics API,
but metric names and recorded values will be different.
Note that the MP Metrics compatibility layer will move to a different extension in the future.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.binder.system"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder.system">quarkus.micrometer.binder.system</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Micrometer System metrics support.
 Micrometer System metrics support is enabled by default.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>true</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.binder.vertx.enabled"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder.vertx.enabled">quarkus.micrometer.binder.vertx.enabled</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Vert.x metrics support.
 Support for Vert.x metrics will be enabled if Micrometer support is enabled, Vert.x MetricsOptions is on the classpath and either this value is true, or this value is unset and <code>quarkus.micrometer.binder-enabled-default</code> is true.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.export.json.enabled"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.export.json.enabled">quarkus.micrometer.export.json.enabled</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Support for export to JSON format. Off by default.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>false</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.export.json.path"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.export.json.path">quarkus.micrometer.export.json.path</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>The path for the JSON metrics endpoint. The default value is <code>metrics</code>.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>metrics</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.export.json.buffer-length"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.export.json.buffer-length">quarkus.micrometer.export.json.buffer-length</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Statistics like max, percentiles, and histogram counts decay over time to give greater weight to recent samples. Samples are accumulated to such statistics in ring buffers which rotate after the expiry, with this buffer length.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">int</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1024</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.export.json.expiry"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.export.json.expiry">quarkus.micrometer.export.json.expiry</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Statistics like max, percentiles, and histogram counts decay over time to give greater weight to recent samples. Samples are accumulated to such statistics in ring buffers which rotate after this expiry, with a particular buffer length.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html">Duration</a>
  <a href="#duration-note-anchor" title="More information about the Duration format"><span class="icon"><i class="fa fa-question-circle"></i></span></a></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>P3D</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.export.prometheus.enabled"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.export.prometheus.enabled">quarkus.micrometer.export.prometheus.enabled</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Support for export to Prometheus.
 Support for Prometheus will be enabled if Micrometer support is enabled, the PrometheusMeterRegistry is on the classpath and either this value is true, or this value is unset and <code>quarkus.micrometer.registry-enabled-default</code> is true.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">boolean</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><span class="icon"><i class="fa fa-lock" title="Fixed at build time"></i></span> <a id="quarkus-micrometer_quarkus.micrometer.export.prometheus.path"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.export.prometheus.path">quarkus.micrometer.export.prometheus.path</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>The path for the prometheus metrics endpoint (produces text/plain). The default value is <code>metrics</code>.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>metrics</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-micrometer_quarkus.micrometer.binder.http-client.match-patterns"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder.http-client.match-patterns">quarkus.micrometer.binder.http-client.match-patterns</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Comma-separated list of regular expressions used to specify uri
labels in http metrics.</p>
</div>
<div class="paragraph">
<p>Outbount HTTP client instrumentation will attempt to transform parameterized
resource paths, <code>/item/123</code>, into a generic form, <code>/item/{id}</code>,
to reduce the cardinality of uri label values.</p>
</div>
<div class="paragraph">
<p>Patterns specified here will take precedence over those computed
values.</p>
</div>
<div class="paragraph">
<p>For example, if <code>/item/\\\\d+=/item/custom</code> or
<code>/item/[0-9]+=/item/custom</code> is specified in this list,
a request to a matching path (<code>/item/123</code>) will use the specified
replacement value (<code>/item/custom</code>) as the value for the uri label.
Note that backslashes must be double escaped as {@code \\\\}.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-micrometer_quarkus.micrometer.binder.http-client.ignore-patterns"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder.http-client.ignore-patterns">quarkus.micrometer.binder.http-client.ignore-patterns</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Comma-separated list of regular expressions defining uri paths that should be ignored (not measured).</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-micrometer_quarkus.micrometer.binder.http-server.match-patterns"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder.http-server.match-patterns">quarkus.micrometer.binder.http-server.match-patterns</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Comma-separated list of regular expressions used to specify uri
labels in http metrics.</p>
</div>
<div class="paragraph">
<p>Vertx instrumentation will attempt to transform parameterized
resource paths, <code>/item/123</code>, into a generic form, <code>/item/{id}</code>,
to reduce the cardinality of uri label values.</p>
</div>
<div class="paragraph">
<p>Patterns specified here will take precedence over those computed
values.</p>
</div>
<div class="paragraph">
<p>For example, if <code>/item/\\\\d+=/item/custom</code> or
<code>/item/[0-9]+=/item/custom</code> is specified in this list,
a request to a matching path (<code>/item/123</code>) will use the specified
replacement value (<code>/item/custom</code>) as the value for the uri label.
Note that backslashes must be double escaped as {@code \\\\}.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-micrometer_quarkus.micrometer.binder.http-server.ignore-patterns"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.binder.http-server.ignore-patterns">quarkus.micrometer.binder.http-server.ignore-patterns</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Comma-separated list of regular expressions defining uri paths that should be ignored (not measured).</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">list of string</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p><a id="quarkus-micrometer_quarkus.micrometer.export.prometheus-prometheus"></a><code><a href="#quarkus-micrometer_quarkus.micrometer.export.prometheus-prometheus">quarkus.micrometer.export.prometheus</a></code></p>
</div>
<div class="openblock description">
<div class="content">
<div class="paragraph">
<p>Prometheus registry configuration properties.</p>
</div>
<div class="paragraph">
<p>A property source for configuration of the Prometheus MeterRegistry,
see <a href="https://micrometer.io/docs/registry/prometheus" class="bare">https://micrometer.io/docs/registry/prometheus</a>.</p>
</div>
</div>
</div></div></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>Map&lt;String,String&gt;</code></p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
</tbody>
</table>
<div id="duration-note-anchor" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">期間フォーマットについて</div>
<div class="paragraph">
<p>期間のフォーマットは標準の <code>java.time.Duration</code> フォーマットを使用します。詳細は <a href="https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html#parse-java.lang.CharSequence-">Duration#parse() javadoc</a> を参照してください。</p>
</div>
<div class="paragraph">
<p>数値で始まる期間の値を指定することもできます。この場合、値が数値のみで構成されている場合、コンバーターは値を秒として扱います。そうでない場合は、 <code>PT</code> が暗黙的に値の前に付加され、標準の <code>java.time.Duration</code> 形式が得られます。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus はオープンです。このプロジェクトの全ての依存関係は<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>または互換性のあるライセンスの元で利用出来ます。<br /><br />このウェブサイトは <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> で構築されており、<a href='https://pages.github.com/' target='_blank'>Github Pages</a>にホストされており、完全にオープンソースです。改善したい場合、 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>ウェブサイトをフォークし</a>、修正してみせてください。</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
            <li><a href="/">ホーム</a></li>
          
            <li><a href="/about">Quarkusについて</a></li>
          
            <li><a href="/blog">ブログ</a></li>
          
            <li><a href="/insights">ポッドキャスト</a></li>
          
            <li><a href="/events">イベント</a></li>
          
            <li><a href="/newsletter">ニュースレター</a></li>
          
            <li><a href="/publications">出版</a></li>
          
            <li><a href="/awards">受賞</a></li>
          
            <li><a href="/security">セキュリティポリシー</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォロー</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
            <li><a href="/support">サポート</a></li>
          
            <li><a href="/guides">ガイド</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入門</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">ディスカッション</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">開発メーリングリスト</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://ja.quarkus.io/">Japanese</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">等々...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
