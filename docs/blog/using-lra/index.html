<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - 長時間実行アクティビティのためのエクステンション</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/blog/using-lra/" />
  <meta property="og:title" content="長時間実行アクティビティのためのエクステンション" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/blog/using-lra/">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="post">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Quarkusとは <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/continuum" class="">リアクティブ</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学ぶ<i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="">ガイド</a></li>
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">コミュニティ <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="active">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="/publications" class="">出版物</a></li>
          <li><a href="/awards" class="">受賞</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >ENGLISH</a></li>
          <li><a href="https://ja.quarkus.io/">JAPANESE</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    <div class="full-width-breadcrumb-bg align-self">
  <div class="width-12-12">
      <p class="returnlink"><a href="/blog">Blog</a> <i class="fas fa-chevron-right"></i> 長時間実行アクティビティのためのエクステンション</p>
  </div>
</div>

<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
    <div class="grid-wrapper">
      <div class="width-12-12">
        <div class="post-date">
          September 01, 2021 
          
            <span class="tags"><a href="/blog/tag/extensions">#extensions</a></span>
          
        </div>
        <h1 class="post-title">長時間実行アクティビティのためのエクステンション</h1>
        <div class="grid-wrapper">
          <div class="width-8-12 width-12-12-m byline-wrapper">
            
            
            <p class="byline">By Michael Musgrove</p>
          </div>
          <div class="width-12-12">
              <div class="sect1">
<h2 id="はじめに"><a class="anchor" href="#はじめに"></a>はじめに</h2>
<div class="sectionbody">
<div class="paragraph">
<p>QuarkusのLRAエクステンションは、インタラクションが終了したときに、成功した場合と失敗した場合のいずれかで確定的に合意したいと考えているJAX-RSサービスを構築する際に便利です。成功した場合は、すべての参加者は、他のすべてのサービスも同様に行うことを認識して、クリーンアップできます。逆に、失敗した場合は、参加者はインタラクション中に行われた行為をお互いに補償することを知っています。この機能は、参加したサービスがコンセンサスを得て、アトミックな結果を得ることができることを意味します。</p>
</div>
<div class="paragraph">
<p>このサービスインタラクションをLRA（Long Running Actionの略）と呼んでいます。LRAは、信頼性の高いサービスインタラクションを構築するための特定の特性と保証を持っています。各アクションには一意の識別子（LRAコンテキスト）が割り当てられ、他のLRAと区別できるようになっています。</p>
</div>
<div class="paragraph">
<p>サービスは、JAX-RSメソッドを <a href="https://download.eclipse.org/microprofile/microprofile-lra-1.0/apidocs/org/eclipse/microprofile/lra/annotation/ws/rs/LRA.html">@LRA annotation</a> でマークすることで、LRAを開始（または既存のものに参加）します。このようなメソッドが呼び出されると、システムはアクションを開始し、その識別子を "Long-Running-Action" というJAX-RSヘッダーとして利用可能にします。メソッドのボディが何らかのJAX-RSの呼び出しを実行すると、このヘッダーは自動的に送信リクエストに追加されます。このようにして、対象となるサービスは、（ <code>@LRA</code> ）アノテーションが付与されていれば、対話に参加することができます。</p>
</div>
<div class="paragraph">
<p>このようにアノテーションされたメソッドが行った作業は、あるサービスがLRAを「キャンセル」した場合に、そのサービスが行った作業を補償すべきであると確実に通知されるという意味で、「補償可能」でなければなりません。各サービスは、「補償する」という概念を解釈する責任があります。唯一の要件は、補償すべきだと通知されたときに <a href="https://download.eclipse.org/microprofile/microprofile-lra-1.0/apidocs/org/eclipse/microprofile/lra/annotation/ParticipantStatus.html">適切に</a> 対応することです。サービスは、メソッドの1つに <a href="https://download.eclipse.org/microprofile/microprofile-lra-1.0/apidocs/org/eclipse/microprofile/lra/annotation/Compensate.html">@Compensate</a> アノテーションを付けることで、どのように通知されるべきかを示します。LRAの結果を制御する方法の詳細については、 <code>@LRA</code> アノテーションのjavadocを参照してください。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
このエクステンションは、 <a href="https://download.eclipse.org/microprofile/microprofile-lra-1.0-M1/microprofile-lra-spec.html">MicroProfile LRA仕様</a>とその関連 <a href="https://download.eclipse.org/microprofile/microprofile-lra-1.0/apidocs/index.html?org/eclipse/microprofile/lra/annotation/ws/rs/LRA.html">アノテーション</a>の実装を提供します。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lraコーディネーター"><a class="anchor" href="#lraコーディネーター"></a>LRAコーディネーター</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>narayana-lra</code> エクステンションを利用するには、環境内に実行中のコーディネーターが存在することが必要です。コーディネーターは、次のサイトから入手できます: <code><a href="https://hub.docker.com/r/jbosstm/lra-coordinator" class="bare">https://hub.docker.com/r/jbosstm/lra-coordinator</a></code> また、適切な依存関係を含むmaven pomを使用して、独自のコーディネーターを構築することもできます。このブログでは、 <code>quarkus-maven-plugin</code> を使用してゼロからコーディネーターを作成する方法を紹介します。コーディネーターの設定については、 <a href="https://jbossts.blogspot.com/2021/07/narayana-lra-update.html">narayana</a>のブログでも紹介されています。</p>
</div>
<div class="paragraph">
<p>コーディネーターは単なるJAX-RSリソースなので、Quarkusを使って、 <code>resteasy-jackson</code> と <code>rest-client</code> のエクステンションを追加して構築することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mvn io.quarkus:quarkus-maven-plugin:2.2.1.Final:create \
      -DprojectGroupId=org.acme \
      -DprojectArtifactId=narayana-lra-coordinator \
      -Dextensions="resteasy-jackson,rest-client"
$ cd narayana-lra-coordinator/
$ rm -rf src</code></pre>
</div>
</div>
<div class="paragraph">
<p>生成されたsrcディレクトリを削除したのは、コーディネーターを動かすためにquarkusフレームワークが必要なだけだからです。</p>
</div>
<div class="paragraph">
<p>pom.xmlファイルを更新して、narayanaコーディネーターの実装への依存関係を追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.narayana.rts&lt;/groupId&gt;
      &lt;artifactId&gt;lra-coordinator-jar&lt;/artifactId&gt;
      &lt;version&gt;5.12.0.Final&lt;/version&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>次にそれをビルドして、バックグラウンドで実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw clean package
$ java -Dquarkus.http.port=50000 -jar target/quarkus-app/quarkus-run.jar &amp;</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここでは、 <code>narayana-lra</code> quarkus extensionが使用するデフォルトのポート、すなわち <code>50000</code> でコーディネーターを実行しています。コーディネーターが正常に動作していることは、現在のLRAをリストアップすることで確認できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl http://localhost:50000/lra-coordinator
[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>このスニペットは、リクエストが空のjson配列を返すことを示しています。</p>
</div>
<div class="paragraph">
<p>ここでは、LRAを使用するサービスを開発・テストする間、コーディネーターを（デフォルトのポートで）稼働させておきます。記事の最後では、コーディネーターをサービスに組み込む方法を紹介します（注意：この方法では、コーディネーターをネイティブ・モードで実行することはできませんが、将来的にはこの要件をサポートするエクステンションが提供される予定です）。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jvmモード"><a class="anchor" href="#jvmモード"></a>JVMモード</h2>
<div class="sectionbody">
<div class="paragraph">
<p>LRAをサポートするJAX-RSアプリケーションをビルドするには、アプリケーションのpomに依存関係 <code>io.quarkus:quarkus-narayana-lra</code> を追加します。これにより、JAX-RSサポートが追加され、サービスを開発する際にLRAアノテーションを利用できるようになります。また、LRAへのサービスの参加を自動的に管理するJAX-RSフィルタも登録されます。</p>
</div>
<div class="paragraph">
<p>上述のように、 <a href="https://download.eclipse.org/microprofile/microprofile-lra-1.0-M1/microprofile-lra-spec.html">LRA仕様</a>が要求する（最終的な一貫性の）保証は、LRAに参加するサービスを調整するJAX-RSアプリケーションの存在に依存しています。このコンポーネントは、インタラクションの開始時、インタラクションへの参加時、およびインタラクションの終了時に存在しなければなりません。コーディネーターが利用できなくなった場合は、再起動する必要があります。同様に、LRAに参加しているサービスは、終了段階でも利用可能でなければなりません。システムは、サービスがLRAを終了したことを示すまで再試行を続け、サービスが補償（または完了）に成功したことを示すと、そのサービスはもはや相互作用に参加しません（ただし、すべてのサービスの補償または完了が終了したことを示す信頼性の高い通知に登録することは可能です）。コーディネーターは多数存在しますが、本稿執筆時点では、特定のLRAを管理できるのは1人だけです。</p>
</div>
<div class="sect2">
<h3 id="ステップ1アプリケーションの作成"><a class="anchor" href="#ステップ1アプリケーションの作成"></a>ステップ1：アプリケーションの作成</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ mvn io.quarkus:quarkus-maven-plugin:2.2.1.Final:create \
      -DprojectGroupId=org.acme \
      -DprojectArtifactId=narayana-lra-quickstart \
      -Dextensions="narayana-lra"
$ cd lra-quickstart</code></pre>
</div>
</div>
<div class="paragraph">
<p>なお、コーディネーターがデフォルトとは異なるポート（例： <code>50000</code> ）で動作している場合は、アプリケーションの設定ファイル（ <code>src/main/resources/application.properties</code> ）を更新し、ホストとポートを指定する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus.lra.coordinator-url=http://localhost:&lt;port&gt;/lra-coordinator</code></pre>
</div>
</div>
<div class="paragraph">
<p>これらの変更後に、生成されたアプリケーションが動作することを確認します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw clean package</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="ステップ2lraサポートの追加"><a class="anchor" href="#ステップ2lraサポートの追加"></a>ステップ2：LRAサポートの追加</h3>
<div class="paragraph">
<p>ここで、生成されたアプリケーションを更新し、HelloメソッドがLong Running Actionのコンテキストで実行されるようにします。</p>
</div>
<div class="paragraph">
<p>ファイル <code>src/main/java/org/acme/GreetingResource.java</code> をエディタで開き、 <code>hello</code> メソッドに @LRA アノテーションを付けます（また、JAX-RS <code>javax.ws.rs.HeaderParam</code> アノテーションを使用して、LRA コンテキストをメソッドに注入します）。さらに、LRAが閉じられたときやキャンセルされたときに呼び出される2つのコールバックメソッドを追加します。</p>
</div>
<div class="paragraph">
<p>インポートも含めて最終的には以下のようになるはずです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme;

import javax.ws.rs.GET;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.core.MediaType;

// Step 2a: Add imports for reading the LRA context and for using LRA annotations
import javax.ws.rs.HeaderParam;
import javax.ws.rs.PUT;
import javax.ws.rs.core.Response;
import java.net.URI;
import org.eclipse.microprofile.lra.annotation.ws.rs.LRA;
import org.eclipse.microprofile.lra.annotation.Compensate;
import org.eclipse.microprofile.lra.annotation.Complete;
import static org.eclipse.microprofile.lra.annotation.ws.rs.LRA.LRA_HTTP_CONTEXT_HEADER;

@Path("/hello")
public class GreetingResource {

    @GET
    @LRA // Step 2b: The method should run within an LRA
    @Produces(MediaType.TEXT_PLAIN)
    public String hello(@HeaderParam(LRA_HTTP_CONTEXT_HEADER) URI lraId /* Step 2c the context is useful for associating compensation logic */) {
        System.out.printf("hello with context %s%n", lraId);
        return "Hello RESTEasy";
    }

    // Step 2d: There must be a method to compensate for the action if it's cancelled
    @PUT
    @Path("compensate")
    @Compensate
    public Response compensateWork(@HeaderParam(LRA_HTTP_CONTEXT_HEADER) URI lraId) {
        System.out.printf("compensating %s%n", lraId);
        return Response.ok(lraId.toASCIIString()).build();
    }

    // Step 2e: An optional callback notifying that the LRA is closing
    @PUT
    @Path("complete")
    @Complete
    public Response completeWork(@HeaderParam(LRA_HTTP_CONTEXT_HEADER) URI lraId) {
        System.out.printf("completing %s%n", lraId);
        return Response.ok(lraId.toASCIIString()).build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>これらの変更により、アプリケーションをビルドしてから <code>hello</code> メソッドを呼び出すと、LRAはメソッドに入る前に開始され、メソッドが終了した後に終了します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw clean package
$ java -jar target/quarkus-app/quarkus-run.jar &amp;
[1] 2389948
$ curl http://localhost:8080/hello
hello with context http://localhost:50000/lra-coordinator/0_ffffc0a8000e_8c1f_612a6e9b_a
completing http://localhost:50000/lra-coordinator/0_ffffc0a8000e_8c1f_612a6e9b_a
Hello RESTEasy</code></pre>
</div>
</div>
<div class="paragraph">
<p>コーディネーターが動作していることを確認してください。そうでない場合は、以下のようなエラーメッセージが表示されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">2021-08-11 14:27:45,779 WARN  [io.nar.lra] (executor-thread-0) LRA025025: Unable to process LRA annotations: -3: StartFailed (start LRA client request timed out, try again later) ()'</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Complete</code> のコールバックが呼び出されたことを示す <code>System.out</code> のメッセージに注目してください。ここで、次のステップに備えてjavaプロセスをkillします（プロセスIDがコンソールに表示され、私の例ではpidが2389948なので、 <code>kill 2389948</code> と入力しました）。</p>
</div>
</div>
<div class="sect2">
<h3 id="ステップ3lraを2つのサービス方式に拡張"><a class="anchor" href="#ステップ3lraを2つのサービス方式に拡張"></a>ステップ3：LRAを2つのサービス方式に拡張</h3>
<div class="paragraph">
<p>このステップでは <a href="https://download.eclipse.org/microprofile/microprofile-lra-1.0/apidocs/org/eclipse/microprofile/lra/annotation/ws/rs/LRA.html#end--">LRAアノテーションのエンド要素</a> を使用することで、LRAを開始しますが、メソッドが終了してもLRAを終了しません。</p>
</div>
<div class="paragraph">
<p>そのために、二番目のビジネスメソッドを次のように定義します:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @GET
    @Path("/start")
    @LRA(end = false) // Step 3a: The method should run within an LRA
    @Produces(MediaType.TEXT_PLAIN)
    public String start(@HeaderParam(LRA_HTTP_CONTEXT_HEADER) URI lraId) {
        System.out.printf("hello with context %s%n", lraId);
        return lraId.toASCIIString();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>helloメソッドとの唯一の違いは、 <code>@Path</code> と <code>@LRA</code> のアノテーションがあることと、LRA IDを呼び出し元に返すことです。これは、LRAを終了させるためにhelloメソッドにリクエストを送信する際に、ヘッダーを設定するために必要となります（このヘッダーは、JAX-RSのレスポンスヘッダーの1つでも利用可能であることに注意してください）。</p>
</div>
<div class="paragraph">
<p>既存のインスタンスをkillし( <code>kill 2389948</code>)、アプリケーションを再ビルドし( <code>./mvnw package -DskipTests</code>)、バックグラウンドで実行を開始します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ java -jar target/quarkus-app/quarkus-run.jar &amp;
[1] 2495275</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>curl</code> を使ってLRAを開始し、今回追加した新しいメソッドにリクエストを送信します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ LRA_URL=$(curl http://localhost:8080/hello/start)
hello with context http://localhost:50000/lra-coordinator/0_ffffc0a8000e_a909_611a92ea_2</code></pre>
</div>
</div>
<div class="paragraph">
<p>startメソッドはLRAのIDを返すようにコード化されており、 <code>bash</code> を使ってそれを <code>LRA_URL</code> という環境変数に保存しています。オリジナルのhelloメソッドは、 <code>@LRA</code> アノテーションの <code>end</code> 要素のデフォルト値を使用しているため、LRAのコンテキストでこのメソッドを呼び出すと、メソッドの終了時にLRAが自動的にクローズされます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl --header "Long-Running-Action: $LRA_URL" http://localhost:8080/hello
hello with context http://localhost:50000/lra-coordinator/0_ffffc0a8000e_a909_611a92ea_2
completing http://localhost:50000/lra-coordinator/0_ffffc0a8000e_a909_611a92ea_2
Hello RESTEasy</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>completeWork</code> メソッドが呼び出されたことに注目してください。</p>
</div>
</div>
<div class="sect2">
<h3 id="ステップ4あるマイクロサービスでlraを開始し別のマイクロサービスで終了する"><a class="anchor" href="#ステップ4あるマイクロサービスでlraを開始し別のマイクロサービスで終了する"></a>ステップ4：あるマイクロサービスでLRAを開始し、別のマイクロサービスで終了する</h3>
<div class="paragraph">
<p>このステップでは、2つの異なるマイクロサービスが結合していないにもかかわらず、それぞれのアクティビティを調整する方法を紹介します。helloアプリケーションの2つ目のインスタンスを別のポートで起動します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ java -Dquarkus.http.port=8081 -jar target/quarkus-app/quarkus-run.jar &amp;
[2] 2495369</code></pre>
</div>
</div>
<div class="paragraph">
<p>同じアプリケーションリソースファイルと外部コーディネーターを使用しているので、設定を更新する必要はありません。</p>
</div>
<div class="paragraph">
<p>再度、 <code>curl</code> を使用して LRA を起動し、最初のサービスの start メソッドにリクエストを送信します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ LRA_URL=$(curl http://localhost:8080/hello/start)
hello with context http://localhost:50000/lra-coordinator/0_ffffc0a8000e_a355_6113dede_11</code></pre>
</div>
</div>
<div class="paragraph">
<p>これを、2つ目のサービス（ポート8081で動作しているもの）で終了させます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl --header "Long-Running-Action: $LRA_URL" http://localhost:8081/hello
hello with context http://localhost:50000/lra-coordinator/0_ffffc0a8000e_a355_6113dede_11
completing http://localhost:50000/lra-coordinator/0_ffffc0a8000e_a355_6113dede_11
completing http://localhost:50000/lra-coordinator/0_ffffc0a8000e_a355_6113dede_11
Hello RESTEasy</code></pre>
</div>
</div>
<div class="paragraph">
<p>両方のマイクロサービスが、完了コールバックを受け取ったことを示していることに注目してください。</p>
</div>
<div class="paragraph">
<p>両方のJavaプロセスを終了してください( <code>kill 2495275 2495369</code>)。</p>
</div>
<div class="sect3">
<h4 id="オプショナルステップmandatory要素の使用"><a class="anchor" href="#オプショナルステップmandatory要素の使用"></a>オプショナルステップ：MANDATORY要素の使用</h4>
<div class="paragraph">
<p>LRAを閉じるために既存のメソッドを使うのではなく、コンテキストがあることを前提としたメソッドを書きたいと思うかもしれません。この場合、 <code>LRA.Type</code> 要素を設定することになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">    @GET
    @Path("/end")
    @LRA(value = LRA.Type.MANDATORY) // Step 3a: The method MUST be invoked with an LRA
    @Produces(MediaType.TEXT_PLAIN)
    public String end(@HeaderParam(LRA_HTTP_CONTEXT_HEADER) URI lraId) {
        return lraId.toASCIIString();
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>end メソッドは <code>@LRA(value = LRA.Type.MANDATORY)</code> でアノテーションされているため，コンテクストヘッダが存在していなければならず，そうでなければメソッドはエラー応答コードを返すことになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw clean package -DskipTests
$ java -Dquarkus.http.port=8081 -jar target/quarkus-app/quarkus-run.jar &amp;
[1] 300189
$ LRA_URL=$(curl http://localhost:8081/hello/start)
$ curl -v http://localhost:8081/hello/end
...
HTTP/1.1 412 Precondition Failed
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>一方、LRAのコンテキストヘッダを提供するとうまくいきます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl --header "Long-Running-Action: $LRA_URL" -I http://localhost:8081/hello/end
HTTP/1.1 200 OK
Content-Type: application/octet-stream
connection: keep-alive
$ kill 300189</code></pre>
</div>
</div>
<div class="paragraph">
<p>アプリケーションの目的に応じて、他の <a href="https://download.eclipse.org/microprofile/microprofile-lra-1.0/apidocs/org/eclipse/microprofile/lra/annotation/ws/rs/LRA.Type.html">LRA.Type の値</a>も有効です。JTAに慣れた読者は、LRA.Typeは <a href="https://docs.oracle.com/javaee/7/api/javax/transaction/Transactional.TxType.html">Java Transactional TxType アノテーション</a>をおおまかにモデルにして開発されたことを知っておくと良いでしょう。</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ネイティブモード"><a class="anchor" href="#ネイティブモード"></a>ネイティブモード</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ネイティブモードでは、外部のコーディネーター（アプリケーションに組み込まれていないもの）しかサポートされていません（この欠点を解決するために、後のリリースでコーディネーターのエクステンションを提供する予定です）。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>まず、ネイティブ実行可能ファイルをビルドします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./mvnw package -DskipTests -Pnative</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#_lra-coordinators">コーディネーターのセクション</a> で起動した外部コーディネーターがポート50000で動作していることを確認し、バックグラウンドでネイティブ実行可能ファイルとしてサービスを開始します。コーディネーターがデフォルト・ポートで実行されていない場合は、実行中のコーディネーターの場所をJavaシステム・プロパティ( <code>-Dquarkus.lra.coordinator-url=http://localhost:50000/lra-coordinator</code>)として渡すか、アプリケーション・コンフィグを更新してネイティブ実行可能ファイルを再ビルドする必要があることに注意してください。</p>
</div>
<div class="paragraph">
<p>ネイティブサービスのインスタンスを起動します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./target/narayana-lra-quickstart-1.0.0-SNAPSHOT-runner &amp;
[1] 2434426</code></pre>
</div>
</div>
<div class="paragraph">
<p>後でプロセスをkillする必要があるので、プロセスID（例：2434426）をメモしておきます。</p>
</div>
<div class="paragraph">
<p>新しいLRAを開始します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ LRA_URL=$(curl http://localhost:8080/hello/start)</code></pre>
</div>
</div>
<div class="paragraph">
<p>そして別の方法で終わらせます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl --header "Long-Running-Action: $LRA_URL" http://localhost:8080/hello
hello with context http://localhost:50000/lra-coordinator/0_ffffc0a8000e_8479_612e13fa_2
completing http://localhost:50000/lra-coordinator/0_ffffc0a8000e_8479_612e13fa_2
Hello RESTEasy</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のステップに備えてサービスを停止するか（ <code>kill 2434426</code> ）、そのまま稼働させておきます。</p>
</div>
<div class="sect2">
<h3 id="エラーハンドリング"><a class="anchor" href="#エラーハンドリング"></a>エラーハンドリング</h3>
<div class="paragraph">
<p>このステップでは、あるサービスでLRAの実行を開始し、LRAが終了する前にサービスを終了させます。次に、2つ目のサービスを使用してLRAを終了させます。2つ目のサービスは完了しますが、最初に失敗したサービスの参加者がまだ完了する必要があるため、LRAはまだ <code>Closing</code> の状態にあります。LRAが <code>Closed</code> の状態になるには、失敗したサービスを再起動して、 <code>Complete</code> の要求に応答できるようにする必要があります。</p>
</div>
<div class="paragraph">
<p>fistサービスをデフォルトのポート8080で再起動します（そしてプロセスIDもメモしておきます）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./target/narayana-lra-quickstart-1.0.0-SNAPSHOT-runner &amp;
[1] 2434936</code></pre>
</div>
</div>
<div class="paragraph">
<p>そして2つ目のサービスインスタンス（ポート8082）を起動します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./target/narayana-lra-quickstart-1.0.0-SNAPSHOT-runner -Dquarkus.http.port=8082 &amp;
[2] 2434984</code></pre>
</div>
</div>
<div class="paragraph">
<p>最初のサービスでLRAを開始します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ LRA_URL=$(curl http://localhost:8080/hello/start)
hello with context http://localhost:50000/lra-coordinator/0_ffffc0a8000e_a355_6113dede_34</code></pre>
</div>
</div>
<div class="paragraph">
<p>最初のサービスをkill</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ kill 2434936
2021-08-11 16:02:24,542 INFO  [io.quarkus] (Shutdown thread) narayana-lra-quickstart stopped in 0.003s</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで、2つ目のサービスだけが稼働している状態で、LRAを終了させてみます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl --header "Long-Running-Action: $LRA_URL" http://localhost:8082/hello
hello with context http://localhost:50000/lra-coordinator/0_ffffc0a8000e_a355_6113dede_34
completing http://localhost:50000/lra-coordinator/0_ffffc0a8000e_a355_6113dede_34
Hello RESTEasy</code></pre>
</div>
</div>
<div class="paragraph">
<p>コーディネーターに問い合わせれば、LRAはまだ動いていることが確認できます (<code>curl <a href="http://localhost:50000/lra-coordinator" class="bare">http://localhost:50000/lra-coordinator</a></code>)。</p>
</div>
<div class="paragraph">
<p>LRAを終了するために、失敗したサービス（ポート8080で待ち受けていた）を再起動します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ ./target/narayana-lra-quickstart-1.0.0-SNAPSHOT-runner &amp;
[3] 2435130</code></pre>
</div>
</div>
<div class="paragraph">
<p>リカバリー処理は定期的に行われます（リカバリーパスのデフォルトの期間は2分です）。2分も待てない場合は、コーディネーターのリカバリーエンドポイントを使って、以下のように手動でリカバリーサイクルを開始することができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl http://localhost:50000/lra-coordinator/recovery
completing http://localhost:50000/lra-coordinator/0_ffffc0a8000e_a355_6113dede_34
[]</code></pre>
</div>
</div>
<div class="paragraph">
<p>ここで注意すべき点は、再起動したサービスが完了通知を受け取ったことです( <code>completing …​</code>)。復旧サイクルの実行要求の結果は、復旧したLRAのjson配列です（この例では、最後のLRAが終了したため、リストは空のjson配列 <code>[]</code> ）。</p>
</div>
<div class="paragraph">
<p>2つのサービスを停止してクリーンアップします( <code>kill 2434984 2435130</code>)。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="付録1"><a class="anchor" href="#付録1"></a>付録1</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="埋め込みコーディネーター"><a class="anchor" href="#埋め込みコーディネーター"></a>埋め込みコーディネーター</h3>
<div class="paragraph">
<p>コーディネーターは単なるJAX-RSアプリケーションなので、アプリケーションのpom.xmlファイルにLRAコーディネーターの依存関係を追加することで、JAX-RSサービスに簡単に組み込むことができます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;dependency&gt;
      &lt;groupId&gt;org.jboss.narayana.rts&lt;/groupId&gt;
      &lt;artifactId&gt;lra-coordinator-jar&lt;/artifactId&gt;
      &lt;version&gt;5.12.0.Final&lt;/version&gt;
    &lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>また、デフォルトでは、Quarkusは1つのデプロイメントにつき1つのアプリケーションしか許可しないため、アプリケーション設定ファイル( <code>src/main/resources/application.properties</code>)に以下のプロパティを追加する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">quarkus.resteasy.ignore-application-classes=true</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#_lra-coordinators">コーディネーターのセクション</a>で説明した注意点と同じです。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ネイティブ実行可能ファイルには対応していません。</p>
</li>
<li>
<p>各インスタンスには、コーディネーターのトランザクションログ用の専用ストレージが必要です（現在、トランザクションストアの共有はサポートされていないため）。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>埋め込まれたコーディネーターは、アプリケーションと同じポート（パス <code>lra-coordinator</code> ）で利用できますが、デフォルトのコーディネーターのポートは <code>50000</code> なので、アプリケーションのコンフィグでその場所を設定して、アプリケーションに使用させる必要があることに注意してください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">quarkus.http.port=8080
quarkus.lra.coordinator-url=http://localhost:8080/lra-coordinator</code></pre>
</div>
</div>
<div class="paragraph">
<p>トランザクションログの場所はこの方法では設定できないため、システムプロパティ( <code>ObjectStoreEnvironmentBean.objectStoreDir</code>)で設定する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ java -DObjectStoreEnvironmentBean.objectStoreDir=target/lra-logs -jar target/quarkus-app/quarkus-run.jar &amp;
[1] 2443349
$ LRA_URL=$(curl http://localhost:8080/hello/start)
02021-08-11 17:42:30,464 INFO  [com.arj.ats.arjuna] (executor-thread-1) ARJUNA012170: TransactionStatusManager started on port 35827 and host 127.0.0.1 with service com.arjuna.ats.arjuna.recovery.ActionStatusService
hello with context http://localhost:8080/lra-coordinator/0_ffffc0a8000e_a985_6113fdf6_2
$ curl http://localhost:8080/lra-coordinator
[{"lraId":"http://localhost:8080/lra-coordinator/0_ffffc0a8000e_a985_6113fdf6_2","clientId":"org.acme.GreetingResource#start","status":"Active","startTime":1628700150466,"finishTime":0,"httpStatus":204,"topLevel":true,"recovering":false}]</code></pre>
</div>
</div>
<div class="paragraph">
<p>今度は別の方法でLRAを終了します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl --header "Long-Running-Action: $LRA_URL" http://localhost:8080/hello
hello with context http://localhost:8080/lra-coordinator/0_ffffc0a8000e_a985_6113fdf6_2
completing http://localhost:8080/lra-coordinator/0_ffffc0a8000e_a985_6113fdf6_2
Hello RESTEasy</code></pre>
</div>
</div>
<div class="paragraph">
<p>今後、エクステンションでは、埋め込み式のコーディネーターのサポートが強化される予定です（標準的なQuarkusのメカニズムを使った設定を含む）。</p>
</div>
</div>
</div>
</div>
              
          </div>
          <div class="width-12-12"><div class="share-page">
  <a class="share-linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https://quarkus.io/blog/using-lra/&title=長時間実行アクティビティのためのエクステンション" rel="nofollow" target="_blank" title="Share on LinkedIn">
    <img src="/assets/images/share-page/icons_social-linkedin.png"/>
  </a>
  <a class="share-twitter" href="https://twitter.com/intent/tweet?text=長時間実行アクティビティのためのエクステンション&url=https://quarkus.io/blog/using-lra/&via=quarkusio&related=quarkusio" rel="nofollow" target="_blank" title="Share on Twitter">
    <img src="/assets/images/share-page/icons_social-twitter.png"/>
  </a>
  <a class="share-facebook" href="https://facebook.com/sharer.php?u=https://quarkus.io/blog/using-lra/" rel="nofollow" target="_blank" title="Share on Facebook">
    <img src="/assets/images/share-page/icons_social-facebook.png"/>
  </a>
  <a class="share-reddit" href="http://www.reddit.com/submit?url=https://quarkus.io/blog/using-lra/" onclick="window.open(this.href, 'pop-up', 'left=20,top=20,width=900,height=500,toolbar=1,resizable=0'); return false;" title="Share on Reddit" >
    <img src="/assets/images/share-page/icons_social-reddit.png"/>
  </a>
  <a class="share-email" href="mailto:?subject=長時間実行アクティビティのためのエクステンション&amp;body=長時間実行アクティビティのためのエクステンション https://quarkus.io/blog/using-lra/" title="Share via Email" >
    <img src="/assets/images/share-page/icons_social-email.png"/>
  </a>
</div>
</div>
        </div>
      </div>
    </div>
  </div>
</div>
<div class="post-page grid-wrapper">
  <div class="width-8-12 width-12-12-m doc-content">
  <script src="https://giscus.app/client.js"
        data-repo="quarkusio/quarkus"
        data-repo-id="MDEwOlJlcG9zaXRvcnkxMzk5MTQ5MzI="
        data-category="Quarkus Blog/Website"
        data-category-id="DIC_kwDOCFbutM4CAFFV"
        data-mapping="og:title"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-theme="light"
        data-lang="en"
        crossorigin="anonymous"
        async>
  </script>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus はオープンです。このプロジェクトの全ての依存関係は<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>または互換性のあるライセンスの元で利用出来ます。<br /><br />このウェブサイトは <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> で構築されており、<a href='https://pages.github.com/' target='_blank'>Github Pages</a>にホストされており、完全にオープンソースです。改善したい場合、 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>ウェブサイトをフォークし</a>、修正してみせてください。</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
            <li><a href="/">ホーム</a></li>
          
            <li><a href="/about">Quarkusについて</a></li>
          
            <li><a href="/blog">ブログ</a></li>
          
            <li><a href="/insights">ポッドキャスト</a></li>
          
            <li><a href="/events">イベント</a></li>
          
            <li><a href="/newsletter">ニュースレター</a></li>
          
            <li><a href="/publications">出版</a></li>
          
            <li><a href="/awards">受賞</a></li>
          
            <li><a href="/security">セキュリティポリシー</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォロー</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
            <li><a href="/support">サポート</a></li>
          
            <li><a href="/guides">ガイド</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入門</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">ディスカッション</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">開発メーリングリスト</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://ja.quarkus.io/">Japanese</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">等々...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
