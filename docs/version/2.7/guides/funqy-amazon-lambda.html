<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Funqy Amazon Lambda Binding - 2.7</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/version/2.7/guides/funqy-amazon-lambda" />
  <meta property="og:title" content="Funqy Amazon Lambda Binding - 2.7" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/funqy-amazon-lambda">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Quarkusとは <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/continuum" class="">リアクティブ</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学ぶ<i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ガイド</a></li>
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">コミュニティ <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="/publications" class="">出版物</a></li>
          <li><a href="/awards" class="">受賞</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >ENGLISH</a></li>
          <li><a href="https://ja.quarkus.io/">JAPANESE</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/version/2.7/guides/"> Back to Guides</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">Select Guide Version</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" >2.9 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" selected>2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" >2.2</option>
        
        
      
        
        
        
        
          
        <option value="1.11" >1.11</option>
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">Funqy Amazon Lambda Binding </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#前提条件">前提条件</a></li>
<li><a href="#installing-aws-bits">Installing AWS bits</a></li>
<li><a href="#クイックスタート">クイックスタート</a></li>
<li><a href="#コード">コード</a></li>
<li><a href="#choose">functionの選択</a></li>
<li><a href="#deploy-to-aws-lambda-java-runtime">Deploy to AWS Lambda Java Runtime</a></li>
<li><a href="#ビルドとデプロイ">ビルドとデプロイ</a></li>
<li><a href="#実行ロールの作成">実行ロールの作成</a></li>
<li><a href="#ビルド時に追加生成されるファイル">ビルド時に追加生成されるファイル</a></li>
<li><a href="#関数を作成する">関数を作成する</a></li>
<li><a href="#関数の呼出">関数の呼出</a></li>
<li><a href="#functionの更新">functionの更新</a></li>
<li><a href="#deploy-to-aws-lambda-custom-native-runtime">Deploy to AWS Lambda Custom (native) Runtime</a></li>
<li><a href="#examine-the-pom">Examine the POM</a></li>
<li><a href="#統合テスト">統合テスト</a></li>
<li><a href="#testing-with-the-sam-cli">Testing with the SAM CLI</a></li>
<li><a href="#function-zip-の修正"><code>function.zip</code> の修正</a></li>
<li><a href="#カスタム-bootstrap-スクリプト">カスタム <code>bootstrap</code> スクリプト</a></li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>このガイドでは、Funqy関数をAmazon Lambdaにデプロイする方法をクイックスタートコードで説明しています。</p>
</div>
<div class="paragraph">
<p>Funqy関数はAWS Lambda Java Runtimeを使ってデプロイすることもできますし、より少ないメモリーフットプリントとより高速なコールドブート起動時間が必要な場合は、ネイティブ実行可能ファイルをビルドしてLambda Custom Runtimeを使うこともできます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>この技術は、previewと考えられています。</p>
</div>
<div class="paragraph">
<p><em>preview</em> では、下位互換性やエコシステムでの存在は保証されていません。具体的な改善には設定や API の変更が必要になるかもしれませんが、 <em>stable</em> になるための計画は現在進行中です。フィードバックは <a href="https://groups.google.com/d/forum/quarkus-dev">メーリングリスト</a> や <a href="https://github.com/quarkusio/quarkus/issues">GitHub の課題管理</a> で受け付けています。</p>
</div>
<div class="paragraph">
<p>とりうるステータスの完全なリストについては、 <a href="https://quarkus.io/faq/#extension-status">FAQの項目</a> を参照してください。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="前提条件"><a class="anchor" href="#前提条件"></a>前提条件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このガイドを完成させるには、以下が必要です:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ざっと 30 minutes</p>
</li>
<li>
<p>An IDE</p>
</li>
<li>
<p>JDK 11+ がインストールされ、 <code>JAVA_HOME</code> が適切に設定されていること</p>
</li>
<li>
<p>Apache Maven 3.8.1+</p>
</li>
<li>
<p>使用したい場合、 <a href="cli-tooling.html">Quarkus CLI</a></p>
</li>
<li>
<p>ネイティブ実行可能ファイルをビルドしたい場合、MandrelまたはGraalVM（あるいはネイティブなコンテナビルドを使用する場合はDocker）をインストールし、 <a href="building-native-image.html#configuring-graalvm">適切に設定</a>していること</p>
</li>
<li>
<p><a href="funqy">Funqy の基礎</a> を読む。短時間で読めます!</p>
</li>
<li>
<p><a href="https://aws.amazon.com">An Amazon AWS account</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html">AWS CLI</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">AWS SAM CLI</a> 、ローカルテスト用</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Funqy Amazon Lambdas build off of our <a href="amazon-lambda">Quarkus Amazon Lambda support</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="installing-aws-bits"><a class="anchor" href="#installing-aws-bits"></a>Installing AWS bits</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AWSのすべてのツールをインストールすることは、おそらくこのガイドでは最も難しいことです。AWS CLIをインストールするためのすべての手順に従っていることを確認してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="クイックスタート"><a class="anchor" href="#クイックスタート"></a>クイックスタート</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Gitレポジトリをクローンするか <code>git clone <a href="https://github.com/quarkusio/quarkus-quickstarts.git" class="bare">https://github.com/quarkusio/quarkus-quickstarts.git</a></code> 、 <a href="https://github.com/quarkusio/quarkus-quickstarts/archive/main.zip">アーカイブ</a> をダウンロードします。</p>
</div>
<div class="paragraph">
<p>ソリューションは <code>funqy-amazon-lambda-quickstart</code> <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/funqy-quickstarts/funqy-amazon-lambda-quickstart">ディレクトリ</a> にあります。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="コード"><a class="anchor" href="#コード"></a>コード</h2>
<div class="sectionbody">
<div class="paragraph">
<p>コードには何も特別なものはありませんし、もっと重要なのはAWSに特化したものは何もありません。Funqy関数は様々な環境にデプロイすることができ、AWS Lambdaもその一つです。Javaのコードは、実はhttps://github.com/quarkusio/quarkus-quickstarts/tree/main/funqy-quickstarts/funqy-http-quickstart[funqy-http-quickstart]と全く同じコードです。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="choose"><a class="anchor" href="#choose"></a>functionの選択</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Amazon LambdaデプロイメントごとにエクスポートできるFunqy関数は1つだけです。プロジェクト内で複数の関数を定義している場合は、Quarkus <code>application.properties</code> 内で関数を選択する必要があります .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.funqy.export=greet</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see how the quickstart has done it within its own <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/funqy-quickstarts/funqy-amazon-lambda-quickstart/src/main/resources/application.properties">application.properties</a>.</p>
</div>
<div class="paragraph">
<p>Alternatively, you can set the <code>QUARKUS_FUNQY_EXPORT</code> environment variable when you create the Amazon Lambda using the <code>aws</code> cli.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy-to-aws-lambda-java-runtime"><a class="anchor" href="#deploy-to-aws-lambda-java-runtime"></a>Deploy to AWS Lambda Java Runtime</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are a few steps to get your Funqy function running on AWS Lambda. The quickstart maven project generates a helpful script to create, update, delete, and invoke your functions for pure Java and native deployments. This script is generated at build time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ビルドとデプロイ"><a class="anchor" href="#ビルドとデプロイ"></a>ビルドとデプロイ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Build the project using Maven:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw clean package</code></pre>
</div>
</div>
<div class="paragraph">
<p>これでコードがコンパイルされ、パッケージ化されます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="実行ロールの作成"><a class="anchor" href="#実行ロールの作成"></a>実行ロールの作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AWS CLIを使った Lambda のデプロイ方法については、 <a href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-awscli.html">Getting Started Guide</a> を参照してください。具体的には、 <code>Execution Role</code> を作成していることを確認してください。プロファイルやコンソールウィンドウで <code>LAMBDA_ROLE_ARN</code> 環境変数を定義する必要があります。また、ビルドで生成される <code>manage.sh</code> スクリプトを編集して、そこに直接ロール値を置くこともできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">LAMBDA_ROLE_ARN="arn:aws:iam::1234567890:role/lambda-role"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ビルド時に追加生成されるファイル"><a class="anchor" href="#ビルド時に追加生成されるファイル"></a>ビルド時に追加生成されるファイル</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After you run the build, there are a few extra files generated by the <code>quarkus-funqy-amazon-lambda</code> extension. These files are in the the build directory: <code>target/</code> for maven, <code>build/</code> for gradle.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>function.zip</code> - Lambda デプロイファイル</p>
</li>
<li>
<p><code>manage.sh</code> - aws Lambda CLI の呼び出しのラッパー</p>
</li>
<li>
<p><code>bootstrap-example.sh</code> - example bootstrap script for native deployments</p>
</li>
<li>
<p><code>sam.jvm.yaml</code> - (オプション) SAM CLI やローカル・テスト用</p>
</li>
<li>
<p><code>sam.native.yaml</code> - (オプション) SAM CLI やネイティブ・ローカル・テスト用(オプション)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="関数を作成する"><a class="anchor" href="#関数を作成する"></a>関数を作成する</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <code>target/manage.sh</code> script is for managing your Funqy function using the AWS Lambda Java runtime. This script is provided only for your convenience. Examine the output of the <code>manage.sh</code> script if you want to learn what aws commands are executed to create, delete, and update your functions.</p>
</div>
<div class="paragraph">
<p><code>manage.sh</code> は、 <code>create</code> , <code>delete</code> , <code>update</code> , <code>invoke</code> の 4 つの操作をサポートしています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
AWS CLIがインストールされていること、AWSアクセスキーのためのaws configureを実行していること、 <code>LAMBDA_ROLE_ARN</code> 環境変数を設定していること(上記の通り)を確認するには、 <code>manage.sh</code> をパラメーターなしで実行してください。それに応じて利用方法のガイドが表示されます。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>usage</code> を参照したり、AWS の設定を検証するためには次のようにします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のコマンドを使って、 Function を <code>create</code> します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh create</code></pre>
</div>
</div>
<div class="paragraph">
<p>または、このシェルで既に <code>LAMBDA_ROLE_ARN</code> が定義されていない場合にはこうです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">LAMBDA_ROLE_ARN="arn:aws:iam::1234567890:role/lambda-role" sh target/manage.sh create</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not change the handler switch. This must be hardcoded to <code>io.quarkus.funqy.lambda.FunqyStreamHandler::handleRequest</code>. This special handler is Funqy&#8217;s integration point with AWS Lambda.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Function の作成に問題がある場合は、 <code>delete</code> で Function を削除してから <code>create</code> コマンドを再実行する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh delete</code></pre>
</div>
</div>
<div class="paragraph">
<p>コマンドはスタックすることもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh delete create</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="関数の呼出"><a class="anchor" href="#関数の呼出"></a>関数の呼出</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Function を呼び出すには <code>invoke</code> コマンドを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh invoke</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example function takes input passed in via the <code>--payload</code> switch which points to a json file in the root directory of the project.</p>
</div>
<div class="paragraph">
<p>The function can also be invoked locally with the SAM CLI like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.jvm.yaml --event payload.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>ネイティブイメージのビルドで作業している場合は、テンプレート名をネイティブバージョンに置き換えてください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.native.yaml --event payload.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="functionの更新"><a class="anchor" href="#functionの更新"></a>functionの更新</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can update the Java code as you see fit. Once you&#8217;ve rebuilt, you can redeploy your function by executing the <code>update</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh update</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy-to-aws-lambda-custom-native-runtime"><a class="anchor" href="#deploy-to-aws-lambda-custom-native-runtime"></a>Deploy to AWS Lambda Custom (native) Runtime</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want a lower memory footprint and faster initialization times for your Funqy function, you can compile your Java code to a native executable. Just make sure to rebuild your project with the <code>-Pnative</code> switch.</p>
</div>
<div class="paragraph">
<p>Linuxホストの場合は以下を実行します。</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw package -Dnative</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are building on a non-Linux system, you will need to also pass in a property instructing Quarkus to use a Docker build as Amazon Lambda requires Linux binaries. You can do this by passing this property to your build: <code>-Dnative-image.docker-build=true</code>. This requires you to have Docker installed locally, however.
</td>
</tr>
</table>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw package -Dnative -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>Either of these commands will compile and create a native executable. It also generates a zip file <code>target/function.zip</code>. This zip file contains your native executable image renamed to <code>bootstrap</code>. This is a requirement of the AWS Lambda Custom (Provided) Runtime.</p>
</div>
<div class="paragraph">
<p>ここでの説明は上記と全く同じですが、1つ変更点があります: <code>manage.sh</code> スクリプトの最初のパラメーターとして <code>native</code> を追加する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh native create</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記のように、コマンドはスタックすることができます。唯一の要件は、ネイティブイメージビルドで作業したい場合、最初のパラメーターとして <code>native</code> を指定することです。このスクリプトは、ネイティブイメージ Function のデプロイメントを管理するために必要な残りの詳細を処理します。</p>
</div>
<div class="paragraph">
<p>Examine the output of the <code>manage.sh</code> script if you want to learn what aws commands are executed to create, delete, and update your functions.</p>
</div>
<div class="paragraph">
<p>ネイティブ用のcreateコマンドについて注意すべき点は、 <code>aws lambda create-function</code> 呼び出しで特定の環境変数を設定しなければならないということです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">--environment 'Variables={DISABLE_SIGNAL_HANDLERS=true}'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="examine-the-pom"><a class="anchor" href="#examine-the-pom"></a>Examine the POM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is nothing special about the POM other than the inclusion of the <code>quarkus-funqy-amazon-lambda</code> extension as a dependency. The extension automatically generates everything you might need for your lambda deployment.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="統合テスト"><a class="anchor" href="#統合テスト"></a>統合テスト</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Funqy Amazon Lambda support leverages the Quarkus AWS Lambda test framework so that you can unit tests your Funqy functions. This is true for both JVM and native modes. This test framework provides similar functionality to the SAM CLI, without the overhead of Docker.</p>
</div>
<div class="paragraph">
<p>If you open up <a href="https://github.com/quarkusio/quarkus-quickstarts/tree/main/funqy-quickstarts/funqy-amazon-lambda-quickstart/src/test/java/org/acme/funqy/FunqyTest.java">FunqyTest.java</a> you&#8217;ll see that the test replicates the AWS execution environment.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">package org.acme.funqy;

import io.quarkus.amazon.lambda.test.LambdaClient;
import io.quarkus.test.junit.QuarkusTest;
import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

@QuarkusTest
public class FunqyTest {
    @Test
    public void testSimpleLambdaSuccess() throws Exception {
        Friend friend = new Friend("Bill");
        Greeting out = LambdaClient.invoke(Greeting.class, friend);
        Assertions.assertEquals("Hello Bill", out.getMessage());
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-with-the-sam-cli"><a class="anchor" href="#testing-with-the-sam-cli"></a>Testing with the SAM CLI</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">AWS SAM CLI</a> allows you to run your functions locally on your laptop in a simulated Lambda environment. This requires <a href="https://www.docker.com/products/docker-desktop">docker</a> to be installed. This is an optional approach should you choose to take advantage of it. Otherwise, the Quarkus JUnit integration should be sufficient for most of your needs.</p>
</div>
<div class="paragraph">
<p>JVMとネイティブ実行モードの両方に対応したスターターテンプレートが生成されています。</p>
</div>
<div class="paragraph">
<p>Run the following SAM CLI command to locally test your function, passing the appropriate SAM <code>template</code>. The <code>event</code> parameter takes any JSON file, in this case the sample <code>payload.json</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.jvm.yaml --event payload.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>ネイティブイメージは、 <code>sam.native.yaml</code> テンプレートを使ってローカルでテストすることもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.native.yaml --event payload.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="function-zip-の修正"><a class="anchor" href="#function-zip-の修正"></a><code>function.zip</code> の修正</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are times where you may have to add additional entries to the <code>function.zip</code> lambda deployment that is generated by the build. To do this create a <code>zip.jvm</code> or <code>zip.native</code> directory within <code>src/main</code>. Create <code>zip.jvm/</code> if you are doing a pure Java. <code>zip.native/</code> if you are doing a native deployment.</p>
</div>
<div class="paragraph">
<p>zipディレクトリーの下に作成したファイルやディレクトリーは、すべて <code>function.zip</code> に含まれます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="カスタム-bootstrap-スクリプト"><a class="anchor" href="#カスタム-bootstrap-スクリプト"></a>カスタム <code>bootstrap</code> スクリプト</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are times you may want to set specific system properties or other arguments when lambda invokes your native Funqy deployment. If you include a <code>bootstrap</code> script file within <code>zip.native</code>, the Funqy extension will automatically rename the executable to <code>runner</code> within <code>function.zip</code> and set the unix mode of the <code>bootstrap</code> script to executable.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
カスタム <code>bootstrap</code> スクリプトを含む場合は、ネイティブ実行可能ファイルを <code>runner</code> として参照する必要があります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>このエクステンションは、サンプルのスクリプト <code>target/bootstrap-example.sh</code> を生成します。</p>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus はオープンです。このプロジェクトの全ての依存関係は<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>または互換性のあるライセンスの元で利用出来ます。<br /><br />このウェブサイトは <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> で構築されており、<a href='https://pages.github.com/' target='_blank'>Github Pages</a>にホストされており、完全にオープンソースです。改善したい場合、 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>ウェブサイトをフォークし</a>、修正してみせてください。</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
            <li><a href="/">ホーム</a></li>
          
            <li><a href="/about">Quarkusについて</a></li>
          
            <li><a href="/blog">ブログ</a></li>
          
            <li><a href="/insights">ポッドキャスト</a></li>
          
            <li><a href="/events">イベント</a></li>
          
            <li><a href="/newsletter">ニュースレター</a></li>
          
            <li><a href="/publications">出版</a></li>
          
            <li><a href="/awards">受賞</a></li>
          
            <li><a href="/security">セキュリティポリシー</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォロー</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
            <li><a href="/support">サポート</a></li>
          
            <li><a href="/guides">ガイド</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入門</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">ディスカッション</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">開発メーリングリスト</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://ja.quarkus.io/">Japanese</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">等々...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
