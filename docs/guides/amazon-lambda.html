<!DOCTYPE html>
<html>





<head>
  <title>Quarkus - Amazon Lambda</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="Content-Security-Policy" content="default-src https://dpm.demdex.net; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com https://static.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com https://app.mailjet.com http://www.youtube.com http://www.googleadservices.com https://googleads.g.doubleclick.net https://dpm.demdex.net https://giscus.app; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self'; frame-src https://www.googletagmanager.com https://www.youtube.com https://embed.restream.io https://app.mailjet.com https://giscus.app; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;" />
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlight.pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@QuarkusIO"> 
  <meta name="twitter:creator" content="@QuarkusIO">
  <meta property="og:url" content="https://quarkus.io/guides/amazon-lambda" />
  <meta property="og:title" content="Amazon Lambda" />
  <meta property="og:description" content="Quarkus: Supersonic Subatomic Java" />
  <meta property="og:image" content="https://quarkus.io/assets/images/quarkus_card.png" />
  
  <link rel="canonical" href="https://quarkus.io/guides/amazon-lambda">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/guides/stylesheet/config.css" />
  <link rel="stylesheet" href="/assets/css/main.css?2021-07-29" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="/feed.xml" title="Quarkus">
  <script src="/assets/javascript/goan.js" type="text/javascript"></script>
  <script src="/assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="nav-wrapper">
  <div class="grid-wrapper">
    <div class="width-12-12">
      <input type="checkbox" id="checkbox" />
      <nav id="main-nav" class="main-nav">
  <div class="container">
    <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_600px_reverse.png" class="project-logo" title="Quarkus"></a>
    </div>
    <label class="nav-toggle" for="checkbox"> <i class="fa fa-bars"></i>
</label>
    <ul id="menu" class="menu">
      <li class="dropdown">
        <span href="/about/">Quarkusとは <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/about" class="">QUARKUSとは何か?</a></li>
          <li><a href="/container-first" class="">コンテナ・ファースト</a></li>
          <li><a href="/continuum" class="">リアクティブ</a></li>
          <li><a href="/developer-joy" class="">開発者満足</a></li>
          <li><a href="/kubernetes-native" class="">KUBERNETES NATIVE</a></li>
          <li><a href="/standards" class="">標準</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <span href="/learn/">学ぶ<i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/get-started" class="">入門</a></li>
          <li><a href="/guides" class="active">ガイド</a></li>
          <li><a href="/qtips" class="">"Q" Tipsビデオ</a></li>          
          <li><a href="/books" class="">書籍</a></li>
          </ul>
      </li>
      <li class="dropdown">
        <span href="/community/">コミュニティ <i class="fas
fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="/support/" class="">サポート</a></li>
          <li><a href="/blog" class="">ブログ</a></li>
          <li><a href="/discussion" class="">ディスカッション</a></li>
          <li><a href="/insights" class="">ポッドキャスト</a></li>
          <li><a href="/events" class="">イベント</a></li>
          <li><a href="/newsletter" class="">ニュースレター</a></li>
          <li><a href="/publications" class="">出版物</a></li>
          <li><a href="/awards" class="">受賞</a></li>
          </ul>
      </li>
      <li>
        <a href="https://code.quarkus.io" class="button-cta secondary
white">コーディングを開始</a>
      </li>
      <li class="dropdown">
        <span href="/language/"><div class="fas fa-globe langicon"></div><i class="fas fa-chevron-down"></i></span>
        <ul class="submenu">
          <li><a href="https://quarkus.io/" >ENGLISH</a></li>
          <li><a href="https://ja.quarkus.io/">JAPANESE</a></li>
          </ul>
      </li>
    </ul>
  </div>
      </nav>
    </div>
  </div>
</div>

  <div class="content">
    



<div class="full-width-version-bg grey align-self">
  <div class="grid-wrapper">
    <div class="grid__item width-6-12">
      <p class="returnlink"><i class="fas fa-angle-left"></i><a href="/guides/"> Back to Guides</a></p>
    </div>
    <div class="grid__item width-6-12 align-self-center text-right hide-mobile">
      <label id="guide-version-label">Select Guide Version</label>
      <select id="guide-version-dropdown">
        
      
        
        
        
        
          
        <option value="main" >Main - SNAPSHOT</option>
        
        
      
        
        
        
        
          
        <option value="latest" selected>2.9 - Latest</option>
        
        
      
        
        
        
        
          
        <option value="2.7" >2.7</option>
        
        
      
        
        
        
        
          
        <option value="2.2" >2.2</option>
        
        
      
        
        
        
        
          
        <option value="1.11" >1.11</option>
        
        
      
    
      </select>
    </div>
  </div>
</div>

<div class="grid-wrapper guide">
  <div class="grid__item width-12-12 width-12-12-mobile">
    <h1 class="text-caps">Amazon Lambda </h1>
  </div>
  <div class="width-12-12">
    <div class="hide-mobile toc"><ul class="sectlevel1">
<li><a href="#前提条件">前提条件</a></li>
<li><a href="#はじめに">はじめに</a></li>
<li><a href="#awsツールのインストール">AWSツールのインストール</a></li>
<li><a href="#maven-デプロイメントプロジェクトの作成">Maven デプロイメントプロジェクトの作成</a></li>
<li><a href="#choose">Lambda の選択</a></li>
<li><a href="#aws-lambda-java-ランタイムへのデプロイ">AWS Lambda Java ランタイムへのデプロイ</a></li>
<li><a href="#ビルドとデプロイ">ビルドとデプロイ</a></li>
<li><a href="#execution-role-の作成">Execution Role の作成</a></li>
<li><a href="#ビルド時に追加生成されるファイル">ビルド時に追加生成されるファイル</a></li>
<li><a href="#function-を作成する">Function を作成する</a></li>
<li><a href="#lambda-を呼び出す">Lambda を呼び出す</a></li>
<li><a href="#lambda-の更新">Lambda の更新</a></li>
<li><a href="#aws-lambda-custom-ネイティブ-runtime-へのデプロイ">AWS Lambda Custom (ネイティブ) Runtime へのデプロイ</a></li>
<li><a href="#pomとgradleのビルドを調べる">POMとGradleのビルドを調べる</a></li>
<li><a href="#gradle">Gradle ビルド</a></li>
<li><a href="#live-coding-and-unitintegration-testing">Live Coding and Unit/Integration Testing</a></li>
<li><a href="#sam-cli-でのテスト">SAM CLI でのテスト</a></li>
<li><a href="#function-zip-の修正"><code>function.zip</code> の修正</a></li>
<li><a href="#カスタム-bootstrap-スクリプト">カスタム <code>bootstrap</code> スクリプト</a></li>
<li><a href="#aws-xray-と-graalvm-でのトレース">AWS XRay と GraalVM でのトレース</a></li>
<li><a href="#https">HTTPS または SSL/TLS を使用する</a></li>
<li><a href="#aws-sdk-v2">AWS Java SDK v2 の利用</a></li>
<li><a href="#クライアントsslの追加要件">クライアントSSLの追加要件</a></li>
<li><a href="#deploy-to-aws-lambda-using-a-container-image">Deploy to AWS Lambda using a Container Image</a>
<ul class="sectlevel2">
<li><a href="#jvm-container-image">JVM container image</a></li>
<li><a href="#native-executable-container-image">Native executable container image</a></li>
<li><a href="#deploying-a-container-image-lambda">Deploying a container image lambda</a></li>
</ul>
</li>
<li><a href="#amazon-alexa-統合">Amazon Alexa 統合</a></li>
</ul></div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><code>quarkus-amazon-lambda</code> エクステンションを使うと、Quarkusを使ってAWS Lambda を構築することができます。Lambda では、CDIやSpringからのインジェクションアノテーションや、必要に応じてQuarkusの他の機能を使用することができます。</p>
</div>
<div class="paragraph">
<p>Quarkusの Lambda は、Amazon Javaランタイムを使用してデプロイすることもできますが、より小さなメモリーフットプリントとより高速なコールドブート起動時間が必要な場合は、ネイティブ実行可能ファイルをビルドしてAmazonのカスタムランタイムを使用することもできます。</p>
</div>
<div class="paragraph">
<p>Quarkus&#8217;s integration with lambdas also supports Quarkus&#8217;s Live Coding development cycle. You an bring up your Quarkus lambda project in dev or test mode and code on your project live.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="前提条件"><a class="anchor" href="#前提条件"></a>前提条件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このガイドを完成させるには、以下が必要です:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ざっと 30 minutes</p>
</li>
<li>
<p>IDE</p>
</li>
<li>
<p>JDK 11+ がインストールされ、 <code>JAVA_HOME</code> が適切に設定されていること</p>
</li>
<li>
<p>Apache Maven 3.8.1+</p>
</li>
<li>
<p>使用したい場合、 <a href="cli-tooling.html">Quarkus CLI</a></p>
</li>
<li>
<p>ネイティブ実行可能ファイルをビルドしたい場合、MandrelまたはGraalVM（あるいはネイティブなコンテナビルドを使用する場合はDocker）をインストールし、 <a href="building-native-image.html#configuring-graalvm">適切に設定</a>していること</p>
</li>
<li>
<p><a href="https://aws.amazon.com">Amazon AWSのアカウント</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html">AWS CLI</a></p>
</li>
<li>
<p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">AWS SAM CLI</a> 、ローカルテスト用</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For Gradle projects please <a href="#gradle">see below</a>, or for further reference consult the guide in the <a href="gradle-tooling">Gradle setup page</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="はじめに"><a class="anchor" href="#はじめに"></a>はじめに</h2>
<div class="sectionbody">
<div class="paragraph">
<p>このガイドでは、mavenのArchetypeを使用してJavaプロジェクトのサンプルを生成し、AWSにデプロイする方法を説明します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="awsツールのインストール"><a class="anchor" href="#awsツールのインストール"></a>AWSツールのインストール</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AWSのすべてのツールをインストールすることは、おそらくこのガイドでは最も難しいことです。AWS CLIをインストールするためのすべての手順に従っていることを確認してください。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="maven-デプロイメントプロジェクトの作成"><a class="anchor" href="#maven-デプロイメントプロジェクトの作成"></a>Maven デプロイメントプロジェクトの作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Maven Archetypeを使用してQuarkus AWS Lambda mavenプロジェクトを作成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">mvn archetype:generate \
       -DarchetypeGroupId=io.quarkus \
       -DarchetypeArtifactId=quarkus-amazon-lambda-archetype \
       -DarchetypeVersion=2.9.0.Final</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Gradleを使いたい場合は、 <a href="https://code.quarkus.io/">code.quarkus.io</a> を使って、 <code>quarkus-amazon-lambda</code> エクステンションを依存関係として追加することで、素早く簡単にGradleプロジェクトを生成することができます。</p>
</div>
<div class="paragraph">
<p>build.gradle、gradle.properties、settings.gradleを上記の生成されたMavenのアーキタイププロジェクトにコピーして、このガイドに従ってください。</p>
</div>
<div class="paragraph">
<p>Execute: gradle wrapper を実行して gradle wrapper を設定します(推奨)。</p>
</div>
<div class="paragraph">
<p>Gradleの詳細は <a href="#gradle">こちらを参照してください</a> 。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="choose"><a class="anchor" href="#choose"></a>Lambda の選択</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>quarkus-amazon-lambda</code> エクステンションは、Amazon <code>RequestHandler&lt;?, ?&gt;</code> または <code>RequestStreamHandler</code> インターフェイスを直接実装しているクラスをプロジェクト内でスキャンします。このインターフェイスを実装しているクラスがプロジェクト内で見つかるようにしなければならず、そうでない場合にはビルド時に例外がスローされます。複数のハンドラークラスを見つけた場合にも、ビルド時の例外がスローされます。</p>
</div>
<div class="paragraph">
<p>しかし、時にはコードを共有するいくつかの関連する Lambda があって、複数の maven モジュールを作成することは、やりたくないオーバーヘッドに過ぎないことがあるかもしれません。 <code>quarkus-amazon-lambda</code> エクステンションを使用すると、1 つのプロジェクトに複数のラムダをバンドルし、設定または環境変数を使用してデプロイしたいハンドラーを選択することができます。</p>
</div>
<div class="paragraph">
<p>生成されたプロジェクトは、その中に3つの Lambda を持っています。 <code>RequestHandler&lt;?, ?&gt;</code> インターフェイスを実装したものが 2 つ、 <code>RequestStreamHandler</code> インターフェイスを実装したものが 1 つ。1つは使用され、2つは未使用です。 <code>src/main/resources/application.properties</code> を開くと、このようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.lambda.handler=test</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>quarkus.lambda.handler</code> プロパティーは、デプロイする Lambda ハンドラーをQuarkusに伝えます。これは環境変数でオーバーライドすることもできます。</p>
</div>
<div class="paragraph">
<p>プロジェクト内で生成された3つのハンドラークラスを見てみると、異なる <code>@Named</code> が指定されていることがわかります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">@Named("test")
public class TestLambda implements RequestHandler&lt;InputObject, OutputObject&gt; {
}

@Named("unused")
public class UnusedLambda implements RequestHandler&lt;InputObject, OutputObject&gt; {
}

@Named("stream")
public class StreamLambda implements RequestStreamHandler {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>ハンドラークラスのCDI名は、 <code>quarkus.lambda.handler</code> プロパティー内で指定された値と一致しなければなりません。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aws-lambda-java-ランタイムへのデプロイ"><a class="anchor" href="#aws-lambda-java-ランタイムへのデプロイ"></a>AWS Lambda Java ランタイムへのデプロイ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lambda をAWS上で動作させるには、いくつかのステップがあります。生成されたmavenプロジェクトには、pure Java とネイティブデプロイメント用の Lambda を作成、更新、削除、呼び出しするための便利なスクリプトが含まれています。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ビルドとデプロイ"><a class="anchor" href="#ビルドとデプロイ"></a>ビルドとデプロイ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Build the project:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw clean package</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build</code></pre>
</div>
</div>
<div class="paragraph">
<p>これでコードがコンパイルされ、パッケージ化されます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="execution-role-の作成"><a class="anchor" href="#execution-role-の作成"></a>Execution Role の作成</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AWS CLIを使った Lambda のデプロイ方法については、 <a href="https://docs.aws.amazon.com/lambda/latest/dg/gettingstarted-awscli.html">Getting Started Guide</a> を参照してください。具体的には、 <code>Execution Role</code> を作成していることを確認してください。プロファイルやコンソールウィンドウで <code>LAMBDA_ROLE_ARN</code> 環境変数を定義する必要があります。また、ビルドで生成される <code>manage.sh</code> スクリプトを編集して、そこに直接ロール値を置くこともできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">LAMBDA_ROLE_ARN="arn:aws:iam::1234567890:role/lambda-role"</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ビルド時に追加生成されるファイル"><a class="anchor" href="#ビルド時に追加生成されるファイル"></a>ビルド時に追加生成されるファイル</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ビルドを実行すると、 <code>quarkus-amazon-lambda</code> のエクステンションで生成されるいくつかの追加ファイルがあります。これらのファイルはビルドディレクトリーにあります: mavenなら <code>target/</code> 、gradleなら <code>build/</code> 。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>function.zip</code> - Lambda デプロイファイル</p>
</li>
<li>
<p><code>manage.sh</code> - aws Lambda CLI の呼び出しのラッパー</p>
</li>
<li>
<p><code>bootstrap-example.sh</code> - ネイティブデプロイ用のブートストラップスクリプトの例</p>
</li>
<li>
<p><code>sam.jvm.yaml</code> - (オプション) SAM CLI やローカル・テスト用</p>
</li>
<li>
<p><code>sam.native.yaml</code> - (オプション) SAM CLI やネイティブ・ローカル・テスト用(オプション)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="function-を作成する"><a class="anchor" href="#function-を作成する"></a>Function を作成する</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>target/manage.sh</code> スクリプトは、AWS Lambda Java ランタイムを使用して Lambda を管理するためのものです。このスクリプトは利便性のためだけに提供されています。Lambda の作成、削除、更新のためにどのようなawsコマンドが実行されるかを知りたい場合は、 <code>manage.sh</code> スクリプトの出力を確認してください。</p>
</div>
<div class="paragraph">
<p><code>manage.sh</code> は、 <code>create</code> , <code>delete</code> , <code>update</code> , <code>invoke</code> の 4 つの操作をサポートしています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
AWS CLIがインストールされていること、AWSアクセスキーのためのaws configureを実行していること、 <code>LAMBDA_ROLE_ARN</code> 環境変数を設定していること(上記の通り)を確認するには、 <code>manage.sh</code> をパラメーターなしで実行してください。それに応じて利用方法のガイドが表示されます。
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Gradleを使用している場合、 <code>manage.sh</code> のバイナリーへのパスを <code>target</code> から <code>build</code> に変更しなければなりません。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><code>usage</code> を参照したり、AWS の設定を検証するためには次のようにします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>次のコマンドを使って、 Function を <code>create</code> します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh create</code></pre>
</div>
</div>
<div class="paragraph">
<p>または、このシェルで既に <code>LAMBDA_ROLE_ARN</code> が定義されていない場合にはこうです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">LAMBDA_ROLE_ARN="arn:aws:iam::1234567890:role/lambda-role" sh target/manage.sh create</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
ハンドラースイッチを変更しないでください。これは、 <code>io.quarkus.amazon.lambda.runtime.QuarkusStreamHandler::handleRequest</code> にハードコードする必要があります。このハンドラは、Quarkusをブートストラップし、インジェクションを実行できるように実際のハンドラをラップします。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Function の作成に問題がある場合は、 <code>delete</code> で Function を削除してから <code>create</code> コマンドを再実行する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh delete</code></pre>
</div>
</div>
<div class="paragraph">
<p>コマンドはスタックすることもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh delete create</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lambda-を呼び出す"><a class="anchor" href="#lambda-を呼び出す"></a>Lambda を呼び出す</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Function を呼び出すには <code>invoke</code> コマンドを使用します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh invoke</code></pre>
</div>
</div>
<div class="paragraph">
<p>サンプルの Lambda は、プロジェクトのルートディレクトリーにある json ファイルを指す <code>--payload</code> スイッチを介して渡された入力を受け取ります。</p>
</div>
<div class="paragraph">
<p>Lambda は、以下のようにSAM CLI によってローカルで呼び出すこともできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.jvm.yaml --event payload.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>ネイティブイメージのビルドで作業している場合は、テンプレート名をネイティブバージョンに置き換えてください。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.native.yaml --event payload.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="lambda-の更新"><a class="anchor" href="#lambda-の更新"></a>Lambda の更新</h2>
<div class="sectionbody">
<div class="paragraph">
<p>お好きなように Java コードを更新することができます。リビルドしたら、 <code>update</code> コマンドを実行することで、Lambda を再配備できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh update</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aws-lambda-custom-ネイティブ-runtime-へのデプロイ"><a class="anchor" href="#aws-lambda-custom-ネイティブ-runtime-へのデプロイ"></a>AWS Lambda Custom (ネイティブ) Runtime へのデプロイ</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Lambda のメモリーフットプリントを減らし、初期化時間を短縮したい場合は、Javaコードをネイティブ実行可能ファイルにコンパイルすることができます。 <code>-Pnative</code> スイッチでプロジェクトをリビルドすることを確認してください。</p>
</div>
<div class="paragraph">
<p>For Linux hosts, execute:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw package -Dnative</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build -Dquarkus.package.type=native</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are building on a non-Linux system, you will need to also pass in a property instructing Quarkus to use a docker build as Amazon Lambda requires linux binaries. You can do this by passing this property to your build: <code>-Dquarkus.native.container-build=true</code>. This requires you to have Docker installed locally, however.
</td>
</tr>
</table>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus build --native -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw package -Dnative -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew build -Dquarkus.package.type=native -Dquarkus.native.container-build=true</code></pre>
</div>
</div>
<div class="paragraph">
<p>これらのコマンドのいずれかがコンパイルされ、ネイティブの実行イメージが作成されます。また、zip ファイル <code>target/function.zip</code> も生成されます。このzipファイルには、 <code>bootstrap</code> にリネームされたネイティブ実行イメージが含まれています。これはAWS Lambda Custom (Provided) Runtimeの要件です。</p>
</div>
<div class="paragraph">
<p>ここでの説明は上記と全く同じですが、1つ変更点があります: <code>manage.sh</code> スクリプトの最初のパラメーターとして <code>native</code> を追加する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sh target/manage.sh native create</code></pre>
</div>
</div>
<div class="paragraph">
<p>上記のように、コマンドはスタックすることができます。唯一の要件は、ネイティブイメージビルドで作業したい場合、最初のパラメーターとして <code>native</code> を指定することです。このスクリプトは、ネイティブイメージ Function のデプロイメントを管理するために必要な残りの詳細を処理します。</p>
</div>
<div class="paragraph">
<p>Lambda を作成、削除、更新するためにどのようなawsコマンドが実行されるかを知りたい場合は、 <code>manage.sh</code> スクリプトの出力を調べてください。</p>
</div>
<div class="paragraph">
<p>ネイティブ用のcreateコマンドについて注意すべき点は、 <code>aws lambda create-function</code> 呼び出しで特定の環境変数を設定しなければならないということです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">--environment 'Variables={DISABLE_SIGNAL_HANDLERS=true}'</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pomとgradleのビルドを調べる"><a class="anchor" href="#pomとgradleのビルドを調べる"></a>POMとGradleのビルドを調べる</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There is nothing special about the POM other than the inclusion of the <code>quarkus-amazon-lambda</code> extension as a dependency. The extension automatically generates everything you might need for your lambda deployment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
このエクステンションの以前のバージョンでは、ネイティブデプロイメントのために実行ファイルを zip 化するように pom や gradle を設定しなければなりませんでしたが、今はそうではありません。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="gradle"><a class="anchor" href="#gradle"></a>Gradle ビルド</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Similarly for Gradle projects, you also just have to add the <code>quarkus-amazon-lambda</code> dependency. The extension automatically generates everything you might need for your lambda deployment.</p>
</div>
<div class="paragraph">
<p>Gradleの依存関係の例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-groovy hljs" data-lang="groovy">dependencies {
    implementation enforcedPlatform("${quarkusPlatformGroupId}:${quarkusPlatformArtifactId}:${quarkusPlatformVersion}")
    implementation 'io.quarkus:quarkus-resteasy'
    implementation 'io.quarkus:quarkus-amazon-lambda'

    testImplementation 'io.quarkus:quarkus-junit5'
    testImplementation 'io.rest-assured:rest-assured'
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="live-coding-and-unitintegration-testing"><a class="anchor" href="#live-coding-and-unitintegration-testing"></a>Live Coding and Unit/Integration Testing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To mirror the AWS Lambda environment as closely as possible in a dev environment, the Quarkus Amazon Lambda extension boots up a mock AWS Lambda event server in Quarkus Dev and Test mode. This mock event server simulates a true AWS Lambda environment.</p>
</div>
<div class="paragraph">
<p>While running in Quarkus Dev Mode, you can feed events to it by doing an HTTP POST to <code><a href="http://localhost:8080" class="bare">http://localhost:8080</a></code>. The mock event server will receive the events and your lambda will be invoked. You can perform live coding on your lambda and changes will automatically be recompiled and available the next invocation you make. Here&#8217;s an example:</p>
</div>
<div class="listingblock primary asciidoc-tabs-sync-cli">
<div class="title">CLI</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">quarkus dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-maven">
<div class="title">Maven</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./mvnw quarkus:dev</code></pre>
</div>
</div>
<div class="listingblock secondary asciidoc-tabs-sync-gradle">
<div class="title">Gradle</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">./gradlew --console=plain quarkusDev</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -d "{\"name\":\"John\"}" -X POST http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>For your unit tests, you can also invoke on the mock event server using any HTTP client you want. Here&#8217;s an example using rest-assured. Quarkus starts up a separate Mock Event server under port 8081. The default port for Rest Assured is automatically set to 8081 by Quarkus so you can invoke on this endpoint.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import org.junit.jupiter.api.Test;

import io.quarkus.test.junit.QuarkusTest;

import static io.restassured.RestAssured.given;
import static org.hamcrest.CoreMatchers.containsString;

@QuarkusTest
public class LambdaHandlerTest {

    @Test
    public void testSimpleLambdaSuccess() throws Exception {
        Person in = new Person();
        in.setName("Stu");
        given()
                .contentType("application/json")
                .accept("application/json")
                .body(in)
                .when()
                .post()
                .then()
                .statusCode(200)
                .body(containsString("Hello Stu"));
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The mock event server is also started for <code>@NativeImageTest</code> and <code>@QuarkusIntegrationTest</code> tests so will work with native binaries too. All this provides similar functionality to the SAM CLI local testing, without the overhead of Docker.</p>
</div>
<div class="paragraph">
<p>Finally, if port 8080 or port 8081 is not available on your computer, you can modify the dev and test mode ports with application.properties</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">quarkus.lambda.mock-event-server.dev-port=8082
quarkus.lambda.mock-event-server.test-port=8083</code></pre>
</div>
</div>
<div class="paragraph">
<p>A port value of zero will result in a randomly assigned port.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sam-cli-でのテスト"><a class="anchor" href="#sam-cli-でのテスト"></a>SAM CLI でのテスト</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you do not want to use the mock event server, you can test your lambdas with SAM CLI.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html">AWS SAM CLI</a> を利用すると、Lambda をシミュレートした環境でラップトップ上のローカルで Lambda を実行することができます。これには <a href="https://www.docker.com/products/docker-desktop">docker</a> のインストールが必要です。これは、利用することを選択した場合のオプションのアプローチです。それ以外の場合は、Quarkus JUnitの統合でほとんどのニーズを満たすことができるはずです。</p>
</div>
<div class="paragraph">
<p>JVMとネイティブ実行モードの両方に対応したスターターテンプレートが生成されています。</p>
</div>
<div class="paragraph">
<p>以下の SAM CLI コマンドを実行して、適切な SAM <code>template</code> を渡して Lambda Function をローカルでテストします。 <code>event</code> パラメーターには任意の JSON ファイルを指定します。この場合はサンプル <code>payload.json</code> を指定しています。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Gradle を使用している場合、YAML テンプレートのバイナリーへのパスを <code>target</code> から <code>build</code> に変更しなければなりません。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.jvm.yaml --event payload.json</code></pre>
</div>
</div>
<div class="paragraph">
<p>ネイティブイメージは、 <code>sam.native.yaml</code> テンプレートを使ってローカルでテストすることもできます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sam local invoke --template target/sam.native.yaml --event payload.json</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="function-zip-の修正"><a class="anchor" href="#function-zip-の修正"></a><code>function.zip</code> の修正</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ビルドによって生成された <code>function.zip</code> Lambda デプロイメントにいくつかの追加を加えなければならない場合があります。これを行うには、 <code>src/main</code> 内に <code>zip.jvm</code> または <code>zip.native</code> ディレクトリーを作成します。Pure Java Lambda を実行している場合は <code>zip.jvm/</code> を、ネイティブディプロイメントを実行している場合は <code>zip.native/</code> を作成します。</p>
</div>
<div class="paragraph">
<p>zipディレクトリーの下に作成したファイルやディレクトリーは、すべて <code>function.zip</code> に含まれます。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="カスタム-bootstrap-スクリプト"><a class="anchor" href="#カスタム-bootstrap-スクリプト"></a>カスタム <code>bootstrap</code> スクリプト</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ラムダがネイティブの quarkus ラムダデプロイメントを起動する際に、特定のシステムプロパティーやその他の引数を設定したい場合があるかもしれません。 <code>zip.native</code> 内に <code>bootstrap</code> スクリプトファイルを含めると、Quarkus エクステンションは自動的に実行ファイルの名前を <code>function.zip</code> 内の <code>runner</code> に変更し、 <code>bootstrap</code> スクリプトの unix モードを実行ファイルに設定します。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
カスタム <code>bootstrap</code> スクリプトを含む場合は、ネイティブ実行可能ファイルを <code>runner</code> として参照する必要があります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>このエクステンションは、サンプルのスクリプト <code>target/bootstrap-example.sh</code> を生成します。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aws-xray-と-graalvm-でのトレース"><a class="anchor" href="#aws-xray-と-graalvm-でのトレース"></a>AWS XRay と GraalVM でのトレース</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ネイティブイメージをビルドしていて、Lambda で <a href="https://aws.amazon.com/xray">AWS X-Ray Tracing</a> を使いたい場合は、 <code>quarkus-amazon-lambda-xray</code> を依存関係として pom に含める必要があります。AWS X-Ray ライブラリは GraalVM との完全な互換性がないため、これを動作させるためにいくつかの統合作業をしなければなりませんでした。</p>
</div>
<div class="paragraph">
<p>さらに、 <code>manage.sh</code> の <code>cmd_create()</code> 関数で AWS X-Ray tracing パラメーターを有効にすることを忘れないでください。これはAWSマネジメントコンソールでも設定できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">    --tracing-config Mode=Active</code></pre>
</div>
</div>
<div class="paragraph">
<p>SAM テンプレートファイルの場合は、YAML の Function Properties に以下を追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">    Tracing: Active</code></pre>
</div>
</div>
<div class="paragraph">
<p>AWS X-Ray はディストリビューションに多くのクラスを追加しますが、最低でも256MBのAWS Lambdaメモリーサイズを使用していることを確認してください。これは <code>manage.sh</code> <code>cmd_create()</code> で明示的に設定されています。ネイティブイメージは常により低いメモリー設定を使用できる可能性がありますが、特にパフォーマンスを比較するためには同じ設定にしておくことをお勧めします。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="https"><a class="anchor" href="#https"></a>HTTPS または SSL/TLS を使用する</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If your code makes HTTPS calls, such as to a micro-service (or AWS service), you will need to add configuration to the native image, as GraalVM will only include the dependencies when explicitly declared. Quarkus, by default enables this functionality on extensions that implicitly require it. For further information, please consult the <a href="native-and-ssl">Quarkus SSL guide</a></p>
</div>
<div class="paragraph">
<p>src/main/resources/application.properties を開き、以下の行を追加してネイティブイメージでSSLを有効にします。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-properties hljs" data-lang="properties">quarkus.ssl.native=true</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="aws-sdk-v2"><a class="anchor" href="#aws-sdk-v2"></a>AWS Java SDK v2 の利用</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Quarkus now has extensions for DynamoDB, S3, SNS and SQS (more coming). Please check <a href="{amazon-services-guide}">those guides</a> on how to use the various AWS Services with Quarkus, as opposed to wiring manually like below.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>最小限のインテグレーションで、AWSのJava SDK v2を活用し、SQS、SNS、S3、DynamoDBなどのサービスを呼び出すことが可能です。</p>
</div>
<div class="paragraph">
<p>しかしながら、ネイティブイメージに対しては、同期モードを使用する場合は、GraalVMのコンパイルの問題のため、Apache HTTPクライアントよりもURL接続クライアントを優先する必要があります(現在のところ)。</p>
</div>
<div class="paragraph">
<p><code>quarkus-jaxb</code> を依存関係として Maven <code>pom.xml</code> または Gradle <code>build.gradle</code> ファイルに追加します。</p>
</div>
<div class="paragraph">
<p>また、SQS, SNS, S3などのAWSサービスクライアントでは、 <a href="#https">HTTPS</a> でAWSサービスに接続するURL Connectionクライアントを強制的に使用する必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">// select the appropriate client, in this case SQS, and
// insert your region, instead of XXXX, which also improves startup time over the default client
  client = SqsClient.builder().region(Region.XXXX).httpClient(software.amazon.awssdk.http.urlconnection.UrlConnectionHttpClient.builder().build()).build();</code></pre>
</div>
</div>
<div class="paragraph">
<p>Mavenの場合は、 <code>pom.xml</code> に以下を追加します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">    &lt;properties&gt;
        &lt;aws.sdk2.version&gt;2.10.69&lt;/aws.sdk2.version&gt;
    &lt;/properties&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;

            &lt;dependency&gt;
                &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
                &lt;artifactId&gt;bom&lt;/artifactId&gt;
                &lt;version&gt;${aws.sdk2.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;

        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;
    &lt;dependencies&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
            &lt;artifactId&gt;url-connection-client&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
            &lt;artifactId&gt;apache-client&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;commons-logging&lt;/groupId&gt;
                    &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
            &lt;!-- sqs/sns/s3 etc --&gt;
            &lt;artifactId&gt;sqs&lt;/artifactId&gt;
            &lt;exclusions&gt;
                &lt;!-- exclude the apache-client and netty client --&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
                    &lt;artifactId&gt;apache-client&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;software.amazon.awssdk&lt;/groupId&gt;
                    &lt;artifactId&gt;netty-nio-client&lt;/artifactId&gt;
                &lt;/exclusion&gt;
                &lt;exclusion&gt;
                    &lt;groupId&gt;commons-logging&lt;/groupId&gt;
                    &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;
                &lt;/exclusion&gt;
            &lt;/exclusions&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.jboss.logging&lt;/groupId&gt;
            &lt;artifactId&gt;commons-logging-jboss-logging&lt;/artifactId&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
if you see <code>java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty</code> or similar SSL error, due to the current status of GraalVM, there is some additional work to bundle the <code>function.zip</code>, as below. For more information, please see the <a href="native-and-ssl">Quarkus Native SSL Guide</a>.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="クライアントsslの追加要件"><a class="anchor" href="#クライアントsslの追加要件"></a>クライアントSSLの追加要件</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The native executable requires some additional steps to enable client SSL that S3 and other AWS libraries need.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>カスタム <code>bootstrap</code> スクリプト</p>
</li>
<li>
<p><code>function.zip</code> に <code>libsunec.so</code> を追加する必要があります。</p>
</li>
<li>
<p><code>function.zip</code> に <code>cacerts</code> を追加する必要があります。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>これを行うには、まず、ビルドでディレクトリー <code>src/main/zip.native/</code> を作成します。次に <code>src/main/zip.native/</code> 内に <code>bootstrap</code> という名前のシェルスクリプトファイルを作成します。サンプル <code>bootstrap-example.sh</code> がビルドフォルダー(ターゲットまたはビルド)内に自動的に作成されます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">#!/usr/bin/env bash

./runner -Djava.library.path=./ -Djavax.net.ssl.trustStore=./cacerts</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cacerts</code> ファイルがパスワードで保護されている場合は、追加で <code>-Djavax.net.ssl.trustStorePassword=changeit</code> を設定してください。</p>
</div>
<div class="paragraph">
<p>次に、GraalVM ディストリビューションから <code>src/main/zip.native/</code> にいくつかのファイルをコピーする必要があります。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Java 8 か 11 バージョンのいずれか、GraalVM バージョンによって、これらのファイルのパスが異なる場合があります。それに応じて調整してください。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cp $GRAALVM_HOME/lib/libsunec.so $PROJECT_DIR/src/main/zip.native/
cp $GRAALVM_HOME/lib/security/cacerts $PROJECT_DIR/src/main/zip.native/</code></pre>
</div>
</div>
<div class="paragraph">
<p>ネイティブビルドを実行すると、これらのファイルはすべて <code>function.zip</code> に含まれます。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Dockerイメージを使ってビルドする場合は、このイメージからこれらのファイルを抽出する必要があります。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>必要な SSL を抽出するには、バックグラウンドでDockerコンテナーを起動し、そのコンテナーにアタッチしてアーティファクトをコピーする必要があります。</p>
</div>
<div class="paragraph">
<p>まず、GraalVMコンテナーを起動して、コンテナーIDの出力に注目してみましょう。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker run -it -d --entrypoint bash quay.io/quarkus/ubi-quarkus-native-image:22.0-java11

# This will output a container id, like 6304eea6179522aff69acb38eca90bedfd4b970a5475aa37ccda3585bc2abdde
# Note this value as we will need it for the commands below</code></pre>
</div>
</div>
<div class="paragraph">
<p>まず、SSLの実装に使用するC言語のライブラリである libsunec.so です。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker cp {container-id-from-above}:/opt/graalvm/lib/libsunec.so src/main/zip.native/</code></pre>
</div>
</div>
<div class="paragraph">
<p>2つ目は、cacerts(証明書ストア)です。また、定期的に更新されたコピーを取得する必要があるかもしれません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker cp {container-id-from-above}:/opt/graalvm/lib/security/cacerts src/main/zip.native/</code></pre>
</div>
</div>
<div class="paragraph">
<p>最終的なアーカイブは以下のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">jar tvf target/function.zip

    bootstrap
    runner
    cacerts
    libsunec.so</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="deploy-to-aws-lambda-using-a-container-image"><a class="anchor" href="#deploy-to-aws-lambda-using-a-container-image"></a>Deploy to AWS Lambda using a Container Image</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AWS Lambda supports creating your lambdas by referencing <a href="https://docs.aws.amazon.com/lambda/latest/dg/lambda-images.html">container images</a> rather than uploading ZIP files. This can have some benefits such as bypassing the size limit of the uploaded ZIP files. You can define lambda functions for both native builds as well as regular JVM builds.</p>
</div>
<div class="sect2">
<h3 id="jvm-container-image"><a class="anchor" href="#jvm-container-image"></a>JVM container image</h3>
<div class="paragraph">
<p>For a regular JVM distribution you need to base your image off the official AWS Java base images. Below is an example of a Dockerfile that would create a container image from your Quarkus Lambda project. It assumes that <code>mvn package</code> has been executed and binaries are available in the <code>target/</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Dockerfile hljs" data-lang="Dockerfile">FROM  public.ecr.aws/lambda/java:11

ADD target/my-service-0.0.1-SNAPSHOT-runner.jar /var/task/lib/my-service.jar
ADD target/lib/  /var/task/lib/

CMD ["io.quarkus.amazon.lambda.runtime.QuarkusStreamHandler::handleRequest"]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="native-executable-container-image"><a class="anchor" href="#native-executable-container-image"></a>Native executable container image</h3>
<div class="paragraph">
<p>To create a lambda container image that uses the native executable we&#8217;ll need to do things a little differently. In this case, we won&#8217;t need to use the <code>java:11</code> base image from AWS but instead we&#8217;ll use a special image that assumes that the runtime environment for the lambda is provided. The example below creates such a container. It assumes that a Maven build has been executed (such as <code>mvn package -Dnative=true</code>) and has generated the native binary into the <code>target/</code> directory. The binary needs to be named <code>bootstrap</code> and be placed in <code>/var/runtime/</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-Dockerfile hljs" data-lang="Dockerfile">FROM  public.ecr.aws/lambda/provided

ADD target/my-service-0.0.1-SNAPSHOT-runner /var/runtime/bootstrap
RUN chmod ugo+x /var/runtime/bootstrap

CMD ["io.quarkus.amazon.lambda.runtime.QuarkusStreamHandler::handleRequest"]</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="deploying-a-container-image-lambda"><a class="anchor" href="#deploying-a-container-image-lambda"></a>Deploying a container image lambda</h3>
<div class="paragraph">
<p>Below, you can see how the container images created above can be built and deployed to AWS using the <code>docker</code> and <code>aws</code> command line tools. These instructions work for both native and jvm container images and assume that the <code>aws</code> command line tool has been logged in.</p>
</div>
<div class="sect3">
<h4 id="build-the-docker-image"><a class="anchor" href="#build-the-docker-image"></a>Build the Docker image</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash"># Assuming we are located in the root directory of the project and created a Dockerfile there
docker build .
   [output omitted]
    =&gt; exporting to image                    0.0s
    =&gt; =&gt; exporting layers                   0.0s
    =&gt; =&gt; writing image sha256:[SOME SHA]    0.0s</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-an-ecr-repository-in-the-users-aws-account"><a class="anchor" href="#create-an-ecr-repository-in-the-users-aws-account"></a>Create an ECR repository in the users AWS account</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws ecr create-repository --repository-name my/test/quarkus-lambda</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="tag-the-image-using-your-ecr-registry-information"><a class="anchor" href="#tag-the-image-using-your-ecr-registry-information"></a>Tag the image using your ECR registry information</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">docker tag [SOME SHA] [YOUR AWS ACCOUNT ID].dkr.ecr.[YOUR AWS ACCOUNT REGION].amazonaws.com/my/test/quarkus-lambda:v1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="log-docker-into-your-ecr-registry-and-push-the-docker-image-to-it"><a class="anchor" href="#log-docker-into-your-ecr-registry-and-push-the-docker-image-to-it"></a>Log Docker into your ECR registry and push the Docker image to it</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws ecr get-login-password --region region | docker login --username AWS --password-stdin [YOUR AWS ACCOUNT ID].dkr.ecr.[YOUR AWS ACCOUNT REGION].amazonaws.com
docker push [YOUR AWS ACCOUNT ID].dkr.ecr.[YOUR AWS ACCOUNT REGION].amazonaws.com/my/test/quarkus-lambda:v1</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="create-the-aws-lambda-function-with-the-aws-cli-tool"><a class="anchor" href="#create-the-aws-lambda-function-with-the-aws-cli-tool"></a>Create the AWS lambda function with the AWS CLI tool</h4>
<div class="paragraph">
<p>Make sure you reference the image you uploaded previously (assumes that a role exists that can be used to run the lambda). Please note that it is not unlikely that for the JVM lambda function, the default memory limit of <code>128Mb</code> will not be enough to run the function. In that case, you can increase the memory limit when creating the function by providing the <code>--memory-size 256</code> parameter to your <code>aws lambda create-function</code> command. You can also adjust the function in the AWS console after you&#8217;ve created it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">aws lambda create-function --function-name my-test-quarkus-lambda-function --package-type Image --code ImageUri=[YOUR AWS ACCOUNT ID].dkr.ecr.[YOUR AWS ACCOUNT REGION].amazonaws.com/my/test/quarkus-lambda:v1 --role arn:aws:iam::[YOUR AWS ACCOUNT ID]:role/[SOME ROLE]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you can use the AWS console to view and test your new lambda function.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="amazon-alexa-統合"><a class="anchor" href="#amazon-alexa-統合"></a>Amazon Alexa 統合</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To use Alexa with Quarkus native, you need to use the <a href="https://github.com/quarkiverse/quarkus-amazon-alexa">Quarkus Amazon Alexa extension hosted at the Quarkiverse Hub</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-xml hljs" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;io.quarkiverse.alexa&lt;/groupId&gt;
    &lt;artifactId&gt;quarkus-amazon-alexa&lt;/artifactId&gt;
    &lt;version&gt;${quarkus-amazon-alexa.version}&lt;/version&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define the latest version of the extension in your POM file.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>通常通り、抽象クラス <code>com.amazon.ask.SkillStreamHandler</code> をサブクラス化して Alexa ハンドラーを作成し、リクエストハンドラーの実装を追加します。</p>
</div>
<div class="paragraph">
<p>それだけだよ!</p>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus はオープンです。このプロジェクトの全ての依存関係は<a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a>または互換性のあるライセンスの元で利用出来ます。<br /><br />このウェブサイトは <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> で構築されており、<a href='https://pages.github.com/' target='_blank'>Github Pages</a>にホストされており、完全にオープンソースです。改善したい場合、 <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>ウェブサイトをフォークし</a>、修正してみせてください。</p>

    
      <div class="width-1-12 project-links">
        <span>ナビゲーション</span>
        <ul class="footer-links">
          
            <li><a href="/">ホーム</a></li>
          
            <li><a href="/about">Quarkusについて</a></li>
          
            <li><a href="/blog">ブログ</a></li>
          
            <li><a href="/insights">ポッドキャスト</a></li>
          
            <li><a href="/events">イベント</a></li>
          
            <li><a href="/newsletter">ニュースレター</a></li>
          
            <li><a href="/publications">出版</a></li>
          
            <li><a href="/awards">受賞</a></li>
          
            <li><a href="/security">セキュリティポリシー</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>フォロー</span>
        <ul class="footer-links">
          
            <li><a href="https://twitter.com/quarkusio">Twitter</a></li>
          
            <li><a href="https://www.facebook.com/quarkusio">Facebook</a></li>
          
            <li><a href="https://www.linkedin.com/company/quarkusio/">Linkedin</a></li>
          
            <li><a href="https://www.youtube.com/channel/UCaW8QG_QoIk_FnjLgr5eOqg">Youtube</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-2-12 project-links">
        <span>ヘルプ</span>
        <ul class="footer-links">
          
            <li><a href="/support">サポート</a></li>
          
            <li><a href="/guides">ガイド</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
            <li><a href="/get-started">入門</a></li>
          
            <li><a href="https://stackoverflow.com/questions/tagged/quarkus">Stack Overflow</a></li>
          
            <li><a href="https://github.com/quarkusio/quarkus/discussions">ディスカッション</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">開発メーリングリスト</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Languages</span>
        <ul class="footer-links">
          
            <li><a href="https://quarkus.io/">English</a></li>
          
            <li><a href="https://ja.quarkus.io/">Japanese</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-4-12 more-links">
        <span>Quarkusはコミュニティプロジェクトで構成されています：</span>
        <ul class="footer-links">
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://smallrye.io" target="_blank">SmallRye</a></li>
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://code.quarkus.io/" target="_blank">等々...</a></li>
          
        </ul>
      </div>
    
  </div>
</div>

  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a> | <a href="https://www.redhat.com/en/about/privacy-policy">Privacy Policy</a>
    </span>
    <span class="redhat">
      Sponsored by
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
  <script src="/guides/javascript/config.js" type="text/javascript"></script>
  <script src="/assets/javascript/search-filter.js" type="text/javascript"></script>
  <script src="/assets/javascript/guides-version-dropdown.js" type="text/javascript"></script>
  <script src="/assets/javascript/back-to-top.js" type="text/javascript"></script>
  <script src="/assets/javascript/clipboard.min.js" type="text/javascript"></script>
  <script src="/assets/javascript/copy.js" type="text/javascript"></script>
  <script src="/assets/javascript/asciidoc-tabs.js" type="text/javascript"></script>
</body>

</html>
